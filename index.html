<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <!-- v11.12b: iOS ä¸»å±å¹•â€œç±» Appâ€æ¨¡å¼æ”¯æŒ -->
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<meta name="apple-mobile-web-app-title" content="å…«å­—å·¥å…·" />
<meta name="theme-color" content="#0f1115" />

<!-- ä¸»å±å¹•å›¾æ ‡ï¼ˆä½ ä¸Šä¼ åŒå PNG å³å¯ç”Ÿæ•ˆï¼‰ -->
<link rel="apple-touch-icon" sizes="180x180" href="icon-180.png" />
<link rel="icon" sizes="192x192" href="icon-192.png" />
<link rel="icon" sizes="512x512" href="icon-512.png" />

  <title>å…«å­—æ’ç›˜å°å·¥å…· v11.12bï¼ˆé»„å† / ç¥ç…ï¼‰</title>

  <script src="https://cdn.jsdelivr.net/npm/lunar-javascript/lunar.js"></script>

  <style>
    :root{
      --bg: #0f1115;
      --panel: #171a21;
      --panel-2: #11131a;
      --text: #e6e6e6;
      --muted: #a7abb7;
      --accent: #d8b65c;
      --accent-2: #f1d98a;
      --border: rgba(216,182,92,.35);
      --shadow: 0 16px 40px rgba(0,0,0,.45);
      --radius-xl: 18px;
      --radius-lg: 14px;
      --radius-md: 10px;
      --track: rgba(255,255,255,.08);
      --good: #9bd4ff;
      --warn: #ffcf7d;
      --bad: #ff9b9b;
      --neutral: #c9cddb;
    }

    *{box-sizing: border-box;}
    body{
      margin: 0;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 22px;
      background:
        radial-gradient(1200px 600px at 20% 10%, rgba(216,182,92,.08), transparent 60%),
        radial-gradient(900px 500px at 80% 90%, rgba(241,217,138,.06), transparent 60%),
        var(--bg);
      color: var(--text);
      font-family: -apple-system, BlinkMacSystemFont, "PingFang SC", "Noto Sans SC",
                   "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    }

    .container{
      width: 100%;
      max-width: 680px;
      background: linear-gradient(180deg, var(--panel), var(--panel-2));
      border: 1px solid rgba(255,255,255,.04);
      border-radius: var(--radius-xl);
      box-shadow: var(--shadow);
      padding: 26px 22px 22px;
      position: relative;
      overflow: hidden;
    }

    .title{
      display: flex;
      align-items: baseline;
      gap: 8px;
      margin: 0 0 8px;
      font-size: 22px;
      letter-spacing: .5px;
      color: var(--accent-2);
    }
    .subtitle{
      margin: 0 0 14px;
      color: var(--muted);
      font-size: 12.2px;
      line-height: 1.55;
    }

    /* ===== Tabs ===== */
    .tabs{
      display: grid;
      grid-template-columns: 1fr 1fr 1fr 1fr 1fr;
      gap: 8px;
      margin-bottom: 10px;
    }
    .tab-btn{
      padding: 10px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.07);
      color: var(--text);
      font-size: 11.2px;
      font-weight: 800;
      cursor: pointer;
      text-align: center;
      user-select: none;
      transition: filter .12s ease, transform .12s ease, border-color .12s ease, background .12s ease;
    }
    .tab-btn:active{ transform: scale(.98); }
    .tab-btn.active{
      border-color: var(--border);
      background: rgba(216,182,92,.14);
    }
    .panel{ display: none; }
    .panel.active{ display: block; }

    /* ===== Common blocks ===== */
    .picker, .jieqi-query, .luck-panel, .almanac-panel, .shensha-panel{
      display: grid;
      gap: 12px;
      padding: 14px 12px 12px;
      border-radius: var(--radius-lg);
      background: rgba(255,255,255,.03);
      border: 1px solid rgba(255,255,255,.06);
    }

    .mode-row{
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
    }
    .mode-pill{
      padding: 9px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.07);
      color: var(--text);
      font-size: 11.2px;
      font-weight: 700;
      cursor: pointer;
      text-align: center;
      user-select: none;
      transition: filter .12s ease, transform .12s ease, border-color .12s ease, background .12s ease;
    }
    .mode-pill:active{ transform: scale(.98); }
    .mode-pill.active{
      border-color: var(--border);
      background: rgba(216,182,92,.14);
    }

    .row, .year-select-row{
      display: grid;
      grid-template-columns: 70px 1fr 74px;
      align-items: center;
      gap: 10px;
    }
    .row .label, .year-select-row .label{
      font-size: 12px;
      color: #8b90a1;
      letter-spacing: .5px;
      white-space: nowrap;
    }
    .row .value, .year-select-row .value{
      text-align: right;
      font-variant-numeric: tabular-nums;
      font-size: 12.4px;
      color: var(--muted);
    }

    input[type="range"]{
      -webkit-appearance: none;
      width: 100%;
      height: 28px;
      background: transparent;
      margin: 0;
      padding: 0;
    }
    input[type="range"]:focus{ outline: none; }
    input[type="range"]::-webkit-slider-runnable-track{
      height: 6px;
      border-radius: 999px;
      background: var(--track);
    }
    input[type="range"]::-webkit-slider-thumb{
      -webkit-appearance: none;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: #0f1115;
      border: 2px solid rgba(241,217,138,.85);
      box-shadow: 0 2px 10px rgba(0,0,0,.35);
      margin-top: -6px;
      transition: transform .08s ease, border-color .12s ease;
    }
    input[type="range"]:active::-webkit-slider-thumb{
      transform: scale(1.08);
      border-color: #fff;
    }
    input[type="range"]::-moz-range-track{
      height: 6px;
      border-radius: 999px;
      background: var(--track);
    }
    input[type="range"]::-moz-range-thumb{
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: #0f1115;
      border: 2px solid rgba(241,217,138,.85);
      box-shadow: 0 2px 10px rgba(0,0,0,.35);
      transition: transform .08s ease, border-color .12s ease;
    }

    .leap-row{
      display: none;
      grid-template-columns: 70px 1fr;
      align-items: center;
      gap: 10px;
      padding: 2px 0 0;
    }
    .toggle{
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 7px 10px;
      border-radius: 10px;
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.07);
      width: fit-content;
      cursor: pointer;
      user-select: none;
      font-size: 11.3px;
      color: var(--muted);
    }
    .toggle input{ transform: translateY(1px); }

    .quick{
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 8px;
      margin-top: 6px;
    }
    .pill{
      padding: 8px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.07);
      color: var(--text);
      font-size: 11.1px;
      font-weight: 600;
      cursor: pointer;
      text-align: center;
      transition: filter .12s ease, transform .12s ease, border-color .12s ease;
      user-select: none;
    }
    .pill:active{ transform: scale(.98); }
    .pill.active{
      border-color: var(--border);
      background: rgba(216,182,92,.12);
    }

    .btn{
      width: 100%;
      border: 0;
      padding: 12.5px 16px;
      border-radius: 999px;
      font-size: 15px;
      font-weight: 800;
      cursor: pointer;
      color: #0f0f0f;
      background: linear-gradient(45deg, var(--accent), var(--accent-2));
      transition: transform .12s ease, filter .12s ease, opacity .12s ease;
    }
    .btn:active{ transform: scale(.98); }
    .btn.secondary{
      background: rgba(255,255,255,.06);
      color: var(--text);
      font-weight: 650;
      border: 1px solid rgba(255,255,255,.08);
    }

    .actions{
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 10px;
    }

    .small-note{
      margin-top: 6px;
      font-size: 11px;
      color: #8b90a1;
      line-height: 1.5;
    }

    .result-box{
      margin-top: 18px;
      padding: 16px 14px 14px;
      background: rgba(255,255,255,.03);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      display: none;
    }

    .section{
      margin-top: 12px;
      padding: 12px 10px 10px;
      border-radius: var(--radius-md);
      background: rgba(255,255,255,.035);
      border: 1px solid rgba(255,255,255,.06);
    }
    .section-title{
      font-size: 11.5px;
      color: var(--muted);
      letter-spacing: .6px;
      margin-bottom: 8px;
      font-weight: 800;
    }

    .info{
      font-size: 12.5px;
      color: var(--muted);
      line-height: 1.6;
      margin-bottom: 6px;
    }

    .jieqi-line{
      display: grid;
      gap: 6px;
      font-size: 12.2px;
      color: var(--muted);
    }
    .jieqi-badge{
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 3px 8px;
      border-radius: 999px;
      background: rgba(216,182,92,.12);
      border: 1px solid var(--border);
      color: var(--accent-2);
      font-weight: 700;
      font-size: 11px;
      width: fit-content;
    }

    .bazi-grid{
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      margin-top: 10px;
    }
    .pillar{
      background: rgba(255,255,255,.035);
      border: 1px solid rgba(255,255,255,.06);
      border-radius: var(--radius-md);
      padding: 10px 6px 10px;
      text-align: center;
    }
    .pillar .p-label{
      display: block;
      font-size: 11px;
      color: #8b90a1;
      margin-bottom: 6px;
    }
    .gan{
      display: block;
      font-size: 22px;
      font-weight: 800;
      color: var(--accent-2);
      letter-spacing: 1px;
    }
    .zhi{
      display: block;
      font-size: 22px;
      font-weight: 800;
      color: var(--text);
      letter-spacing: 1px;
    }
    .sub{
      margin-top: 6px;
      font-size: 10.5px;
      color: #8b90a1;
      line-height: 1.35;
    }
    .sub .hl{ color: var(--good); font-weight: 800; }
    .sub .hl2{ color: var(--warn); font-weight: 800; }

    .compare-box{
      margin-top: 14px;
      padding: 12px 10px 10px;
      border-radius: var(--radius-md);
      background: rgba(255,255,255,.035);
      border: 1px dashed rgba(255,255,255,.12);
      display: none;
    }
    .compare-title{
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 8px;
    }
    .compare-title span{
      font-size: 11.5px;
      color: var(--muted);
      font-weight: 800;
      letter-spacing: .6px;
    }
    .compare-grid{
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    .compare-card{
      border: 1px solid rgba(255,255,255,.08);
      background: rgba(255,255,255,.03);
      border-radius: var(--radius-md);
      padding: 10px 9px 9px;
    }
    .compare-card .tag{
      font-size: 10.5px;
      color: var(--accent-2);
      font-weight: 800;
      margin-bottom: 6px;
    }
    .compare-card .line{
      font-size: 12.2px;
      color: var(--text);
      font-weight: 800;
      letter-spacing: .5px;
      margin-bottom: 4px;
    }
    .compare-card .meta{
      font-size: 10.5px;
      color: #8b90a1;
      line-height: 1.4;
      white-space: pre-line;
    }

    .copy-hint{
      margin-top: 10px;
      font-size: 11px;
      color: #8b90a1;
    }

    .jieqi-list{
      display: grid;
      gap: 8px;
    }
    .jieqi-item{
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 8px;
      padding: 10px 10px;
      border-radius: 10px;
      background: rgba(255,255,255,.035);
      border: 1px solid rgba(255,255,255,.06);
      font-size: 12px;
      color: var(--muted);
    }
    .jieqi-item .name{
      color: var(--text);
      font-weight: 700;
    }
    .jieqi-item .date{
      color: var(--accent-2);
      font-weight: 800;
      font-variant-numeric: tabular-nums;
    }

    .toast{
      position: fixed;
      bottom: 18px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(20,22,30,.95);
      border: 1px solid rgba(255,255,255,.08);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 10px;
      font-size: 12px;
      box-shadow: var(--shadow);
      opacity: 0;
      pointer-events: none;
      transition: opacity .18s ease, transform .18s ease;
    }
    .toast.show{
      opacity: 1;
      transform: translateX(-50%) translateY(-4px);
    }

    /* ===== è¿åŠ¿ / æ—ºè¡° ===== */
    .luck-mode-row{
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
    }
    .luck-pill{
      padding: 8px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.07);
      color: var(--text);
      font-size: 11.1px;
      font-weight: 700;
      cursor: pointer;
      text-align: center;
      user-select: none;
    }
    .luck-pill.active{
      border-color: var(--border);
      background: rgba(216,182,92,.14);
    }

    .luck-box{
      display: none;
      padding: 12px 10px 10px;
      border-radius: var(--radius-md);
      background: rgba(255,255,255,.035);
      border: 1px solid rgba(255,255,255,.06);
    }
    .luck-box.active{ display: block; }

    .luck-list{
      display: grid;
      gap: 8px;
      margin-top: 8px;
    }
    .luck-item{
      display: grid;
      grid-template-columns: 56px 1fr auto;
      gap: 8px;
      align-items: center;
      padding: 9px 10px;
      border-radius: 10px;
      background: rgba(255,255,255,.03);
      border: 1px solid rgba(255,255,255,.06);
      font-size: 11.8px;
      color: var(--muted);
    }
    .luck-item .tag{
      color: var(--accent-2);
      font-weight: 800;
      font-variant-numeric: tabular-nums;
    }
    .luck-item .gz{
      color: var(--text);
      font-weight: 800;
      letter-spacing: .5px;
    }
    .luck-item .meta{
      font-size: 10.6px;
      color: #8b90a1;
      text-align: right;
      white-space: nowrap;
    }

    .ws-badge{
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 3px 8px;
      border-radius: 999px;
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.09);
      font-weight: 800;
      font-size: 10.8px;
      width: fit-content;
    }
    .ws-strong{ color: var(--warn); }
    .ws-weak{ color: var(--good); }
    .ws-mid{ color: var(--accent-2); }

    .explain{
      font-size: 11px;
      color: #8b90a1;
      line-height: 1.55;
      margin-top: 6px;
      white-space: pre-line;
    }

    /* ===== Almanac ===== */
    .almanac-row{
      display: grid;
      grid-template-columns: 90px 1fr;
      gap: 10px;
      align-items: center;
    }
    .date-input{
      width: 100%;
      padding: 10px 12px;
      border-radius: 10px;
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.08);
      color: var(--text);
      font-size: 12.6px;
    }

    .almanac-kv{
      display: grid;
      gap: 6px;
      font-size: 12.2px;
      color: var(--muted);
    }
    .almanac-kv b{
      color: var(--accent-2);
      font-weight: 800;
    }
    .badge-good{ color: var(--good); font-weight: 800; }
    .badge-bad{ color: var(--bad); font-weight: 800; }
    .badge-neutral{ color: var(--neutral); font-weight: 800; }

    /* ===== ShenSha ===== */
    .search-row{
      display: grid;
      grid-template-columns: 1fr;
      gap: 8px;
    }
    .search-input{
      width: 100%;
      padding: 11px 12px;
      border-radius: 10px;
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.08);
      color: var(--text);
      font-size: 12.6px;
    }
    .ss-filter-row{
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 8px;
    }
    .ss-pill{
      padding: 8px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.07);
      color: var(--text);
      font-size: 10.8px;
      font-weight: 700;
      cursor: pointer;
      text-align: center;
      user-select: none;
    }
    .ss-pill.active{
      border-color: var(--border);
      background: rgba(216,182,92,.14);
    }
    .ss-list{
      display: grid;
      gap: 8px;
    }
    .ss-item{
      padding: 11px 11px 10px;
      border-radius: 12px;
      background: rgba(255,255,255,.035);
      border: 1px solid rgba(255,255,255,.06);
    }
    .ss-head{
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }
    .ss-name{
      font-size: 13.2px;
      font-weight: 900;
      color: var(--text);
      letter-spacing: .4px;
    }
    .ss-tag{
      font-size: 10px;
      font-weight: 800;
      padding: 2px 7px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.08);
      background: rgba(255,255,255,.04);
      color: var(--muted);
    }
    .ss-tag.good{ color: var(--good); border-color: rgba(155,212,255,.35); }
    .ss-tag.bad{ color: var(--bad); border-color: rgba(255,155,155,.35); }
    .ss-tag.neutral{ color: var(--neutral); border-color: rgba(201,205,219,.35); }

    .ss-body{
      margin-top: 6px;
      font-size: 11.4px;
      color: var(--muted);
      line-height: 1.5;
      white-space: pre-line;
    }

    .ss-inline-list{
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }
    .ss-inline-badge{
      padding: 3px 8px;
      border-radius: 999px;
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.08);
      font-size: 10.5px;
      font-weight: 800;
      color: var(--accent-2);
    }

    .ss-inline-badge.child{
      border-style: dashed;
      opacity: .9;
    }


    @media (max-width: 560px){
      .tabs{ grid-template-columns: 1fr 1fr 1fr; }
    }
    @media (max-width: 480px){
      .actions{ grid-template-columns: 1fr; }
      .quick{ grid-template-columns: 1fr 1fr; }
      .row, .year-select-row{ grid-template-columns: 60px 1fr 60px; }
      .compare-grid{ grid-template-columns: 1fr; }
      .ss-filter-row{ grid-template-columns: 1fr 1fr; }
    }

    /* v10.4: è‡ªåŠ¨åˆ¤å®šç¼ºå£æç¤º */
    .ss-missing{
      margin-top: 8px;
      border: 1px dashed rgba(255,255,255,0.12);
      border-radius: 12px;
      padding: 8px 10px;
      background: rgba(255,255,255,0.02);
    }
    .ss-missing summary{
      cursor: pointer;
      font-size: 12.5px;
      opacity: .9;
      user-select: none;
    }
    .ss-missing-hint{
      margin: 6px 0 8px;
      font-size: 11.5px;
      opacity: .7;
      line-height: 1.45;
    }
    .ss-missing-list{
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }
    .ss-miss-badge{
      font-size: 11px;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(255,255,255,0.05);
      opacity: .95;
    }

    /* v11.0: å°å„¿å…³ç…ç¼ºå£æç¤ºå¾®è°ƒ */
    .ss-missing--child{
      border-color: rgba(255,255,255,0.08);
    }
  /* v11.7b: åº•éƒ¨å¯¼èˆªï¼ˆç§»åŠ¨ç«¯ï¼‰ */
@media (max-width: 720px){
  body{
    padding-bottom: 76px; /* é¢„ç•™åº•éƒ¨æ ç©ºé—´ */
  }
  .container{
    padding-bottom: 8px;
  }
  .tabs{
    position: fixed;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: 999;
    display: flex !important;
    justify-content: space-around;
    align-items: center;
    gap: 0;
    padding: 10px 8px calc(10px + env(safe-area-inset-bottom));
    background: rgba(10,12,18,0.92);
    backdrop-filter: blur(10px);
    border-top: 1px solid rgba(255,255,255,0.06);
    margin: 0;
  }
  .tab-btn{
    flex: 1 1 0;
    margin: 0 4px;
    padding: 8px 6px;
    border-radius: 10px;
    font-size: 10.8px;
    font-weight: 800;
    letter-spacing: .2px;
    background: transparent;
    border: 1px solid transparent;
    opacity: .72;
    transform: none;
  }
  .tab-btn.active{
    opacity: 1;
    background: rgba(255,255,255,0.06);
    border-color: rgba(255,255,255,0.10);
  }
  .tab-btn:hover{
    filter: none;
    transform: none;
  }
  /* è®©é¡¶éƒ¨æ ‡é¢˜ä¸å‰¯æ ‡é¢˜åœ¨æ‰‹æœºä¸Šæ›´ç´§å‡‘ */
  .title{ font-size: 20px; }
  .subtitle{ font-size: 11.6px; }
}

.ss-hit-tag{
  display: inline-block;
  margin-left: 4px;
  padding: 0 6px;
  border-radius: 999px;
  font-size: 9.2px;
  font-weight: 700;
  color: var(--muted);
  background: rgba(255,255,255,.06);
  border: 1px solid rgba(255,255,255,.08);
  vertical-align: 1px;
}
.ss-inline-badge.child .ss-hit-tag{
  border-style: dashed;
}

/* v11.7b: å‘½ä¸­å±•å¼€è¯¦æƒ…å¼¹å±‚ï¼ˆå®‰å…¨ç‰ˆï¼Œä¸è§¦ç¢°åˆå§‹åŒ–é“¾ï¼‰ */
.ss-detail-overlay{
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.55);
  backdrop-filter: blur(6px);
  display: none;
  align-items: flex-end;
  justify-content: center;
  z-index: 1200;
}
.ss-detail-overlay.show{ display: flex; }

.ss-detail-card{
  width: min(720px, 100%);
  background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
  border: 1px solid rgba(255,255,255,.08);
  border-bottom: none;
  border-radius: 16px 16px 0 0;
  padding: 14px 14px 18px;
  box-shadow: 0 -12px 40px rgba(0,0,0,.35);
  max-height: 78vh;
  overflow: auto;
}
.ss-detail-head{
  display:flex;
  align-items:center;
  justify-content: space-between;
  gap: 8px;
  padding-bottom: 10px;
  border-bottom: 1px solid rgba(255,255,255,.06);
  margin-bottom: 10px;
}
.ss-detail-title{
  font-size: 16px;
  font-weight: 800;
  letter-spacing: .2px;
}
.ss-detail-sub{
  font-size: 11px;
  color: var(--muted);
  margin-top: 2px;
}
.ss-detail-close{
  cursor:pointer;
  padding: 6px 10px;
  border-radius: 10px;
  font-size: 11px;
  font-weight: 700;
  border: 1px solid rgba(255,255,255,.08);
  background: rgba(255,255,255,.04);
}
.ss-detail-row{
  padding: 8px 2px;
  border-bottom: 1px dashed rgba(255,255,255,.06);
}
.ss-detail-row:last-child{ border-bottom: none; }
.ss-detail-label{
  font-size: 10.5px;
  color: var(--muted);
  letter-spacing: .2px;
  margin-bottom: 4px;
}
.ss-detail-value{
  font-size: 12.6px;
  line-height: 1.45;
}

/* v11.12b: è¯¦æƒ…å¡ç‰‡è·³è½¬å­¦ä¹ è¡¨æŒ‰é’®ï¼ˆå®‰å…¨è¿½åŠ ï¼‰ */
.ss-detail-actions{
  display:flex;
  gap: 8px;
  padding-top: 10px;
}
.ss-detail-link{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  gap: 6px;
  padding: 8px 10px;
  border-radius: 10px;
  font-size: 11px;
  font-weight: 800;
  cursor: pointer;
  border: 1px solid rgba(255,255,255,.08);
  background: rgba(255,255,255,.05);
}
.pulse-highlight{
  outline: 2px solid rgba(216,182,92,.55);
  box-shadow: 0 0 0 4px rgba(216,182,92,.12);
  transition: box-shadow .2s ease, outline .2s ease;
}

/* v11.12b: å­¦ä¹ è¡¨ â†’ ä¸€é”®è¯•ç›˜ */
.ss-learn-to-pan{
  margin-left: auto;
  padding: 3px 8px;
  border-radius: 9px;
  font-size: 10px;
  font-weight: 800;
  cursor: pointer;
  border: 1px solid rgba(255,255,255,.08);
  background: rgba(255,255,255,.05);
  opacity: .9;
}
.ss-learn-to-pan:hover{ opacity: 1; }

.ss-pan-hint{
  margin-top: 8px;
  padding: 8px 10px;
  border-radius: 10px;
  font-size: 11.5px;
  font-weight: 700;
  border: 1px solid rgba(255,255,255,.08);
  background: rgba(255,255,255,.06);
}

</style>
</head>
<body>
  <div class="container">
    <h1 class="title">ğŸ”® å…«å­—æ’ç›˜å°å·¥å…· v11.12b</h1>
    <p class="subtitle">
      åœ¨ v5 çš„åŸºç¡€ä¸Šæ–°å¢ï¼š<b>é»„å†/ä¸‡å¹´å†</b> ä¸ <b>ç¥ç…å­¦ä¹ é¡µ</b>ï¼›æ’ç›˜é¡µå¢åŠ â€œç¥ç…ï¼ˆè¯•è¡Œç‰ˆï¼‰â€ã€‚<br/>
      ç¥ç…è‡ªåŠ¨åˆ¤å®šå·²æ‰©å±•ä¸º<strong>â€œåœ°æ”¯ç»„åˆæ³• + éƒ¨åˆ†å¹²æ”¯/æ—¥æŸ±è§„åˆ™â€</strong>ï¼šæ¡ƒèŠ± / é©¿é©¬ / åç›– / å°†æ˜Ÿï¼Œä»¥åŠæ–‡æ˜Œã€å¤©ä¹™ã€å›½å°ã€å¤ªæã€ç¦„ç¥ã€ç¾Šåˆƒã€é£åˆƒã€è¡€åˆƒã€çº¢é¸¾ã€å¤©å–œã€å…­åˆã€é­ç½¡ã€åæ¶å¤§è´¥ã€å­¤é¸¾ã€é˜´é˜³å·®é”™ç­‰ã€‚æœªè¦†ç›–è€…ä»ä¿ç•™å­¦ä¹ è¡¨ï¼Œåç»­å¯ç»§ç»­è¡¥é½ã€‚<br/>
      *æœ¬å·¥å…·ç”¨äºå­¦ä¹ ä¸æ—¥å¸¸å‚è€ƒï¼Œç¥ç…ä¸å–œç”¨çš†éå•ç‚¹å®šè®ºã€‚
    </p>

    <div class="tabs">
      <div class="tab-btn active" id="tabBazi">æ’ç›˜</div>
      <div class="tab-btn" id="tabJieqi">èŠ‚æ°”</div>
      <div class="tab-btn" id="tabLuck">è¿åŠ¿</div>
      <div class="tab-btn" id="tabAlmanac">é»„å†</div>
      <div class="tab-btn" id="tabShenSha">ç¥ç…</div>
    </div>

    <!-- æ’ç›˜é¢æ¿ -->
    <div class="panel active" id="panelBazi">
      <div class="picker">
        <div class="mode-row">
          <div class="mode-pill active" id="solarModeBtn">å…¬å†è¾“å…¥</div>
          <div class="mode-pill" id="lunarModeBtn">å†œå†è¾“å…¥</div>
        </div>

        <div class="row">
          <span class="label" id="yearLabel">å…¬å†å¹´</span>
          <input type="range" id="yearRange" />
          <span class="value" id="yearVal"></span>
        </div>

        <div class="row">
          <span class="label" id="monthLabel">å…¬å†æœˆ</span>
          <input type="range" id="monthRange" />
          <span class="value" id="monthVal"></span>
        </div>

        <div class="leap-row" id="leapRow">
          <span class="label">é—°æœˆ</span>
          <label class="toggle">
            <input type="checkbox" id="leapToggle" />
            <span>è‹¥è¯¥å¹´æœ‰é—°æ­¤æœˆæ‰æœ‰æ•ˆ</span>
          </label>
        </div>

        <div class="row">
          <span class="label" id="dayLabel">å…¬å†æ—¥</span>
          <input type="range" id="dayRange" />
          <span class="value" id="dayVal"></span>
        </div>

        <div class="row">
          <span class="label">å°æ—¶</span>
          <input type="range" id="hourRange" />
          <span class="value" id="hourVal"></span>
        </div>

        <div class="row" id="minuteRow" style="display:none;">
          <span class="label">åˆ†é’Ÿ</span>
          <input type="range" id="minuteRange" />
          <span class="value" id="minuteVal"></span>
        </div>

        <div class="leap-row" id="minuteToggleRow" style="display:grid;">
          <span class="label">ç²¾ç»†</span>
          <label class="toggle">
            <input type="checkbox" id="minuteToggle" />
            <span>å¼€å¯åˆ†é’Ÿæ»‘æ¡</span>
          </label>
        </div>

        
        <div class="section" id="genderPickSection">
          <div class="section-title">æ€§åˆ«ï¼ˆç”¨äºå¤§è¿æ–¹å‘/éƒ¨åˆ†ç¥ç…ï¼‰</div>
          <div class="mode-row" style="grid-template-columns:1fr 1fr;">
            <div class="mode-pill active" id="pickMaleBtn">ç”·</div>
            <div class="mode-pill" id="pickFemaleBtn">å¥³</div>
          </div>
          <div class="small-note">æ­¤å¤„é€‰æ‹©ä¼šåŒæ­¥åˆ°â€œæ—ºè¡°Â·è¿åŠ¿â€çš„æ€§åˆ«å‚æ•°ã€‚</div>
        </div>


<div class="section" id="adultStrengthSection">
  <div class="section-title">æˆäººç¥ç…åˆ¤å®šå¼ºåº¦</div>
  <div class="mode-row" style="grid-template-columns:1fr 1fr 1fr;">
    <div class="mode-pill" id="pickStrictBtn" data-level="strict">ä¸¥æ ¼</div>
    <div class="mode-pill active" id="pickBalancedBtn" data-level="balanced">æ ‡å‡†</div>
    <div class="mode-pill" id="pickLooseBtn" data-level="loose">å®½æ¾</div>
  </div>
  <div class="small-note">ä¸¥æ ¼ï¼šéšè—æç¤ºå‹/ç®€åŒ–å£å¾„ï¼ˆå­¦å ‚ã€è¯é¦†ã€ä¸‰å¥‡è´µäººã€ç§‘ç”²æ˜Ÿï¼‰ã€‚æ ‡å‡†ï¼šé»˜è®¤æ¨èã€‚å®½æ¾ï¼šç”¨äºå¯¹ç…§æ°‘é—´å£å¾„ã€‚</div>
</div>

<div class="quick">
          <div class="pill" id="nowPill">å½“å‰æ—¶é—´</div>
          <div class="pill" id="linxiPill">æ—æ›¦é¢„è®¾</div>
          <div class="pill" id="yaoPill">æ›œé¢„è®¾</div>
        </div>

        <div class="actions">
          <button class="btn" id="calcBtn">å¼€å§‹æ’ç›˜</button>
          <button class="btn secondary" id="copyBtn" disabled>å¤åˆ¶ç»“æœ</button>
        </div>

        <div class="actions">
          <button class="btn secondary" id="setABtn">è®¾ä¸º A ç›˜</button>
          <button class="btn secondary" id="compareBtn">ç”¨å½“å‰ä½œ B ç›˜å¯¹ç…§</button>
        </div>

        <div class="small-note" id="pickedText"></div>
        <div class="small-note" id="crossText"></div>
      </div>

      <div id="result" class="result-box" aria-live="polite">
        <div class="info" id="lunarInfo"></div>

        <div class="section">
          <div class="section-title">èŠ‚æ°”ï¼ˆå½“å‰ / ä¸Šä¸€ / ä¸‹ä¸€ï¼‰</div>
          <div class="jieqi-line" id="jieqiLine"></div>
        </div>

        <div class="section">
          <div class="section-title">å››æŸ±</div>
          <div class="bazi-grid">
            <div class="pillar">
              <span class="p-label">å¹´æŸ±</span>
              <span class="gan" id="yearGan"></span>
              <span class="zhi" id="yearZhi"></span>
              <div class="sub" id="yearSub"></div>
            </div>
            <div class="pillar">
              <span class="p-label">æœˆæŸ±</span>
              <span class="gan" id="monthGan"></span>
              <span class="zhi" id="monthZhi"></span>
              <div class="sub" id="monthSub"></div>
            </div>
            <div class="pillar">
              <span class="p-label">æ—¥æŸ±</span>
              <span class="gan" id="dayGan"></span>
              <span class="zhi" id="dayZhi"></span>
              <div class="sub" id="daySub"></div>
            </div>
            <div class="pillar">
              <span class="p-label">æ—¶æŸ±</span>
              <span class="gan" id="timeGan"></span>
              <span class="zhi" id="timeZhi"></span>
              <div class="sub" id="timeSub"></div>
            </div>
          </div>
        </div>

        <div class="section">
          <div class="section-title">ç¥ç…ï¼ˆè‡ªåŠ¨åˆ¤å®š Â· æ‰©å±•ç‰ˆï¼‰</div>
          <div class="jieqi-line" id="ssInlineResult"></div>
          <!-- v10.4: å­¦ä¹ è¡¨æœªè‡ªåŠ¨åŒ–æ¡ç›®æç¤º -->
          <details class="ss-missing" id="ssMissingBox">
            <summary>æŸ¥çœ‹å­¦ä¹ è¡¨ä¸­å°šæœªè‡ªåŠ¨åŒ–çš„æˆäººç¥ç…æ¸…å•</summary>
            <div class="ss-missing-hint">è¿™äº›æ¡ç›®å·²æ”¶å½•åœ¨â€œç¥ç…å­¦ä¹ è¡¨â€ï¼Œä½†å°šæœªå†™å…¥è‡ªåŠ¨åˆ¤å®šè§„åˆ™ã€‚ä½ åç»­è‹¥æƒ³ç»§ç»­æ‰©å±•ï¼Œæˆ‘ä¼šæŒ‰â€œæŸ¥æ³•æ¸…æ™°åº¦â€åˆ†æ‰¹åŠ å…¥ã€‚</div>
            <div id="ssMissingList" class="ss-missing-list"></div>
          </details>
          <!-- v11.0: å°å„¿å…³ç…æœªè‡ªåŠ¨åŒ–æ¡ç›®æç¤º -->
          <details class="ss-missing ss-missing--child" id="cgMissingBox">
            <summary>æŸ¥çœ‹å­¦ä¹ è¡¨ä¸­å°šæœªè‡ªåŠ¨åŒ–çš„å°å„¿å…³ç…æ¸…å•</summary>
            <div class="ss-missing-hint">è¿™äº›æ¡ç›®å·²æ”¶å½•åœ¨â€œå°å„¿å…³ç…å­¦ä¹ è¡¨â€ï¼Œä½†å°šæœªå†™å…¥æ’ç›˜é¡µè‡ªåŠ¨æç¤ºè§„åˆ™ã€‚</div>
            <div id="cgMissingList" class="ss-missing-list"></div>
          </details>
          <div class="small-note">å·²å†…ç½®è‡ªåŠ¨åˆ¤å®šï¼šæ¡ƒèŠ± / é©¿é©¬ / åç›– / å°†æ˜Ÿ + éƒ¨åˆ†å¹²æ”¯/æ—¥æŸ±ç±»ï¼ˆæ–‡æ˜Œã€å¤©ä¹™ã€å›½å°ã€å¤ªæã€ç¦„ç¥ã€ç¾Šåˆƒã€é£åˆƒã€è¡€åˆƒã€çº¢é¸¾ã€å¤©å–œã€å…­åˆã€é­ç½¡ã€åæ¶å¤§è´¥ã€å­¤é¸¾ã€é˜´é˜³å·®é”™ã€åœ°æ‰«æ˜Ÿã€å…«è´¥ã€æµéœã€é“æ¿ã€é“æ‰«æŠŠã€åŸ‹å„¿ç…ç­‰ï¼‰+ å°å„¿å…³ç…çš„éƒ¨åˆ†æ—¶è¾°/æœˆä»½/æ—¥å¹²è§„åˆ™ï¼ˆçŸ­å‘½å…³ã€å››æŸ±å…³ã€é›·å…¬æ‰“è„‘å…³ã€é‡‘é”å…³ã€æ— æƒ…å…³ã€äº”é¬¼å…³ã€å¤©ç‹—å…³ã€æ–­æ¡¥å…³ï¼‰ã€‚å…¶ä½™ä»ä»¥â€œç¥ç…â€é¡µå­¦ä¹ è¡¨ä¸ºå‡†ã€‚</div>
        </div>

        <div class="compare-box" id="compareBox">
          <div class="compare-title">
            <span>å¯¹ç…§ç›˜ï¼ˆA vs Bï¼‰</span>
            <button class="btn secondary" id="clearCompareBtn" style="padding:6px 10px; font-size:11px; border-radius:10px;">æ¸…ç©ºAç›˜</button>
          </div>
          <div class="compare-grid">
            <div class="compare-card">
              <div class="tag">A ç›˜</div>
              <div class="line" id="compareALine"></div>
              <div class="meta" id="compareAMeta"></div>
            </div>
            <div class="compare-card">
              <div class="tag">B ç›˜</div>
              <div class="line" id="compareBLine"></div>
              <div class="meta" id="compareBMeta"></div>
            </div>
          </div>
        </div>

        <div class="copy-hint" id="tzHint"></div>
      </div>
    </div>

    <!-- èŠ‚æ°”æŸ¥è¯¢é¢æ¿ -->
    <div class="panel" id="panelJieqi">
      <div class="jieqi-query">
        <div class="year-select-row">
          <span class="label">å¹´ä»½</span>
          <input type="range" id="jieqiYearRange" />
          <span class="value" id="jieqiYearVal"></span>
        </div>
        <div class="actions">
          <button class="btn" id="jieqiQueryBtn">æŸ¥è¯¢è¯¥å¹´äºŒåå››èŠ‚æ°”</button>
          <button class="btn secondary" id="jieqiCopyBtn" disabled>å¤åˆ¶åˆ—è¡¨</button>
        </div>
        <div class="small-note" id="jieqiQueryHint"></div>
        <div class="jieqi-list" id="jieqiList"></div>
      </div>
    </div>

    <!-- æ—ºè¡°Â·è¿åŠ¿é¢æ¿ -->
    <div class="panel" id="panelLuck">
      <div class="luck-panel">
        <div class="luck-mode-row">
          <div class="luck-pill active" id="luckWsPill">èº«å¼ºå¼±Â·å–œç”¨</div>
          <div class="luck-pill" id="luckFlowPill">æµå¹´Â·å¤§è¿</div>
        </div>

        <div class="luck-box active" id="wsBox">
          <div class="section-title">åŸºäºå½“å‰æ’ç›˜æ—¶é—´ï¼ˆä¸â€œæ’ç›˜â€é¡µä¸€è‡´ï¼‰</div>
          <div class="actions">
            <button class="btn" id="wsCalcBtn">è®¡ç®—æ—ºè¡°ä¸å–œç”¨</button>
            <button class="btn secondary" id="wsCopyBtn" disabled>å¤åˆ¶è¯´æ˜</button>
          </div>
          <div class="small-note">ç®—æ³•ä¸ºâ€œç®€åŒ–å­å¹³æ—ºè¡°æƒé‡æ¨¡å‹â€ï¼Œå¼ºè°ƒå¯è§£é‡Šä¸å­¦ä¹ å¯¹ç…§ã€‚</div>

          <div class="section" id="wsResult" style="display:none;">
            <div class="section-title">ç»“è®º</div>
            <div class="jieqi-line" id="wsConclusion"></div>
            <div class="explain" id="wsExplain"></div>
          </div>
        </div>

        <div class="luck-box" id="flowBox">
          <div class="section-title">æµå¹´é¢„è§ˆï¼ˆé»˜è®¤è¿‘åå¹´ï¼‰</div>
          <div class="year-select-row">
            <span class="label">åŸºå‡†å¹´</span>
            <input type="range" id="flowYearRange" />
            <span class="value" id="flowYearVal"></span>
          </div>
          <div class="actions">
            <button class="btn" id="flowCalcBtn">ç”Ÿæˆæµå¹´åˆ—è¡¨</button>
            <button class="btn secondary" id="flowCopyBtn" disabled>å¤åˆ¶æµå¹´</button>
          </div>

          <div class="section">
            <div class="section-title">æ€§åˆ«ï¼ˆä»…ç”¨äºå°è¯•è°ƒç”¨åº“çš„å¤§è¿æ¥å£ï¼‰</div>
            <div class="mode-row" style="grid-template-columns:1fr 1fr;">
              <div class="mode-pill active" id="maleBtn">ç”·</div>
              <div class="mode-pill" id="femaleBtn">å¥³</div>
            </div>
            <div class="small-note">åªç”¨äºåº“çš„å¤§è¿å‚æ•°ï¼›æµå¹´åˆ—è¡¨ä¸å—å½±å“ã€‚</div>
          </div>

          <div class="section">
            <div class="section-title">æµå¹´åˆ—è¡¨</div>
            <div class="luck-list" id="flowList"></div>
          </div>

          <div class="section">
            <div class="section-title">å¤§è¿ï¼ˆå®éªŒæ€§ï¼‰</div>
            <div class="small-note" id="dayunHint">å°è¯•è°ƒç”¨ lunar-javascript çš„ Yun/DaYun æ¥å£ï¼›è‹¥åº“ç‰ˆæœ¬ä¸å«è¿™äº›æ–¹æ³•ï¼Œè¿™é‡Œä¼šæ˜¾ç¤ºâ€œä¸å¯ç”¨â€ã€‚</div>
            <div class="luck-list" id="dayunList"></div>
            <div class="small-note" id="dayunExplain"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- é»„å† / ä¸‡å¹´å† -->
    <div class="panel" id="panelAlmanac">
      <div class="almanac-panel">
        <div class="almanac-row">
          <span class="label" style="color:#8b90a1; font-size:12px;">é€‰æ‹©æ—¥æœŸ</span>
          <input class="date-input" type="date" id="almanacDate" />
        </div>

        <div class="actions">
          <button class="btn" id="almanacTodayBtn">ä»Šå¤©</button>
          <button class="btn secondary" id="almanacCopyBtn" disabled>å¤åˆ¶é»„å†</button>
        </div>

        <div class="section" id="almanacResult" style="display:none;">
          <div class="section-title">å½“æ—¥ä¿¡æ¯</div>
          <div class="almanac-kv" id="almanacKV"></div>
        </div>

        <div class="section" id="almanacYiJiSec" style="display:none;">
          <div class="section-title">å®œ / å¿Œï¼ˆè‹¥åº“æ”¯æŒï¼‰</div>
          <div class="almanac-kv" id="almanacYiJi"></div>
        </div>

        <div class="small-note">é»„å†ä¿¡æ¯ä¼˜å…ˆè¯»å–åº“å­—æ®µï¼›è‹¥ä½ çœ‹è§â€œâ€”â€ï¼Œè¯´æ˜å½“å‰ CDN ç‰ˆæœ¬æœªæš´éœ²è¯¥æ¥å£ã€‚</div>
      </div>
    </div>

    <!-- ç¥ç…å­¦ä¹ é¡µ -->
    <div class="panel" id="panelShenSha">
      <div class="shensha-panel">
        <div class="search-row">
          <input class="search-input" id="ssSearch" placeholder="æœç´¢ç¥ç…å…³é”®è¯ï¼ˆåç§°/ä½œç”¨/æŸ¥æ³•ï¼‰" />
          <div class="ss-filter-row">
            <div class="ss-pill active" id="ssFilterAll">å…¨éƒ¨</div>
            <div class="ss-pill" id="ssFilterCommon">å¸¸ç”¨</div>
            <div class="ss-pill" id="ssFilterChild">å°å„¿å…³ç…</div>
          </div>
        </div>

        <div class="actions">
          <button class="btn secondary" id="ssCopyListBtn">å¤åˆ¶å½“å‰åˆ—è¡¨</button>
          <button class="btn secondary" id="ssJumpExplainBtn">çœ‹â€œè¯•è¡Œç‰ˆè§„åˆ™è¯´æ˜â€</button>
        </div>

        <div class="section" id="ssRuleExplain" style="display:none;">
          <div class="section-title">æ’ç›˜é¡µâ€œè¯•è¡Œç‰ˆâ€è‡ªåŠ¨åˆ¤å®šè§„åˆ™</div>
          <div class="explain" id="ssRuleText"></div>
        </div>

        <div class="ss-list" id="ssList"></div>
      </div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

<script>
  /* ===================== åŸºç¡€å¼•ç”¨ ===================== */
  const els = {
    tabBazi: document.getElementById('tabBazi'),
    tabJieqi: document.getElementById('tabJieqi'),
    tabLuck: document.getElementById('tabLuck'),
    tabAlmanac: document.getElementById('tabAlmanac'),
    tabShenSha: document.getElementById('tabShenSha'),

    panelBazi: document.getElementById('panelBazi'),
    panelJieqi: document.getElementById('panelJieqi'),
    panelLuck: document.getElementById('panelLuck'),
    panelAlmanac: document.getElementById('panelAlmanac'),
    panelShenSha: document.getElementById('panelShenSha'),

    solarModeBtn: document.getElementById('solarModeBtn'),
    lunarModeBtn: document.getElementById('lunarModeBtn'),

    yearLabel: document.getElementById('yearLabel'),
    monthLabel: document.getElementById('monthLabel'),
    dayLabel: document.getElementById('dayLabel'),

    yearRange: document.getElementById('yearRange'),
    monthRange: document.getElementById('monthRange'),
    dayRange: document.getElementById('dayRange'),
    hourRange: document.getElementById('hourRange'),
    minuteRange: document.getElementById('minuteRange'),

    yearVal: document.getElementById('yearVal'),
    monthVal: document.getElementById('monthVal'),
    dayVal: document.getElementById('dayVal'),
    hourVal: document.getElementById('hourVal'),
    minuteVal: document.getElementById('minuteVal'),

    leapRow: document.getElementById('leapRow'),
    leapToggle: document.getElementById('leapToggle'),

    minuteRow: document.getElementById('minuteRow'),
    minuteToggle: document.getElementById('minuteToggle'),

    nowPill: document.getElementById('nowPill'),
    linxiPill: document.getElementById('linxiPill'),
    yaoPill: document.getElementById('yaoPill'),

    calcBtn: document.getElementById('calcBtn'),
    copyBtn: document.getElementById('copyBtn'),

    setABtn: document.getElementById('setABtn'),
    compareBtn: document.getElementById('compareBtn'),
    clearCompareBtn: document.getElementById('clearCompareBtn'),

    pickedText: document.getElementById('pickedText'),
    crossText: document.getElementById('crossText'),

    result: document.getElementById('result'),
    lunarInfo: document.getElementById('lunarInfo'),
    tzHint: document.getElementById('tzHint'),

    jieqiLine: document.getElementById('jieqiLine'),

    yearGan: document.getElementById('yearGan'),
    yearZhi: document.getElementById('yearZhi'),
    monthGan: document.getElementById('monthGan'),
    monthZhi: document.getElementById('monthZhi'),
    dayGan: document.getElementById('dayGan'),
    dayZhi: document.getElementById('dayZhi'),
    timeGan: document.getElementById('timeGan'),
    timeZhi: document.getElementById('timeZhi'),

    yearSub: document.getElementById('yearSub'),
    monthSub: document.getElementById('monthSub'),
    daySub: document.getElementById('daySub'),
    timeSub: document.getElementById('timeSub'),

    ssInlineResult: document.getElementById('ssInlineResult'),

    compareBox: document.getElementById('compareBox'),
    compareALine: document.getElementById('compareALine'),
    compareAMeta: document.getElementById('compareAMeta'),
    compareBLine: document.getElementById('compareBLine'),
    compareBMeta: document.getElementById('compareBMeta'),

    jieqiYearRange: document.getElementById('jieqiYearRange'),
    jieqiYearVal: document.getElementById('jieqiYearVal'),
    jieqiQueryBtn: document.getElementById('jieqiQueryBtn'),
    jieqiCopyBtn: document.getElementById('jieqiCopyBtn'),
    jieqiQueryHint: document.getElementById('jieqiQueryHint'),
    jieqiList: document.getElementById('jieqiList'),

    luckWsPill: document.getElementById('luckWsPill'),
    luckFlowPill: document.getElementById('luckFlowPill'),
    wsBox: document.getElementById('wsBox'),
    flowBox: document.getElementById('flowBox'),

    wsCalcBtn: document.getElementById('wsCalcBtn'),
    wsCopyBtn: document.getElementById('wsCopyBtn'),
    wsResult: document.getElementById('wsResult'),
    wsConclusion: document.getElementById('wsConclusion'),
    wsExplain: document.getElementById('wsExplain'),

    flowYearRange: document.getElementById('flowYearRange'),
    flowYearVal: document.getElementById('flowYearVal'),
    flowCalcBtn: document.getElementById('flowCalcBtn'),
    flowCopyBtn: document.getElementById('flowCopyBtn'),
    flowList: document.getElementById('flowList'),

    pickMaleBtn: document.getElementById('pickMaleBtn'),
    pickFemaleBtn: document.getElementById('pickFemaleBtn'),

    maleBtn: document.getElementById('maleBtn'),
    femaleBtn: document.getElementById('femaleBtn'),
    dayunHint: document.getElementById('dayunHint'),
    dayunList: document.getElementById('dayunList'),
    dayunExplain: document.getElementById('dayunExplain'),

    /* Almanac */
    almanacDate: document.getElementById('almanacDate'),
    almanacTodayBtn: document.getElementById('almanacTodayBtn'),
    almanacCopyBtn: document.getElementById('almanacCopyBtn'),
    almanacResult: document.getElementById('almanacResult'),
    almanacKV: document.getElementById('almanacKV'),
    almanacYiJiSec: document.getElementById('almanacYiJiSec'),
    almanacYiJi: document.getElementById('almanacYiJi'),

    /* ShenSha learning */
    ssSearch: document.getElementById('ssSearch'),
    ssFilterAll: document.getElementById('ssFilterAll'),
    ssFilterCommon: document.getElementById('ssFilterCommon'),
    ssFilterChild: document.getElementById('ssFilterChild'),
    ssList: document.getElementById('ssList'),
    ssCopyListBtn: document.getElementById('ssCopyListBtn'),
    ssJumpExplainBtn: document.getElementById('ssJumpExplainBtn'),
    ssRuleExplain: document.getElementById('ssRuleExplain'),
    ssRuleText: document.getElementById('ssRuleText'),

    toast: document.getElementById('toast')
  };

  const PRESETS_SOLAR = {
    linxi: { y: 1993, m: 1, d: 20, h: 20, min: 0 },
    yao:   { y: 2025, m: 5, d: 20, h: 20, min: 0 }
  };

  const MODE = { SOLAR: 'solar', LUNAR: 'lunar' };
  let currentMode = MODE.SOLAR;
  let compareA = null;

  let genderForYun = 1; // 1=ç”·, 0=å¥³

  /* ===== äº”è¡Œåç¥åŸºç¡€ ===== */
  const GAN_INFO = {
    'ç”²': { e:'æœ¨', y:'é˜³' }, 'ä¹™': { e:'æœ¨', y:'é˜´' },
    'ä¸™': { e:'ç«', y:'é˜³' }, 'ä¸': { e:'ç«', y:'é˜´' },
    'æˆŠ': { e:'åœŸ', y:'é˜³' }, 'å·±': { e:'åœŸ', y:'é˜´' },
    'åºš': { e:'é‡‘', y:'é˜³' }, 'è¾›': { e:'é‡‘', y:'é˜´' },
    'å£¬': { e:'æ°´', y:'é˜³' }, 'ç™¸': { e:'æ°´', y:'é˜´' }
  };
  const GEN_NEXT = { 'æœ¨':'ç«', 'ç«':'åœŸ', 'åœŸ':'é‡‘', 'é‡‘':'æ°´', 'æ°´':'æœ¨' };
  const GEN_PREV = { 'æœ¨':'æ°´', 'ç«':'æœ¨', 'åœŸ':'ç«', 'é‡‘':'åœŸ', 'æ°´':'é‡‘' };
  const CONTROL = { 'æœ¨':'åœŸ', 'ç«':'é‡‘', 'åœŸ':'æ°´', 'é‡‘':'æœ¨', 'æ°´':'ç«' };
  const CONTROLLED_BY = { 'æœ¨':'é‡‘', 'ç«':'æ°´', 'åœŸ':'æœ¨', 'é‡‘':'ç«', 'æ°´':'åœŸ' };

  const ZHI_HIDE_FALLBACK = {
    'å­':'ç™¸','ä¸‘':'å·±ç™¸è¾›','å¯…':'ç”²ä¸™æˆŠ','å¯':'ä¹™',
    'è¾°':'æˆŠä¹™ç™¸','å·³':'ä¸™æˆŠåºš','åˆ':'ä¸å·±','æœª':'å·±ä¸ä¹™',
    'ç”³':'åºšå£¬æˆŠ','é…‰':'è¾›','æˆŒ':'æˆŠè¾›ä¸','äº¥':'å£¬ç”²'
  };

  const JIEQI_ORDER = [
    "å°å¯’","å¤§å¯’","ç«‹æ˜¥","é›¨æ°´","æƒŠè›°","æ˜¥åˆ†","æ¸…æ˜","è°·é›¨",
    "ç«‹å¤","å°æ»¡","èŠ’ç§","å¤è‡³","å°æš‘","å¤§æš‘","ç«‹ç§‹","å¤„æš‘",
    "ç™½éœ²","ç§‹åˆ†","å¯’éœ²","éœœé™","ç«‹å†¬","å°é›ª","å¤§é›ª","å†¬è‡³"
  ];

  /* ===================== å·¥å…·å‡½æ•° ===================== */
  function ensureLunarLib(){
    return typeof Solar !== 'undefined' && typeof Lunar !== 'undefined';
  }
  function showToast(text){
    els.toast.textContent = text;
    els.toast.classList.add('show');
    clearTimeout(showToast._t);
    showToast._t = setTimeout(() => els.toast.classList.remove('show'), 1200);
  }
  function pad2(n){ return String(n).padStart(2,'0'); }
  function getTZ(){ return Intl.DateTimeFormat().resolvedOptions().timeZone || 'Local'; }
  function fmtMD(date){ return `${date.getMonth()+1}æœˆ${date.getDate()}æ—¥`; }
  function fmtYMD(date){ return `${date.getFullYear()}-${pad2(date.getMonth()+1)}-${pad2(date.getDate())}`; }
  function daysInSolarMonth(y, m){ return new Date(y, m, 0).getDate(); }

  function daysInLunarMonth(y, m, isLeap){
    try{
      if(typeof Lunar === 'undefined') return 30;
      if(Lunar.fromYmdHms){
        const len = Lunar.fromYmdHms.length;
        let lunar = null;
        if(len >= 7){
          lunar = Lunar.fromYmdHms(y, m, 1, 0, 0, 0, !!isLeap);
        }else{
          lunar = Lunar.fromYmdHms(y, m, 1, 0, 0, 0);
        }
        if(lunar && typeof lunar.getMonthDays === 'function'){
          const d = lunar.getMonthDays();
          if(d >= 29 && d <= 30) return d;
        }
      }
      if(Lunar.fromYmd){
        const lunar = Lunar.fromYmd(y, m, 1);
        if(lunar && typeof lunar.getMonthDays === 'function'){
          const d = lunar.getMonthDays();
          if(d >= 29 && d <= 30) return d;
        }
      }
    }catch(e){}
    return 30;
  }

  function setActiveQuickPill(which){
    [els.nowPill, els.linxiPill, els.yaoPill].forEach(p => p.classList.remove('active'));
    if(which === 'now') els.nowPill.classList.add('active');
    if(which === 'linxi') els.linxiPill.classList.add('active');
    if(which === 'yao') els.yaoPill.classList.add('active');
  }

  function updateLabels(){
    if(currentMode === MODE.SOLAR){
      els.yearLabel.textContent = 'å…¬å†å¹´';
      els.monthLabel.textContent = 'å…¬å†æœˆ';
      els.dayLabel.textContent = 'å…¬å†æ—¥';
      els.leapRow.style.display = 'none';
    }else{
      els.yearLabel.textContent = 'å†œå†å¹´';
      els.monthLabel.textContent = 'å†œå†æœˆ';
      els.dayLabel.textContent = 'å†œå†æ—¥';
      els.leapRow.style.display = 'grid';
    }
  }
  function setActiveModePill(){
    els.solarModeBtn.classList.toggle('active', currentMode === MODE.SOLAR);
    els.lunarModeBtn.classList.toggle('active', currentMode === MODE.LUNAR);
  }

  function setRangesBounds(){
    els.yearRange.min = 1900; els.yearRange.max = 2100; els.yearRange.step = 1;
    els.monthRange.min = 1; els.monthRange.max = 12; els.monthRange.step = 1;
    els.hourRange.min = 0; els.hourRange.max = 23; els.hourRange.step = 1;
    els.minuteRange.min = 0; els.minuteRange.max = 59; els.minuteRange.step = 1;

    els.jieqiYearRange.min = 1900; els.jieqiYearRange.max = 2100; els.jieqiYearRange.step = 1;
    els.flowYearRange.min = 1900; els.flowYearRange.max = 2100; els.flowYearRange.step = 1;
  }

  function updateDayRange(){
    const y = Number(els.yearRange.value);
    const m = Number(els.monthRange.value);
    const isLeap = !!els.leapToggle.checked;

    let maxDay = 30;
    if(currentMode === MODE.SOLAR){
      maxDay = daysInSolarMonth(y, m);
    }else{
      maxDay = daysInLunarMonth(y, m, isLeap);
    }

    const currentDay = Number(els.dayRange.value || 1);

    els.dayRange.min = 1;
    els.dayRange.max = maxDay;
    els.dayRange.step = 1;

    if(currentDay > maxDay){
      els.dayRange.value = maxDay;
    }else if(!els.dayRange.value){
      els.dayRange.value = 1;
    }
  }

  function setFromSolarParts(p){
    els.yearRange.value = p.y;
    els.monthRange.value = p.m;
    updateDayRange();
    els.dayRange.value = Math.min(p.d, daysInSolarMonth(p.y, p.m));
    els.hourRange.value = p.h;
    els.minuteRange.value = p.min ?? 0;
    els.leapToggle.checked = false;
    updateDayRange();
    syncValueText();
  }

  function setFromLunarParts(p){
    els.yearRange.value = p.y;
    els.monthRange.value = p.m;
    els.leapToggle.checked = !!p.isLeap;
    updateDayRange();
    els.dayRange.value = Math.min(p.d, daysInLunarMonth(p.y, p.m, !!p.isLeap));
    els.hourRange.value = p.h;
    els.minuteRange.value = p.min ?? 0;
    updateDayRange();
    syncValueText();
  }

  function setFromDate(date){
    setFromSolarParts({
      y: date.getFullYear(),
      m: date.getMonth() + 1,
      d: date.getDate(),
      h: date.getHours(),
      min: date.getMinutes()
    });
  }

  function createLunarFromSliders(){
    const y = Number(els.yearRange.value);
    const m = Number(els.monthRange.value);
    const d = Number(els.dayRange.value);
    const h = Number(els.hourRange.value);
    const min = Number(els.minuteRange.value || 0);
    const isLeap = !!els.leapToggle.checked;

    try{
      if(Lunar.fromYmdHms){
        if(Lunar.fromYmdHms.length >= 7){
          return Lunar.fromYmdHms(y, m, d, h, min, 0, isLeap);
        }
        return Lunar.fromYmdHms(y, m, d, h, min, 0);
      }
      if(Lunar.fromYmd){
        return Lunar.fromYmd(y, m, d);
      }
    }catch(e){
      return null;
    }
    return null;
  }

  function convertSolarSlidersToLunarSliders(){
    if(!ensureLunarLib()) return;

    const y = Number(els.yearRange.value);
    const m = Number(els.monthRange.value);
    const d = Number(els.dayRange.value);
    const h = Number(els.hourRange.value);
    const min = Number(els.minuteRange.value || 0);

    try{
      const solar = Solar.fromYmdHms(y, m, d, h, min, 0);
      const lunar = solar.getLunar();

      const lunarMonth = typeof lunar.getMonth === 'function' ? lunar.getMonth() : m;
      const lunarDay = typeof lunar.getDay === 'function' ? lunar.getDay() : d;
      const lunarYear = typeof lunar.getYear === 'function' ? lunar.getYear() : y;
      const isLeap = typeof lunar.isLeap === 'function' ? lunar.isLeap() : false;

      setFromLunarParts({ y: lunarYear, m: lunarMonth, d: lunarDay, h: h, min, isLeap });

    }catch(e){
      setFromLunarParts({ y, m, d, h, min, isLeap: false });
    }
  }

  function convertLunarSlidersToSolarSliders(){
    if(!ensureLunarLib()) return;

    const lunar = createLunarFromSliders();
    if(!lunar) return;

    try{
      const solar = lunar.getSolar();
      setFromSolarParts({
        y: solar.getYear(),
        m: solar.getMonth(),
        d: solar.getDay(),
        h: solar.getHour(),
        min: solar.getMinute ? solar.getMinute() : Number(els.minuteRange.value || 0)
      });
    }catch(e){}
  }

  function switchMode(toMode){
    if(toMode === currentMode) return;

    if(toMode === MODE.LUNAR){
      convertSolarSlidersToLunarSliders();
    }else{
      convertLunarSlidersToSolarSliders();
    }

    currentMode = toMode;
    setActiveModePill();
    updateLabels();
    updateDayRange();
    syncValueText();
  }

  function getSelectedSolarParts(){
    if(currentMode === MODE.SOLAR){
      return {
        y: Number(els.yearRange.value),
        m: Number(els.monthRange.value),
        d: Number(els.dayRange.value),
        h: Number(els.hourRange.value),
        min: Number(els.minuteRange.value || 0)
      };
    }

    const lunar = createLunarFromSliders();
    if(lunar){
      const solar = lunar.getSolar();
      return {
        y: solar.getYear(),
        m: solar.getMonth(),
        d: solar.getDay(),
        h: solar.getHour(),
        min: solar.getMinute ? solar.getMinute() : Number(els.minuteRange.value || 0)
      };
    }

    return {
      y: Number(els.yearRange.value),
      m: Number(els.monthRange.value),
      d: Number(els.dayRange.value),
      h: Number(els.hourRange.value),
      min: Number(els.minuteRange.value || 0)
    };
  }

  /* ===================== åç¥ç›¸å…³ ===================== */
  function shiShenForGan(dayGan, otherGan){
    const dm = GAN_INFO[dayGan];
    const og = GAN_INFO[otherGan];
    if(!dm || !og) return '';

    const samePol = dm.y === og.y;
    if(dm.e === og.e) return samePol ? 'æ¯”è‚©' : 'åŠ«è´¢';
    if(GEN_NEXT[dm.e] === og.e) return samePol ? 'é£Ÿç¥' : 'ä¼¤å®˜';
    if(GEN_PREV[dm.e] === og.e) return samePol ? 'åå°' : 'æ­£å°';
    if(CONTROL[dm.e] === og.e) return samePol ? 'åè´¢' : 'æ­£è´¢';
    if(CONTROLLED_BY[dm.e] === og.e) return samePol ? 'ä¸ƒæ€' : 'æ­£å®˜';
    return '';
  }

  function hiddenGansForZhi(zhi){
    try{
      if(typeof LunarUtil !== 'undefined'){
        const map = LunarUtil.ZHI_HIDE_GAN || LunarUtil.ZHI_HIDE_GAN_MAP;
        if(map && map[zhi]){
          const v = map[zhi];
          if(Array.isArray(v)) return v.join('');
          return String(v).replace(/,/g,'');
        }
      }
    }catch(e){}
    return ZHI_HIDE_FALLBACK[zhi] || '';
  }

  function nayinForGanZhi(gz){
    try{
      if(typeof LunarUtil !== 'undefined'){
        const map = LunarUtil.NAYIN || LunarUtil.NAYIN_MAP;
        if(map && map[gz]) return map[gz];
      }
    }catch(e){}
    return '';
  }

  function shiShenForHidden(dayGan, hideStr){
    if(!hideStr) return '';
    const gans = hideStr.split('');
    const mapped = gans.map(g => {
      const ss = shiShenForGan(dayGan, g);
      return ss ? `${g}${ss}` : g;
    });
    return mapped.join(' ');
  }

  function buildPillarSub(dayGan, pillarGan, pillarZhi){
    const ss = shiShenForGan(dayGan, pillarGan);
    const hide = hiddenGansForZhi(pillarZhi);
    const hideSS = shiShenForHidden(dayGan, hide);
    const nayin = nayinForGanZhi(pillarGan + pillarZhi);

    const parts = [];
    if(ss) parts.push(`å¤©å¹²åç¥ï¼š<span class="hl">${ss}</span>`);
    if(hide) parts.push(`è—å¹²ï¼š${hide}`);
    if(hideSS) parts.push(`è—å¹²åç¥ï¼š<span class="hl2">${hideSS}</span>`);
    if(nayin) parts.push(`çº³éŸ³ï¼š${nayin}`);

    return parts.join('<br/>') || 'â€”';
  }

  /* ===================== èŠ‚æ°” ===================== */
  function jieQiNameForSolar(solar){
    try{
      if(solar && typeof solar.getJieQi === 'function'){
        const n = solar.getJieQi();
        if(n) return n;
      }
    }catch(e){}
    try{
      const lunar = solar ? solar.getLunar() : null;
      if(lunar && typeof lunar.getJieQi === 'function'){
        const n = lunar.getJieQi();
        if(n) return n;
      }
    }catch(e){}
    return '';
  }

  function findNextJieQi(date){
    for(let i=1;i<=80;i++){
      const d = new Date(date.getFullYear(), date.getMonth(), date.getDate()+i, 12, 0, 0);
      try{
        const s = Solar.fromYmdHms(d.getFullYear(), d.getMonth()+1, d.getDate(), 12, 0, 0);
        const name = jieQiNameForSolar(s);
        if(name){
          return { name, date: d, offset: i };
        }
      }catch(e){}
    }
    return null;
  }

  function findPrevJieQi(date){
    for(let i=1;i<=80;i++){
      const d = new Date(date.getFullYear(), date.getMonth(), date.getDate()-i, 12, 0, 0);
      try{
        const s = Solar.fromYmdHms(d.getFullYear(), d.getMonth()+1, d.getDate(), 12, 0, 0);
        const name = jieQiNameForSolar(s);
        if(name){
          return { name, date: d, offset: -i };
        }
      }catch(e){}
    }
    return null;
  }

  function renderJieQiSection(date){
    const line = [];
    let todayName = '';
    try{
      const s = Solar.fromYmdHms(date.getFullYear(), date.getMonth()+1, date.getDate(), 12, 0, 0);
      todayName = jieQiNameForSolar(s);
    }catch(e){}

    if(todayName){
      line.push(`<span class="jieqi-badge">ä»Šæ—¥èŠ‚æ°”ï¼š${todayName}</span>`);
    }else{
      line.push(`<span class="jieqi-badge">ä»Šæ—¥æ— èŠ‚æ°”ç‚¹</span>`);
    }

    const prev = findPrevJieQi(date);
    const next = findNextJieQi(date);

    if(prev){
      const abs = Math.abs(prev.offset);
      line.push(`ä¸Šä¸€èŠ‚æ°”ï¼š<b style="color:var(--accent-2)">${prev.name}</b> Â· ${fmtMD(prev.date)}ï¼ˆ${abs} å¤©å‰ï¼‰`);
    }else{
      line.push(`ä¸Šä¸€èŠ‚æ°”ï¼šæš‚æœªå®šä½`);
    }

    if(next){
      line.push(`ä¸‹ä¸€èŠ‚æ°”ï¼š<b style="color:var(--accent-2)">${next.name}</b> Â· ${fmtMD(next.date)}ï¼ˆ${next.offset} å¤©åï¼‰`);
    }else{
      line.push(`ä¸‹ä¸€èŠ‚æ°”ï¼šæš‚æœªå®šä½`);
    }

    line.push(`<span style="font-size:10.5px; color:#8b90a1;">èŠ‚æ°”æ—¥æœŸæŒ‰è®¾å¤‡æ—¶åŒºè¿‘ä¼¼å±•ç¤ºï¼ˆ${getTZ()}ï¼‰</span>`);
    els.jieqiLine.innerHTML = line.join('<br/>');
  }

  /* ===================== ç¥ç…ï¼ˆè¯•è¡Œç‰ˆè‡ªåŠ¨åˆ¤å®šï¼‰ ===================== */
  const GROUPS = {
    'ç”³å­è¾°': ['ç”³','å­','è¾°'],
    'å·³é…‰ä¸‘': ['å·³','é…‰','ä¸‘'],
    'å¯…åˆæˆŒ': ['å¯…','åˆ','æˆŒ'],
    'äº¥å¯æœª': ['äº¥','å¯','æœª']
  };

  // v10.4: å­¤è¾°/å¯¡å®¿ç­‰ä»¥å¹´æ”¯ä¸ºä¸»çš„åˆ†ç»„ï¼ˆå››åº“æ–¹å‘ï¼‰
  const YEAR_SOLITUDE_GROUPS = {
    'äº¥å­ä¸‘': ['äº¥','å­','ä¸‘'],
    'å¯…å¯è¾°': ['å¯…','å¯','è¾°'],
    'å·³åˆæœª': ['å·³','åˆ','æœª'],
    'ç”³é…‰æˆŒ': ['ç”³','é…‰','æˆŒ']
  };

  function findYearSolitudeGroup(yearZhi){
    if(!yearZhi) return null;
    for(const k of Object.keys(YEAR_SOLITUDE_GROUPS)){
      if(YEAR_SOLITUDE_GROUPS[k].includes(yearZhi)) return k;
    }
    return null;
  }

  const GUCHEN_YEAR_MAP = {
    'äº¥å­ä¸‘': 'å¯…',
    'å¯…å¯è¾°': 'å·³',
    'å·³åˆæœª': 'ç”³',
    'ç”³é…‰æˆŒ': 'äº¥'
  };

  const GUASU_YEAR_MAP = {
    'äº¥å­ä¸‘': 'æˆŒ',
    'å¯…å¯è¾°': 'ä¸‘',
    'å·³åˆæœª': 'è¾°',
    'ç”³é…‰æˆŒ': 'æœª'
  };


  const TAOHUA_MAP = {
    'ç”³å­è¾°': 'é…‰',
    'å·³é…‰ä¸‘': 'åˆ',
    'å¯…åˆæˆŒ': 'å¯',
    'äº¥å¯æœª': 'å­'
  };
  const YIMA_MAP = {
    'ç”³å­è¾°': 'å¯…',
    'å¯…åˆæˆŒ': 'ç”³',
    'äº¥å¯æœª': 'å·³',
    'å·³é…‰ä¸‘': 'äº¥'
  };
  const HUAGAI_MAP = {
    'ç”³å­è¾°': 'è¾°',
    'å¯…åˆæˆŒ': 'æˆŒ',
    'äº¥å¯æœª': 'æœª',
    'å·³é…‰ä¸‘': 'ä¸‘'
  };
  const JIANGXING_MAP = {
    'ç”³å­è¾°': 'å­',
    'å¯…åˆæˆŒ': 'åˆ',
    'äº¥å¯æœª': 'å¯',
    'å·³é…‰ä¸‘': 'é…‰'
  };

  // v10.4: ä»¥å¹´æ”¯/æ—¥æ”¯ä¸‰åˆå±€ä¸ºä¸»çš„å‡¶ç…/æ¡ƒèŠ±ç±»æ‰©å±•
  const WANGSHEN_MAP = {
    'å¯…åˆæˆŒ': 'å·³',
    'äº¥å¯æœª': 'å¯…',
    'å·³é…‰ä¸‘': 'ç”³',
    'ç”³å­è¾°': 'äº¥'
  };

  const LIUE_MAP = {
    'å¯…åˆæˆŒ': 'é…‰',
    'äº¥å¯æœª': 'åˆ',
    'ç”³å­è¾°': 'å¯',
    'å·³é…‰ä¸‘': 'å­'
  };

  const ZAISHA_MAP = {
    'ç”³å­è¾°': 'åˆ',
    'äº¥å¯æœª': 'é…‰',
    'å¯…åˆæˆŒ': 'å­',
    'å·³é…‰ä¸‘': 'å¯'
  };

  const JIESHA_MAP = {
    'ç”³å­è¾°': 'äº¥',
    'å¯…åˆæˆŒ': 'å·³',
    'å·³é…‰ä¸‘': 'å¯…',
    'äº¥å¯æœª': 'ç”³'
  };

  const BAIHU_MAP = {
    'å¯…åˆæˆŒ': 'å­',
    'ç”³å­è¾°': 'åˆ',
    'äº¥å¯æœª': 'é…‰',
    'å·³é…‰ä¸‘': 'å¯'
  };


  /* ===================== ç¥ç…è‡ªåŠ¨åˆ¤å®š Â· æ‰©å±•ç‰ˆï¼ˆå«å¹²æ”¯/æ—¥æŸ±ç±»ï¼‰ ===================== */

  const WENCHANG_MAP = {
    'ç”²':'å·³','ä¹™':'åˆ','ä¸™':'ç”³','ä¸':'é…‰','æˆŠ':'ç”³','å·±':'é…‰','åºš':'äº¥','è¾›':'å­','å£¬':'å¯…','ç™¸':'å¯'
  };

  const TIAN_YI_MAP = {
    'ç”²':['ä¸‘','æœª'],
    'æˆŠ':['ä¸‘','æœª'],
    'ä¹™':['å­','ç”³'],
    'å·±':['å­','ç”³'],
    'ä¸™':['äº¥','é…‰'],
    'ä¸':['äº¥','é…‰'],
    'å£¬':['å¯','å·³'],
    'ç™¸':['å¯','å·³'],
    'åºš':['å¯…','åˆ'],
    'è¾›':['å¯…','åˆ'] // å¸¸è§å¹¶ç”¨æ³•ï¼Œä¾›å­¦ä¹ å‚è€ƒ
  };

  const GUOYIN_MAP = {
    'ç”²':'æˆŒ','ä¹™':'äº¥','ä¸™':'ä¸‘','ä¸':'å¯…','æˆŠ':'ä¸‘','å·±':'å¯…','åºš':'è¾°','è¾›':'å·³','å£¬':'æœª','ç™¸':'ç”³'
  };

  const TAIJI_MAP = {
    'ç”²':'å­åˆ','ä¹™':'å­åˆ',
    'ä¸™':'é…‰å¯','ä¸':'é…‰å¯',
    'æˆŠ':'è¾°æˆŒä¸‘æœª','å·±':'è¾°æˆŒä¸‘æœª',
    'åºš':'å¯…äº¥','è¾›':'å¯…äº¥',
    'å£¬':'å·³ç”³','ç™¸':'å·³ç”³'
  };

  const HONG_LUAN_MAP = {
    'å­':'å¯','ä¸‘':'å¯…','å¯…':'ä¸‘','å¯':'å­','è¾°':'äº¥','å·³':'æˆŒ','åˆ':'é…‰','æœª':'ç”³','ç”³':'æœª','é…‰':'åˆ','æˆŒ':'å·³','äº¥':'è¾°'
  };

  const TIAN_XI_MAP = {
    'å­':'é…‰','ä¸‘':'ç”³','å¯…':'æœª','å¯':'åˆ','è¾°':'å·³','å·³':'è¾°','åˆ':'å¯','æœª':'å¯…','ç”³':'ä¸‘','é…‰':'å­','æˆŒ':'äº¥','äº¥':'æˆŒ'
  };

  const LUSHEN_MAP = {
    'ç”²':'å¯…','ä¹™':'å¯','ä¸™':'å·³','ä¸':'åˆ','æˆŠ':'å·³','å·±':'åˆ','åºš':'ç”³','è¾›':'é…‰','å£¬':'äº¥','ç™¸':'å­'
  };

  const FUDEREN_MAP = {
    'ç”²':'å¯…','ä¹™':'å¯','ä¸™':'å·³','ä¸':'åˆ','æˆŠ':'ç”³','å·±':'é…‰','åºš':'äº¥','è¾›':'å­','å£¬':'å¯…','ç™¸':'å¯'
  };

  // v10.4: æ–°å¢æ—¥å¹²å¯¹åº”ç¥ç…
  const FUXING_MAP = {
    'ç”²':'å¯…', 'ä¸™':'å¯…',
    'ä¹™':'å¯', 'ç™¸':'å¯',
    'ä¸':'äº¥',
    'æˆŠ':'ç”³',
    'å·±':'æœª',
    'åºš':'åˆ',
    'è¾›':'å·³',
    'å£¬':'è¾°'
  };

  const JINYU_MAP = {
    'ç”²':'è¾°','ä¹™':'å·³','ä¸™':'æœª','ä¸':'ç”³','æˆŠ':'æœª','å·±':'ç”³','åºš':'æˆŒ','è¾›':'äº¥','å£¬':'ä¸‘','ç™¸':'å¯…'
  };

  const XISHEN_MAP = {
    'ç”²':'åˆ','ä¹™':'å·³','ä¸™':'å¯…','ä¸':'å¯','æˆŠ':'ç”³','å·±':'é…‰','åºš':'äº¥','è¾›':'å­','å£¬':'æˆŒ','ç™¸':'ä¸‘'
  };

  const HONGYAN_MAP = {
    'ç”²':'åˆ','ä¹™':'ç”³','ä¸™':'å¯…','ä¸':'æœª','æˆŠ':'è¾°','å·±':'è¾°','åºš':'æˆŒ','è¾›':'é…‰','å£¬':'å­','ç™¸':'ç”³'
  };

  // æˆªè·¯ç©ºäº¡ï¼šæ—¥å¹²å¯¹åº”ä¸¤æ”¯
  const JIELUKONGWANG_MAP = {
    'ç”²':'ç”³é…‰','å·±':'ç”³é…‰',
    'ä¹™':'åˆæœª','åºš':'åˆæœª',
    'ä¸™':'è¾°å·³','è¾›':'è¾°å·³',
    'ä¸':'å¯…å¯','å£¬':'å¯…å¯',
    'æˆŠ':'å­ä¸‘','ç™¸':'å­ä¸‘'
  };

  // å¤©å¨è´µäººï¼šæ—¥å¹²å¯¹åº”æ—¶æ”¯
  const TIANCHU_HOUR_MAP = {
    'ç”²':'å·³','ä¹™':'åˆ','ä¸™':'å·³','ä¸':'åˆ','æˆŠ':'ç”³','å·±':'é…‰','åºš':'äº¥','è¾›':'å­','å£¬':'å¯…','ç™¸':'å¯'
  };


  const YANGREN_MAP = {
    'ç”²':'å¯','ä¹™':'å¯…','ä¸™':'åˆ','ä¸':'å·³','æˆŠ':'åˆ','å·±':'å·³','åºš':'é…‰','è¾›':'ç”³','å£¬':'å­','ç™¸':'äº¥'
  };

  const FEIREN_MAP = {
    'ç”²':'é…‰','ä¹™':'ç”³','ä¸™':'å­','ä¸':'äº¥','æˆŠ':'å­','å·±':'äº¥','åºš':'å¯','è¾›':'å¯…','å£¬':'åˆ','ç™¸':'å·³'
  };

  const XUEREN_MAP = {
    'ç”²':'å¯','ä¹™':'è¾°','ä¸™':'åˆ','ä¸':'æœª','æˆŠ':'åˆ','å·±':'æœª','åºš':'é…‰','è¾›':'æˆŒ','å£¬':'å­','ç™¸':'ä¸‘'
  };

  const GULUAN_SET = new Set(['ä¹™å·³','ä¸å·³','è¾›äº¥','æˆŠç”³','å£¬å¯…','æˆŠåˆ','å£¬å­','ä¸™åˆ']);
  const SHI_E_DA_BAI_SET = new Set(['ç”²è¾°','ä¹™å·³','ä¸™ç”³','ä¸äº¥','æˆŠæˆŒ','å·±ä¸‘','åºšè¾°','è¾›å·³','å£¬ç”³','ç™¸äº¥']);
  const YINYANG_CHACUO_SET = new Set(['ä¸™å­','ä¸ä¸‘','æˆŠå¯…','è¾›å¯','å£¬è¾°','ç™¸å·³','ä¸™åˆ','ä¸æœª','æˆŠç”³','è¾›é…‰','å£¬æˆŒ','ç™¸äº¥']);
  const KUI_GANG_SET = new Set(['å£¬è¾°','åºšæˆŒ','åºšè¾°','æˆŠæˆŒ']);

  function detectAutoShenSha(pillars){
    const results = [];
    const zhis = [pillars.yearZhi, pillars.monthZhi, pillars.dayZhi, pillars.timeZhi].filter(Boolean);
    const dayPillar = `${pillars.dayGan||''}${pillars.dayZhi||''}`;
    const gans = [pillars.yearGan, pillars.monthGan, pillars.dayGan, pillars.timeGan].filter(Boolean);
    const pillarPairs = [
      `${pillars.yearGan||''}${pillars.yearZhi||''}`,
      `${pillars.monthGan||''}${pillars.monthZhi||''}`,
      `${pillars.dayGan||''}${pillars.dayZhi||''}`,
      `${pillars.timeGan||''}${pillars.timeZhi||''}`
    ].filter(x => x && x.length===2);
    const lunarMonthNum = pillars.lunarMonthNum;

    function push(name, rule, luck){
      results.push({ name, rule, luck });
    }

    function pushByGanMap(name, gan, map, luck){
      if(!gan) return;
      const target = map[gan];
      if(!target) return;
      // å…è®¸ map å€¼ä¸ºå¤šä¸ªåœ°æ”¯å­—ç¬¦ä¸²ï¼ˆå¦‚ "å­åˆ"ï¼‰
      const targets = Array.isArray(target) ? target : target.split('');
      const hits = targets.filter(z => zhis.includes(z));
      if(hits.length){
        push(name, `ä»¥${gan}ä¸ºä¸»ï¼Œè§${hits.join('ã€')}`, luck);
      }
    }

    // æ–‡æ˜Œï¼šå¹´å¹²/æ—¥å¹²å‡å¯å‚è€ƒ
    pushByGanMap('æ–‡æ˜Œè´µäºº', pillars.yearGan, WENCHANG_MAP, 'å‰');
    if(pillars.dayGan && pillars.dayGan !== pillars.yearGan){
      pushByGanMap('æ–‡æ˜Œè´µäºº', pillars.dayGan, WENCHANG_MAP, 'å‰');
    }

    // å¤©ä¹™ï¼šä»¥æ—¥å¹²ä¸ºä¸»
    if(pillars.dayGan){
      const ts = TIAN_YI_MAP[pillars.dayGan] || [];
      const hits = ts.filter(z => zhis.includes(z));
      if(hits.length){
        push('å¤©ä¹™è´µäºº', `ä»¥æ—¥å¹²${pillars.dayGan}ä¸ºä¸»ï¼Œè§${hits.join('ã€')}`, 'å‰');
      }
    }

    // å›½å°ã€å¤ªæã€ç¦„ç¥ã€ç¦å¾·ã€ç¾Šåˆƒã€é£åˆƒã€è¡€åˆƒ
    pushByGanMap('å›½å°è´µäºº', pillars.yearGan, GUOYIN_MAP, 'å‰');
    if(pillars.dayGan && pillars.dayGan !== pillars.yearGan){
      pushByGanMap('å›½å°è´µäºº', pillars.dayGan, GUOYIN_MAP, 'å‰');
    }

    // å¤ªæï¼ˆmap å€¼æ˜¯å¤šä¸ªåœ°æ”¯é›†åˆï¼‰
    if(pillars.yearGan){
      const t = TAIJI_MAP[pillars.yearGan];
      if(t){
        const targets = t.split('');
        const hits = targets.filter(z => zhis.includes(z));
        if(hits.length){
          push('å¤ªæè´µäºº', `ä»¥${pillars.yearGan}ä¸ºä¸»ï¼Œè§${hits.join('ã€')}`, 'å‰');
        }
      }
    }
    if(pillars.dayGan && pillars.dayGan !== pillars.yearGan){
      const t = TAIJI_MAP[pillars.dayGan];
      if(t){
        const targets = t.split('');
        const hits = targets.filter(z => zhis.includes(z));
        if(hits.length){
          push('å¤ªæè´µäºº', `ä»¥${pillars.dayGan}ä¸ºä¸»ï¼Œè§${hits.join('ã€')}`, 'å‰');
        }
      }
    }

    pushByGanMap('ç¦„ç¥', pillars.dayGan, LUSHEN_MAP, 'å‰');
    pushByGanMap('ç¦å¾·è´µäºº', pillars.dayGan, FUDEREN_MAP, 'å‰');
    pushByGanMap('ç¦æ˜Ÿè´µäºº', pillars.dayGan, FUXING_MAP, 'å‰');
    pushByGanMap('é‡‘èˆ†è´µäºº', pillars.dayGan, JINYU_MAP, 'å‰');
    pushByGanMap('å–œç¥', pillars.dayGan, XISHEN_MAP, 'å‰');
    pushByGanMap('çº¢è‰³ç…', pillars.dayGan, HONGYAN_MAP, 'ä¸­æ€§');
    pushByGanMap('æˆªè·¯ç©ºäº¡', pillars.dayGan, JIELUKONGWANG_MAP, 'å‡¶');

    pushByGanMap('ç¾Šåˆƒ', pillars.dayGan, YANGREN_MAP, 'ä¸­æ€§ååˆš');
    pushByGanMap('é£åˆƒ', pillars.dayGan, FEIREN_MAP, 'å‡¶');
    pushByGanMap('è¡€åˆƒ', pillars.dayGan, XUEREN_MAP, 'å‡¶');

    
    // å¤©å¨è´µäººï¼šæ—¥å¹²å¯¹åº”æ—¶æ”¯
    if(pillars.dayGan && pillars.timeZhi){
      const t = TIANCHU_HOUR_MAP[pillars.dayGan];
      if(t && pillars.timeZhi === t){
        push('å¤©å¨è´µäºº', `ä»¥æ—¥å¹²${pillars.dayGan}ä¸ºä¸»ï¼Œç”Ÿäº${pillars.timeZhi}æ—¶`, 'å‰');
      }
    }

// çº¢é¸¾ / å¤©å–œï¼šä»¥å¹´æ”¯ä¸ºä¸»
    if(pillars.yearZhi){
      const h = HONG_LUAN_MAP[pillars.yearZhi];
      if(h && zhis.includes(h)){
        push('çº¢é¸¾', `ä»¥å¹´æ”¯${pillars.yearZhi}ä¸ºä¸»ï¼Œè§${h}`, 'å‰');
      }
      const tx = TIAN_XI_MAP[pillars.yearZhi];
      if(tx && zhis.includes(tx)){
        push('å¤©å–œ', `ä»¥å¹´æ”¯${pillars.yearZhi}ä¸ºä¸»ï¼Œè§${tx}`, 'å‰');
      }
    }

    // å…­åˆï¼šå‡ºç°ä»»ä¸€å…­åˆç»„åˆ
    const LIUHE_PAIRS = [['å­','ä¸‘'],['å¯…','äº¥'],['å¯','æˆŒ'],['è¾°','é…‰'],['å·³','ç”³'],['åˆ','æœª']];
    for(const [a,b] of LIUHE_PAIRS){
      if(zhis.includes(a) && zhis.includes(b)){
        push('å…­åˆ', `åœ°æ”¯è§${a}${b}åˆ`, 'å‰');
      }
    }

    // é­ç½¡ã€åæ¶å¤§è´¥ã€å­¤é¸¾ã€é˜´é˜³å·®é”™ï¼ˆä»¥æ—¥æŸ±ä¸ºä¸»ï¼‰
    if(KUI_GANG_SET.has(dayPillar)){
      push('é­ç½¡', `æ—¥æŸ±${dayPillar}`, 'ä¸­æ€§ååˆš');
    }
    if(SHI_E_DA_BAI_SET.has(dayPillar)){
      push('åæ¶å¤§è´¥', `æ—¥æŸ±${dayPillar}`, 'å‡¶');
    }
    if(GULUAN_SET.has(dayPillar)){
      push('å­¤é¸¾ç…', `æ—¥æŸ±${dayPillar}`, 'ä¸­æ€§åå­¤');
    }
    if(YINYANG_CHACUO_SET.has(dayPillar)){
      push('é˜´é˜³å·®é”™', `æ—¥æŸ±${dayPillar}`, 'å‡¶');
    }

    // ===== æ–°å¢ï¼šå­¦ä¹ åˆ—è¡¨æ‰©å±•ç¥ç…ï¼ˆæ°‘é—´/å¤ç±å£ä¼ ç±»ï¼‰=====
    // æµéœç…ï¼šä»¥æ—¥å¹²å¯¹åº”åœ°æ”¯
    const LIUXIA_ZHI_BY_DAYGAN = {
      'ç”²':'é…‰','ä¹™':'æˆŒ','ä¸™':'æœª','ä¸':'ç”³','æˆŠ':'å·³',
      'å·±':'åˆ','åºš':'è¾°','è¾›':'å¯','å£¬':'äº¥','ç™¸':'å¯…'
    };
    const liuxiaZhi = LIUXIA_ZHI_BY_DAYGAN[pillars.dayGan];
    if(liuxiaZhi && zhis.includes(liuxiaZhi)){
      push('æµéœç…', `ä»¥æ—¥å¹²${pillars.dayGan}ä¸ºä¸»ï¼Œè§${liuxiaZhi}`, 'å‡¶');
    }

    // é“æ¿ç…ï¼šæ—¥å¹² + æœˆæ”¯
    if(pillars.dayGan && pillars.monthZhi){
      const dg = pillars.dayGan;
      const mz = pillars.monthZhi;
      if((dg === 'ç”²' || dg === 'å·±') && mz === 'è¾°'){
        push('é“æ¿ç…', `æ—¥å¹²${dg}ï¼Œæœˆæ”¯${mz}`, 'å‡¶');
      }else if((dg === 'ä¹™' || dg === 'åºš') && mz === 'å¯…'){
        push('é“æ¿ç…', `æ—¥å¹²${dg}ï¼Œæœˆæ”¯${mz}`, 'å‡¶');
      }else if((dg === 'ä¸™' || dg === 'è¾›') && (mz === 'é…‰' || mz === 'æˆŒ')){
        push('é“æ¿ç…', `æ—¥å¹²${dg}ï¼Œæœˆæ”¯${mz}`, 'å‡¶');
      }
    }

    // åŸ‹å„¿ç…ï¼šä»¥å¹´æ”¯ä¸ºåŸºå‡†çœ‹å…¶ä»–åœ°æ”¯
    if(pillars.yearZhi){
      const yz = pillars.yearZhi;
      let target = '';
      if('å­åˆå¯é…‰'.includes(yz)) target = 'ä¸‘';
      else if('å¯…ç”³å·³äº¥'.includes(yz)) target = 'ç”³';
      else if('è¾°æˆŒä¸‘æœª'.includes(yz)) target = 'å¯';

      if(target){
        const hitCols = [];
        if(pillars.monthZhi === target) hitCols.push('æœˆæ”¯');
        if(pillars.dayZhi === target) hitCols.push('æ—¥æ”¯');
        if(pillars.timeZhi === target) hitCols.push('æ—¶æ”¯');

        if(hitCols.length){
          const isFemale = pillars.gender === 0;
          const extra = (isFemale && pillars.timeZhi === target) ? 'ï¼ˆå¥³å‘½æ—¶æ”¯è§ä¹‹æ›´å‡¶ï¼‰' : '';
          push('åŸ‹å„¿ç…', `ä»¥å¹´æ”¯${yz}ä¸ºä¸»ï¼Œè§${target}${hitCols.length ? `ï¼ˆ${hitCols.join('ã€')}ï¼‰` : ''}${extra}`, 'å‡¶');
        }
      }
    }

    // é“æ‰«æŠŠï¼šæŒ‰å¹´æ”¯ç»„ + æ€§åˆ« + å†œå†æœˆ
    if(typeof pillars.lunarMonthNum === 'number' && pillars.yearZhi){
      const lm = pillars.lunarMonthNum;
      const yz = pillars.yearZhi;
      const isMale = pillars.gender !== 0; // é»˜è®¤ç”·

      let need = null;
      if('ç”³å­è¾°'.includes(yz)) need = isMale ? 1 : 12;
      else if('å·³é…‰ä¸‘'.includes(yz)) need = isMale ? 6 : 9;
      else if('å¯…åˆæˆŒ'.includes(yz)) need = isMale ? 9 : 6;
      else if('äº¥å¯æœª'.includes(yz)) need = isMale ? 12 : 1;

      if(need && lm === need){
        push('é“æ‰«æŠŠ', `å¹´æ”¯${yz}ï¼Œ${isMale ? 'ç”·' : 'å¥³'}å‘½ç”Ÿäºå†œå†${need}æœˆ`, 'ä¸­æ€§åå‡¶');
      }
    }

    // å…«è´¥ï¼šç”Ÿè‚– + å‡ºç”Ÿå­£èŠ‚ç‰¹å®šæœˆ
    if(pillars.yearAnimal && typeof pillars.lunarMonthNum === 'number'){
      const a = pillars.yearAnimal;
      const lm = pillars.lunarMonthNum;

      const hit =
        (['çŒª','ç‹—','ç¾Š'].includes(a) && lm === 3) ||
        (['é¾™','è›‡','é¼ '].includes(a) && lm === 6) ||
        (['çŒ´','é¸¡','ç‰›'].includes(a) && lm === 9) ||
        (['è™','é©¬','å…”'].includes(a) && lm === 12);

      if(hit){
        push('å…«è´¥', `ç”Ÿè‚–${a}ï¼Œå†œå†${lm}æœˆ`, 'å‡¶');
      }
    }

    // åœ°æ‰«æ˜Ÿï¼šå¹´æŸ±çº³éŸ³äº”è¡Œ + å†œå†æœˆ
    if(pillars.yearNayinElement && typeof pillars.lunarMonthNum === 'number'){
      const e = pillars.yearNayinElement;
      const lm = pillars.lunarMonthNum;

      let hit = false;
      if((e === 'æ°´' || e === 'åœŸ') && (lm === 2 || lm === 3)) hit = true;
      else if(e === 'ç«' && (lm === 5 || lm === 6)) hit = true;
      else if(e === 'é‡‘' && (lm === 8 || lm === 9)) hit = true;
      else if(e === 'æœ¨' && (lm === 10 || lm === 11 || lm === 12)) hit = true;

      if(hit){
        push('åœ°æ‰«æ˜Ÿ', `å¹´æŸ±çº³éŸ³${pillars.yearNayin || e}ï¼Œå†œå†${lm}æœˆ`, 'å‡¶');
      }
    }

    
    // å­¤è¾° / å¯¡å®¿ï¼šä»¥å¹´æ”¯ä¸ºä¸»
    if(pillars.yearZhi){
      const yk = findYearSolitudeGroup(pillars.yearZhi);
      if(yk){
        const gc = GUCHEN_YEAR_MAP[yk];
        if(gc && zhis.includes(gc)){
          push('å­¤è¾°', `ä»¥å¹´æ”¯${pillars.yearZhi}ä¸ºä¸»ï¼Œè§${gc}`, 'å‡¶');
        }
        const gs = GUASU_YEAR_MAP[yk];
        if(gs && zhis.includes(gs)){
          push('å¯¡å®¿', `ä»¥å¹´æ”¯${pillars.yearZhi}ä¸ºä¸»ï¼Œè§${gs}`, 'å‡¶');
        }
      }
    }

    /* ===================== æ–°å¢ï¼šå­¦ä¸š/å¾·æ›œ/ç½‘ç½—ç±»ï¼ˆè‡ªåŠ¨åˆ¤å®š Â· æ‰©å±•ï¼‰ ===================== */

    // æ–‡æ›²æ˜Ÿï¼ˆç®€åŒ–å£å¾„ï¼šå‘½å±€è§è¾°ï¼‰
    if(zhis.includes('è¾°')){
      push('æ–‡æ›²æ˜Ÿ', 'å‘½å±€åœ°æ”¯è§è¾°ï¼ˆå¸¸è§å£å¾„ï¼‰', 'å‰');
    }

    // å­¦å ‚ï¼ˆæŒ‰å¹´æŸ±çº³éŸ³äº”è¡Œï¼‰
    if(pillars.yearNayinElement){
      const XUETANG_MAP = { 'é‡‘':'å·³', 'æœ¨':'äº¥', 'æ°´':'ç”³', 'åœŸ':'ç”³', 'ç«':'å¯…' };
      const xt = XUETANG_MAP[pillars.yearNayinElement];
      if(xt && zhis.includes(xt)){
        const ny = pillars.yearNayin || (pillars.yearNayinElement + 'å‘½');
        push('å­¦å ‚', `ä»¥å¹´æŸ±çº³éŸ³${ny}æŸ¥ï¼Œè§${xt}`, 'å‰');
      }
    }

    // æœˆå¾·è´µäºº / æœˆå¾·åˆï¼ˆä»¥æœˆæ”¯ä¸‰åˆå±€å–å¤©å¹²ï¼‰
    if(pillars.monthZhi){
      let mdGan = '';
      if('å¯…åˆæˆŒ'.includes(pillars.monthZhi)) mdGan = 'ä¸™';
      else if('ç”³å­è¾°'.includes(pillars.monthZhi)) mdGan = 'å£¬';
      else if('äº¥å¯æœª'.includes(pillars.monthZhi)) mdGan = 'ç”²';
      else if('å·³é…‰ä¸‘'.includes(pillars.monthZhi)) mdGan = 'åºš';

      const HE_GAN = { 'ç”²':'å·±', 'å·±':'ç”²', 'ä¹™':'åºš', 'åºš':'ä¹™', 'ä¸™':'è¾›', 'è¾›':'ä¸™', 'ä¸':'å£¬', 'å£¬':'ä¸', 'æˆŠ':'ç™¸', 'ç™¸':'æˆŠ' };

      if(mdGan && gans.includes(mdGan)){
        push('æœˆå¾·è´µäºº', `ä»¥æœˆæ”¯${pillars.monthZhi}å½’ä¸‰åˆå±€å–${mdGan}ï¼Œå››æŸ±å¤©å¹²è§ä¹‹`, 'å‰');
      }
      const mdHe = mdGan ? HE_GAN[mdGan] : '';
      if(mdHe && gans.includes(mdHe)){
        push('æœˆå¾·åˆ', `å–æœˆå¾·${mdGan}ä¹‹äº”åˆ${mdHe}ï¼Œå››æŸ±å¤©å¹²è§ä¹‹`, 'å‰');
      }
    }

    // å¤©å¾·è´µäºº / å¤©å¾·åˆï¼ˆæŒ‰å†œå†æœˆä»½ï¼‰
    if(lunarMonthNum){
      const TD_MONTH_MAP = { 1:'ä¸', 2:'ç”³', 3:'å£¬', 4:'è¾›', 5:'äº¥', 6:'ç”²', 7:'ç™¸', 8:'å¯…', 9:'ä¸™', 10:'ä¹™', 11:'å·³', 12:'åºš' };
      const td = TD_MONTH_MAP[lunarMonthNum];

      const HE_GAN = { 'ç”²':'å·±', 'å·±':'ç”²', 'ä¹™':'åºš', 'åºš':'ä¹™', 'ä¸™':'è¾›', 'è¾›':'ä¸™', 'ä¸':'å£¬', 'å£¬':'ä¸', 'æˆŠ':'ç™¸', 'ç™¸':'æˆŠ' };
      const HE_ZHI = { 'å­':'ä¸‘', 'ä¸‘':'å­', 'å¯…':'äº¥', 'äº¥':'å¯…', 'å¯':'æˆŒ', 'æˆŒ':'å¯', 'è¾°':'é…‰', 'é…‰':'è¾°', 'å·³':'ç”³', 'ç”³':'å·³', 'åˆ':'æœª', 'æœª':'åˆ' };

      if(td){
        const isGan = 'ç”²ä¹™ä¸™ä¸æˆŠå·±åºšè¾›å£¬ç™¸'.includes(td);
        const isZhi = 'å­ä¸‘å¯…å¯è¾°å·³åˆæœªç”³é…‰æˆŒäº¥'.includes(td);

        if((isGan && gans.includes(td)) || (isZhi && zhis.includes(td))){
          push('å¤©å¾·è´µäºº', `å†œå†${lunarMonthNum}æœˆå–${td}ï¼Œå››æŸ±è§ä¹‹`, 'å‰');
        }

        const tdHe = isGan ? HE_GAN[td] : (isZhi ? HE_ZHI[td] : '');
        if(tdHe){
          if(isGan && gans.includes(tdHe)){
            push('å¤©å¾·åˆ', `å†œå†${lunarMonthNum}æœˆå¤©å¾·ä¸º${td}ï¼Œå–äº”åˆ${tdHe}ï¼Œå››æŸ±å¤©å¹²è§ä¹‹`, 'å‰');
          }else if(isZhi && zhis.includes(tdHe)){
            push('å¤©å¾·åˆ', `å†œå†${lunarMonthNum}æœˆå¤©å¾·ä¸º${td}ï¼Œå–å…­åˆ${tdHe}ï¼Œå››æŸ±åœ°æ”¯è§ä¹‹`, 'å‰');
          }
        }
      }
    }

    // å¾·ç§€è´µäººï¼ˆä»¥æœˆä»¤åˆ†å¾·/ç§€ï¼‰
    if(pillars.monthZhi){
      let de = [], xiu = [];
      if('å¯…åˆæˆŒ'.includes(pillars.monthZhi)){
        de = ['ä¸™','ä¸']; xiu = ['æˆŠ','ç™¸'];
      }else if('ç”³å­è¾°'.includes(pillars.monthZhi)){
        de = ['å£¬','ç™¸','æˆŠ','å·±']; xiu = ['ä¸™','è¾›','ç”²','å·±'];
      }else if('å·³é…‰ä¸‘'.includes(pillars.monthZhi)){
        de = ['åºš','è¾›']; xiu = ['ä¹™','åºš'];
      }else if('äº¥å¯æœª'.includes(pillars.monthZhi)){
        de = ['ç”²','ä¹™']; xiu = ['ä¸','å£¬'];
      }

      const hitDe = de.filter(g => gans.includes(g));
      const hitXiu = xiu.filter(g => gans.includes(g));
      if(hitDe.length || hitXiu.length){
        const parts = [];
        if(hitDe.length) parts.push(`å¾·ï¼š${hitDe.join('ã€')}`);
        if(hitXiu.length) parts.push(`ç§€ï¼š${hitXiu.join('ã€')}`);
        push('å¾·ç§€è´µäºº', `ä»¥æœˆæ”¯${pillars.monthZhi}å®šå¾·ç§€ï¼Œå››æŸ±å¤©å¹²è§${parts.join('ï¼›')}`, 'å‰');
      }
    }

    // å¤©ç½—åœ°ç½‘ï¼ˆä¸»æµåœ°æ”¯å£å¾„ï¼‰
    if(zhis.includes('æˆŒ') && zhis.includes('äº¥')){
      push('å¤©ç½—åœ°ç½‘', 'å››æŸ±åœ°æ”¯æˆŒäº¥åŒè§ï¼ˆå¤©ç½—ï¼‰', 'å‡¶');
    }else if(zhis.includes('è¾°') && zhis.includes('å·³')){
      push('å¤©ç½—åœ°ç½‘', 'å››æŸ±åœ°æ”¯è¾°å·³åŒè§ï¼ˆåœ°ç½‘ï¼‰', 'å‡¶');
    }

    // ä¸‰å¥‡è´µäººï¼ˆç®€åŒ–ï¼šå››æŸ±å¤©å¹²æŒ‰åºå‡ºç°ï¼‰
    (function(){
      const seqGans = [pillars.yearGan, pillars.monthGan, pillars.dayGan, pillars.timeGan].filter(Boolean);
      function hasOrdered(seq){
        let j = 0;
        for(const g of seqGans){
          if(g === seq[j]) j++;
          if(j >= seq.length) return true;
        }
        return false;
      }
      const hit =
        hasOrdered(['ç”²','æˆŠ','åºš']) ||
        hasOrdered(['å£¬','ç™¸','è¾›']) ||
        hasOrdered(['ä¹™','ä¸™','ä¸']);
      if(hit){
        push('ä¸‰å¥‡è´µäºº', 'å››æŸ±å¤©å¹²è§ä¸‰å¥‡é¡ºåºï¼ˆç®€åŒ–åˆ¤å®šï¼‰', 'å‰');
      }
    })();

    // è¯é¦†ï¼ˆç®€åŒ–ï¼šä»¥å¹´å¹²/æ—¥å¹²å¯¹åº”ä¹‹å¹²æ”¯è½æŸ±ï¼‰
    (function(){
      const CIGUAN_MAP = {
        'ç”²':'åºšå¯…','ä¹™':'è¾›å¯','ä¸™':'ä¹™å·³','ä¸':'æˆŠåˆ','æˆŠ':'ä¸å·³',
        'å·±':'åºšåˆ','åºš':'å£¬ç”³','è¾›':'ç™¸é…‰','å£¬':'ç™¸äº¥','ç™¸':'å£¬æˆŒ'
      };
      const keys = [pillars.yearGan, pillars.dayGan].filter(Boolean);
      for(const k of keys){
        const target = CIGUAN_MAP[k];
        if(target && pillarPairs.includes(target)){
          push('è¯é¦†', `ä»¥${k}ä¸ºä¸»ï¼Œè§${target}ï¼ˆæœªç»†æ ¡çº³éŸ³ä¸€è‡´ï¼‰`, 'å‰');
          break;
        }
      }
    })();

    // ç§‘ç”²æ˜Ÿï¼ˆæç¤ºå‹ï¼šæ–‡æ˜Œ/æ–‡æ›²/å­¦å ‚/è¯é¦†ç­‰åŒç°ï¼‰
    (function(){
      const nset = new Set(results.map(r => r.name));
      const acad = ['æ–‡æ˜Œè´µäºº','æ–‡æ›²æ˜Ÿ','å­¦å ‚','è¯é¦†'];
      const hitCount = acad.filter(n => nset.has(n)).length;
      if(hitCount >= 2){
        push('ç§‘ç”²æ˜Ÿ', 'æ–‡æ˜Œ/æ–‡æ›²/å­¦å ‚/è¯é¦†ç­‰å­¦ä¸šç±»ç¥ç…åŒç°ï¼ˆæç¤ºå‹ï¼‰', 'å‰');
      }
    })();
return results.filter(r => shouldIncludeAdultRule(r.name));
  }


  /* ===================== å°å„¿å…³ç…ï¼ˆè‡ªåŠ¨åˆ¤å®š Â· è¯•è¡Œï¼‰ ===================== */
  
  function detectChildGuanSha(pillars){
    const results = [];
    const zhis = [pillars.yearZhi, pillars.monthZhi, pillars.dayZhi, pillars.timeZhi].filter(Boolean);
    const hourZhi = pillars.timeZhi;
    const dayGan = pillars.dayGan;
    const yearZhi = pillars.yearZhi;
    const monthZhi = pillars.monthZhi;
    const dayZhi = pillars.dayZhi;
    const nayinElem = pillars.yearNayinElement || '';
    const lunarMonthRaw = pillars.lunarMonthNum;
    const lunarMonth = (typeof lunarMonthRaw === 'number' && Number.isFinite(lunarMonthRaw))
      ? Math.abs(lunarMonthRaw)
      : null;

    function push(name, rule){
      results.push({ name, rule, luck: 'å‡¶' });
    }

    // 0) è¾…åŠ©ï¼šå­£èŠ‚ï¼ˆæŒ‰å†œå†æœˆï¼‰
    function seasonByLunarMonth(lm){
      if(lm == null) return '';
      if(lm >= 1 && lm <= 3) return 'æ˜¥';
      if(lm >= 4 && lm <= 6) return 'å¤';
      if(lm >= 7 && lm <= 9) return 'ç§‹';
      if(lm >= 10 && lm <= 12) return 'å†¬';
      return '';
    }

    // 1) çŸ­å‘½å…³ï¼šä»¥â€œå‡ºç”Ÿå¹´/æœˆåœ°æ”¯æ‰€å±ä¸‰åˆç»„ + æ—¶æ”¯â€è¯•è¡Œåˆ¤å®š
    // å£è¯€ï¼šå¯…åˆæˆŒé¾™å½“ï¼Œå·³é…‰ä¸‘è™äº¡ï¼Œç”³å­è¾°è›‡ä¸Šï¼Œäº¥å¯æœªå¯»ç¾Š
    // è§£é‡Šï¼šå¯…åˆæˆŒå¹´æœˆç”Ÿè¾°æ—¶ï¼›å·³é…‰ä¸‘å¹´æœˆç”Ÿå¯…æ—¶ï¼›ç”³å­è¾°å¹´æœˆç”Ÿå·³æ—¶ï¼›äº¥å¯æœªå¹´æœˆç”Ÿæœªæ—¶
    if(hourZhi){
      const conds = [
        { group:'å¯…åˆæˆŒ', hours:['è¾°'] },
        { group:'å·³é…‰ä¸‘', hours:['å¯…'] },
        { group:'ç”³å­è¾°', hours:['å·³'] },
        { group:'äº¥å¯æœª', hours:['æœª'] }
      ];
      conds.forEach(c => {
        const inGroup = (GROUPS[c.group] || []).includes(yearZhi) || (GROUPS[c.group] || []).includes(monthZhi);
        if(inGroup && c.hours.includes(hourZhi)){
          push('çŸ­å‘½å…³', `${c.group}å¹´æœˆè§${hourZhi}æ—¶`);
        }
      });
    }

    // 2) å››æŸ±å…³ï¼šæŒ‰å†œå†æœˆ + æ—¶æ”¯
    if(lunarMonth != null && hourZhi){
      const map = {
        1:['å·³','äº¥'], 7:['å·³','äº¥'],
        2:['è¾°','æˆŒ'], 8:['è¾°','æˆŒ'],
        3:['å¯','é…‰'], 9:['å¯','é…‰'],
        4:['å¯…','ç”³'], 10:['å¯…','ç”³'],
        5:['ä¸‘','æœª'], 11:['ä¸‘','æœª'],
        6:['å­','åˆ'], 12:['å­','åˆ']
      };
      const targets = map[lunarMonth];
      if(targets && targets.includes(hourZhi)){
        push('å››æŸ±å…³', `å†œå†${lunarMonth}æœˆè§${hourZhi}æ—¶`);
      }
    }

    // 3) ç™¾æ—¥å…³ï¼šæŒ‰â€œæœˆæ”¯ç»„ + æ—¶æ”¯ç»„â€
    // å¯…ç”³å·³äº¥æœˆç”Ÿäºè¾°æˆŒä¸‘æœªæ—¶ï¼›å­åˆå¯é…‰æœˆç”Ÿäºå¯…ç”³å·³äº¥æ—¶ï¼›è¾°æˆŒä¸‘æœªæœˆç”Ÿäºå­åˆå¯é…‰æ—¶
    if(monthZhi && hourZhi){
      const map = [
        { months:['å¯…','ç”³','å·³','äº¥'], hours:['è¾°','æˆŒ','ä¸‘','æœª'] },
        { months:['å­','åˆ','å¯','é…‰'], hours:['å¯…','ç”³','å·³','äº¥'] },
        { months:['è¾°','æˆŒ','ä¸‘','æœª'], hours:['å­','åˆ','å¯','é…‰'] }
      ];
      map.forEach(m=>{
        if(m.months.includes(monthZhi) && m.hours.includes(hourZhi)){
          push('ç™¾æ—¥å…³', `æœˆæ”¯${monthZhi}è§${hourZhi}æ—¶`);
        }
      });
    }

    // 4) é˜ç‹å…³ï¼šæŒ‰å­£èŠ‚ï¼ˆå†œå†æœˆï¼‰+ æ—¶æ”¯
    if(lunarMonth != null && hourZhi){
      const s = seasonByLunarMonth(lunarMonth);
      const map = {
        'æ˜¥':['ä¸‘','æœª'],
        'å¤':['è¾°','æˆŒ'],
        'ç§‹':['å­','åˆ'],
        'å†¬':['é…‰','å¯']
      };
      const targets = map[s] || [];
      if(targets.includes(hourZhi)){
        push('é˜ç‹å…³', `${s}ç”Ÿè§${hourZhi}æ—¶`);
      }
    }

    // 5) å°†å†›ç®­ï¼šæŒ‰å­£èŠ‚ï¼ˆå†œå†æœˆï¼‰+ æ—¶æ”¯
    if(lunarMonth != null && hourZhi){
      const s = seasonByLunarMonth(lunarMonth);
      const map = {
        'æ˜¥':['é…‰','æˆŒ','è¾°'],
        'å¤':['æœª','å¯','å­'],
        'ç§‹':['å¯…','åˆ','ä¸‘'],
        'å†¬':['äº¥','ç”³','å·³']
      };
      const targets = map[s] || [];
      if(targets.includes(hourZhi)){
        push('å°†å†›ç®­', `${s}ç”Ÿè§${hourZhi}æ—¶`);
      }
    }

    // 6) é“è›‡å…³ï¼šæŒ‰å¹´æŸ±çº³éŸ³äº”è¡Œ + æ—¶æ”¯
    // é‡‘å‘½æˆŒæ—¶ï¼›ç«å‘½æœªæ—¶ï¼›æœ¨å‘½è¾°æ—¶ï¼›æ°´/åœŸå‘½ä¸‘æ—¶
    if(nayinElem && hourZhi){
      const map = {
        'é‡‘':['æˆŒ'],
        'ç«':['æœª'],
        'æœ¨':['è¾°'],
        'æ°´':['ä¸‘'],
        'åœŸ':['ä¸‘']
      };
      const targets = map[nayinElem] || [];
      if(targets.includes(hourZhi)){
        push('é“è›‡å…³', `å¹´æŸ±çº³éŸ³${nayinElem}è§${hourZhi}æ—¶`);
      }
    }

    // 7) é›·å…¬æ‰“è„‘å…³ï¼šæŒ‰æ—¥å¹² + æ—¶æ”¯
    if(dayGan && hourZhi){
      const map = {
        'ç”²':['ä¸‘'],
        'ä¹™':['åˆ'],
        'ä¸™':['å­'],
        'ä¸':['å­'],
        'æˆŠ':['æˆŒ'],
        'å·±':['æˆŒ'],
        'åºš':['å¯…'],
        'è¾›':['å¯…'],
        'å£¬':['é…‰'],
        'ç™¸':['äº¥']
      };
      const hrs = map[dayGan];
      if(hrs && hrs.includes(hourZhi)){
        push('é›·å…¬æ‰“è„‘å…³', `æ—¥å¹²${dayGan}è§${hourZhi}æ—¶`);
      }
    }

    // 8) é‡‘é”å…³ï¼šæŒ‰å†œå†æœˆ + æ—¶æ”¯
    if(lunarMonth != null && hourZhi){
      const map = {
        1:'ç”³', 7:'ç”³',
        2:'é…‰', 8:'é…‰',
        3:'æˆŒ', 9:'æˆŒ',
        4:'äº¥', 10:'äº¥',
        5:'å­', 11:'å­',
        6:'ä¸‘', 12:'ä¸‘'
      };
      const target = map[lunarMonth];
      if(target && hourZhi === target){
        push('é‡‘é”å…³', `å†œå†${lunarMonth}æœˆè§${hourZhi}æ—¶`);
      }
    }

    // 9) æ— æƒ…å…³ï¼šæŒ‰å­£èŠ‚ï¼ˆå†œå†æœˆï¼‰+ æ—¶æ”¯
    if(lunarMonth != null && hourZhi){
      const s = seasonByLunarMonth(lunarMonth);
      const map = {
        'æ˜¥':['å¯…','é…‰','å­'],
        'å¤':['æˆŒ','äº¥','å·³'],
        'ç§‹':['ç”³','ä¸‘'],
        'å†¬':['å­','åˆ']
      };
      const targets = map[s] || [];
      if(targets.includes(hourZhi)){
        push('æ— æƒ…å…³', `${s}ç”Ÿè§${hourZhi}æ—¶`);
      }
    }

    // 10) æ±¤ç«ç…ï¼ˆçƒ«ç«å…³ï¼‰ï¼šä»¥å¹´æ”¯æˆ–æ—¥æ”¯å¯¹ç…§æ—¶è¾°
    if(hourZhi){
      const groups = [
        { zhis:['å­','åˆ','å¯','é…‰'], target:'åˆ' },
        { zhis:['å¯…','ç”³','å·³','äº¥'], target:'å¯…' },
        { zhis:['è¾°','æˆŒ','ä¸‘','æœª'], target:'æœª' }
      ];
      groups.forEach(g=>{
        const hitZhi = (g.zhis.includes(yearZhi) || g.zhis.includes(dayZhi));
        if(hitZhi && hourZhi === g.target){
          push('æ±¤ç«ç…ï¼ˆçƒ«ç«å…³ï¼‰', `å¹´/æ—¥æ”¯ç»„è§${hourZhi}æ—¶`);
        }
      });
    }

    // 11) é¬¼é—¨å…³ï¼šæŒ‰å¹´æ”¯ç»„ + æ—¶æ”¯
    if(yearZhi && hourZhi){
      const map = [
        { years:['å­','ä¸‘','å¯…'], hours:['é…‰','åˆ','æœª'] },
        { years:['å¯','è¾°','å·³'], hours:['ç”³','æˆŒ','äº¥'] },
        { years:['åˆ','æœª','ç”³'], hours:['ä¸‘','å¯…','å¯'] },
        { years:['é…‰','æˆŒ','äº¥'], hours:['å­','è¾°','å·³'] }
      ];
      map.forEach(m=>{
        if(m.years.includes(yearZhi) && m.hours.includes(hourZhi)){
          push('é¬¼é—¨å…³', `å¹´æ”¯${yearZhi}è§${hourZhi}æ—¶`);
        }
      });
    }

    // 12) æ·±æ°´å…³ï¼šæŒ‰å­£èŠ‚ï¼ˆå†œå†æœˆï¼‰+ æ—¶æ”¯
    if(lunarMonth != null && hourZhi){
      const s = seasonByLunarMonth(lunarMonth);
      const map = { 'æ˜¥':'å¯…', 'å¤':'æœª', 'ç§‹':'é…‰', 'å†¬':'ä¸‘' };
      const target = map[s];
      if(target && hourZhi === target){
        push('æ·±æ°´å…³', `${s}ç”Ÿè§${hourZhi}æ—¶`);
      }
    }

    // 13) æµ´ç›†å…³ï¼šæŒ‰å­£èŠ‚ï¼ˆå†œå†æœˆï¼‰+ æ—¶æ”¯
    if(lunarMonth != null && hourZhi){
      const s = seasonByLunarMonth(lunarMonth);
      const map = { 'æ˜¥':'è¾°', 'å¤':'æœª', 'ç§‹':'æˆŒ', 'å†¬':'ä¸‘' };
      const target = map[s];
      if(target && hourZhi === target){
        push('æµ´ç›†å…³', `${s}ç”Ÿè§${hourZhi}æ—¶`);
      }
    }

    // 14) ç™½è™å…³ï¼šæŒ‰å¹´æŸ±çº³éŸ³äº”è¡Œ + æ—¶æ”¯
    // ç«å‘½å­æ—¶ï¼›é‡‘å‘½å¯æ—¶ï¼›æ°´/åœŸå‘½åˆæ—¶ï¼›æœ¨å‘½é…‰æ—¶
    if(nayinElem && hourZhi){
      const map = {
        'ç«':'å­',
        'é‡‘':'å¯',
        'æ°´':'åˆ',
        'åœŸ':'åˆ',
        'æœ¨':'é…‰'
      };
      const target = map[nayinElem];
      if(target && hourZhi === target){
        push('ç™½è™å…³', `å¹´æŸ±çº³éŸ³${nayinElem}è§${hourZhi}æ—¶`);
      }
    }

    // 15) äº”é¬¼å…³ï¼šæŒ‰å¹´æ”¯ + å¯¹åº”åœ°æ”¯æ˜¯å¦å‡ºç°åœ¨å››æŸ±
    if(yearZhi){
      const map = {
        'å­':'è¾°','ä¸‘':'å·³','å¯…':'åˆ','å¯':'æœª',
        'è¾°':'ç”³','å·³':'é…‰','åˆ':'æˆŒ','æœª':'äº¥',
        'ç”³':'å­','é…‰':'ä¸‘','æˆŒ':'å¯…','äº¥':'å¯'
      };
      const target = map[yearZhi];
      if(target && zhis.includes(target)){
        push('äº”é¬¼å…³', `å¹´æ”¯${yearZhi}è§${target}`);
      }
    }

    // 16) å¤©ç‹—å…³ï¼šæŒ‰å¹´æ”¯ + å¯¹åº”åœ°æ”¯æ˜¯å¦å‡ºç°åœ¨å››æŸ±
    if(yearZhi){
      const map = {
        'å­':'æˆŒ','ä¸‘':'äº¥','å¯…':'å­','å¯':'ä¸‘',
        'è¾°':'å¯…','å·³':'å¯','åˆ':'è¾°','æœª':'å·³',
        'ç”³':'åˆ','é…‰':'æœª','æˆŒ':'ç”³','äº¥':'é…‰'
      };
      const target = map[yearZhi];
      if(target && zhis.includes(target)){
        push('å¤©ç‹—å…³', `å¹´æ”¯${yearZhi}è§${target}`);
      }
    }

    // 17) æ–­æ¡¥å…³ï¼šæŒ‰å†œå†æœˆ + æ—¶æ”¯
    if(lunarMonth != null && hourZhi){
      const map = {
        1:'å¯…', 2:'å¯', 3:'ç”³', 4:'ä¸‘', 5:'æˆŒ', 6:'é…‰',
        7:'å·³', 8:'äº¥', 9:'åˆ', 10:'æœª', 11:'äº¥', 12:'å­'
      };
      const target = map[lunarMonth];
      if(target && hourZhi === target){
        push('æ–­æ¡¥å…³', `å†œå†${lunarMonth}æœˆè§${hourZhi}æ—¶`);
      }
    }

    return results;
  }


  function findGroupByYearDayZhi(yearZhi, dayZhi){
    const base = dayZhi || yearZhi;
    for(const k of Object.keys(GROUPS)){
      if(GROUPS[k].includes(base)) return k;
    }
    return null;
  }

  function detectGroupShenSha(pillars){
    const zhis = [pillars.yearZhi, pillars.monthZhi, pillars.dayZhi, pillars.timeZhi].filter(Boolean);
    const groupKey = findGroupByYearDayZhi(pillars.yearZhi, pillars.dayZhi);

    const results = [];

    function pushIf(name, targetZhi, luck){
      if(!targetZhi) return;
      if(zhis.includes(targetZhi)){
        results.push({ name, target: targetZhi, luck });
      }
    }

    if(groupKey){
      pushIf('æ¡ƒèŠ±', TAOHUA_MAP[groupKey], 'ä¸­æ€§ååŠ¨');
      // å’¸æ± å¤šä¸æ¡ƒèŠ±åŒæ³•ï¼Œå•ç‹¬åˆ—å‡ºä¾¿äºå­¦ä¹ ä¸æ£€ç´¢
      pushIf('å’¸æ± ', TAOHUA_MAP[groupKey], 'ä¸­æ€§');

      pushIf('é©¿é©¬', YIMA_MAP[groupKey], 'åŠ¨');
      pushIf('åç›–', HUAGAI_MAP[groupKey], 'ä¸­æ€§');
      pushIf('å°†æ˜Ÿ', JIANGXING_MAP[groupKey], 'å‰');

      // ä»¥å¹´/æ—¥æ”¯ä¸‰åˆå±€ä¸ºä¸»çš„å‡¶ç…
      pushIf('äº¡ç¥', WANGSHEN_MAP[groupKey], 'å‡¶');
      pushIf('å…­å„ç…', LIUE_MAP[groupKey], 'å‡¶');
      pushIf('ç¾ç…', ZAISHA_MAP[groupKey], 'å‡¶');
      pushIf('åŠ«ç…', JIESHA_MAP[groupKey], 'å‡¶');
      pushIf('ç™½è™', BAIHU_MAP[groupKey], 'å‡¶');
    }

    return { groupKey, results };
  }

  // v11.7b: è‡ªåŠ¨å‘½ä¸­ä¾æ®å°æ ‡ç­¾ï¼ˆç”¨äºå­¦ä¹ è¾…åŠ©ï¼‰
function inferHitTag(name, rule, kind){
  const r = (rule || '').toString();

  if(kind === 'group'){
    return 'ä¸‰åˆç»„';
  }

  if(name === 'é“æ‰«æŠŠ' || r.includes('æ€§åˆ«')){
    return 'æ€§åˆ«';
  }

  if(r.includes('çº³éŸ³')){
    return 'çº³éŸ³+æœˆ';
  }

  if(r.includes('æ—¥å¹²') && (r.includes('è§') || r.includes('å¯¹åº”') || r.includes('å¯¹åº”åœ°æ”¯'))){
    return 'æ—¥å¹²å¯¹æ”¯';
  }

  if(r.includes('å†œå†') && (r.includes('æ—¶') || r.includes('æ—¶è¾°'))){
    return 'æœˆ+æ—¶';
  }

  if(r.includes('å­£èŠ‚') && (r.includes('æ—¶') || r.includes('æ—¶è¾°'))){
    return 'å­£èŠ‚+æ—¶';
  }

  if(r.includes('å¹´æ”¯') && (r.includes('æ—¶') || r.includes('æ—¶è¾°'))){
    return 'å¹´æ”¯+æ—¶';
  }

  if(r.includes('æ—¥å¹²') && (r.includes('æ—¶') || r.includes('æ—¶è¾°'))){
    return 'æ—¥å¹²+æ—¶';
  }

  return '';
}

function renderInlineShenSha(pillars){
    const { groupKey, results: groupResults } = detectGroupShenSha(pillars);
    const autoResults = detectAutoShenSha(pillars);
    const childResults = detectChildGuanSha(pillars);

    const parts = [];
    if(groupKey){
      parts.push(`ç»„åˆ«å‚è€ƒï¼š<b style="color:var(--accent-2)">${groupKey}</b>`);
    }else{
      parts.push('æœªè¯†åˆ«åœ°æ”¯ä¸‰åˆç»„ï¼ˆä¸å½±å“å¹²æ”¯/æ—¥æŸ±ç±»ç¥ç…åˆ¤å®šï¼‰ã€‚');
    }

    const badgeHtml = [];
const esc = (s)=> (s ?? '').toString()
  .replace(/&/g, '&amp;')
  .replace(/</g, '&lt;')
  .replace(/>/g, '&gt;')
  .replace(/"/g, '&quot;')
  .replace(/'/g, '&#39;');

if(groupResults && groupResults.length){
  groupResults.forEach(r => {
    const ruleStr = `è§${r.target}`;
    const tag = inferHitTag(r.name, ruleStr, 'group');
    const tagHtml = tag ? ` <span class="ss-hit-tag">${tag}</span>` : '';
    badgeHtml.push(
      `<span class="ss-inline-badge" data-kind="group" data-name="${esc(r.name)}" data-rule="${esc(ruleStr)}" data-luck="${esc(r.luck || '')}" data-tag="${esc(tag || '')}">` +
      `${r.name}ï¼ˆè§${r.target} Â· ${r.luck}ï¼‰${tagHtml}</span>`
    );
  });
}

if(autoResults && autoResults.length){
  autoResults.forEach(r => {
    const ruleText = r.rule ? ` Â· ${r.rule}` : '';
    const tag = inferHitTag(r.name, r.rule || '', 'adult');
    const tagHtml = tag ? ` <span class="ss-hit-tag">${tag}</span>` : '';
    badgeHtml.push(
      `<span class="ss-inline-badge" data-kind="adult" data-name="${esc(r.name)}" data-rule="${esc(r.rule || '')}" data-luck="${esc(r.luck || '')}" data-tag="${esc(tag || '')}">` +
      `${r.name}${ruleText} Â· ${r.luck}${tagHtml}</span>`
    );
  });
}

if(childResults && childResults.length){
  childResults.forEach(r => {
    const ruleText = r.rule ? ` Â· ${r.rule}` : '';
    const tag = inferHitTag(r.name, r.rule || '', 'child');
    const tagHtml = tag ? ` <span class="ss-hit-tag">${tag}</span>` : '';
    badgeHtml.push(
      `<span class="ss-inline-badge child" data-kind="child" data-name="${esc(r.name)}" data-rule="${esc(r.rule || '')}" data-tag="${esc(tag || '')}">` +
      `${r.name}${ruleText}${tagHtml}</span>`
    );
  });
}

    if(!badgeHtml.length){
      els.ssInlineResult.innerHTML = `${parts.join('<br/>')}<br/>å½“å‰å››æŸ±æœªè§¦å‘å·²å†…ç½®çš„è‡ªåŠ¨åˆ¤å®šè§„åˆ™ã€‚`;
      return;
    }

    els.ssInlineResult.innerHTML = `${parts.join('<br/>')}<br/><div class="ss-inline-list">${badgeHtml.join('')}</div>`;
  }


  /* ===================== å¯¹ç…§ç›˜


  /* ===================== å¯¹ç…§ç›˜ ===================== */
  function calculatePayload(){
    const s = getSelectedSolarParts();
    const solar = Solar.fromYmdHms(s.y, s.m, s.d, s.h, s.min, 0);
    const lunar = solar.getLunar();
    const bazi = lunar.getEightChar();

    const yearGan = bazi.getYearGan();
    const yearZhi = bazi.getYearZhi();
    const monthGan = bazi.getMonthGan();
    const monthZhi = bazi.getMonthZhi();
    const dayGan = bazi.getDayGan();
    const dayZhi = bazi.getDayZhi();
    const timeGan = bazi.getTimeGan();
    const timeZhi = bazi.getTimeZhi();

    const lunarText =
      `å†œå†ï¼š${lunar.getYearInGanZhi()}å¹´ ` +
      `${lunar.getMonthInChinese()}æœˆ ` +
      `${lunar.getDayInChinese()} ` +
      `${lunar.getTimeZhi()}æ—¶`;

    const solarText = `${solar.getYear()}-${pad2(solar.getMonth())}-${pad2(solar.getDay())} ${pad2(solar.getHour())}:${pad2(solar.getMinute ? solar.getMinute() : s.min)}`;

    const pillarGZ = {
      year: yearGan+yearZhi,
      month: monthGan+monthZhi,
      day: dayGan+dayZhi,
      time: timeGan+timeZhi
    };

    return {
      solar, lunar, bazi,
      solarParts: s,
      solarText, lunarText,
      pillars: { yearGan, yearZhi, monthGan, monthZhi, dayGan, dayZhi, timeGan, timeZhi,
                 lunarMonthNum: safeCall(lunar, 'getMonth'),
                 yearAnimal: safeCall(lunar, 'getYearShengXiao'),
                 yearNayin: nayinForGanZhi(yearGan + yearZhi),
                 yearNayinElement: (function(){ const ny = nayinForGanZhi(yearGan + yearZhi) || ''; const last = ny.slice(-1); return 'é‡‘æœ¨æ°´ç«åœŸ'.includes(last) ? last : ''; })(),
                 gender: genderForYun },
      pillarGZ,
      baziText: `${pillarGZ.year} ${pillarGZ.month} ${pillarGZ.day} ${pillarGZ.time}`
    };
  }

  function calculate(render=true){
    if(!ensureLunarLib()){
      alert('æ’ç›˜åº“åŠ è½½å¤±è´¥ï¼šè¯·æ£€æŸ¥ç½‘ç»œæˆ–ç¨åé‡è¯•ã€‚');
      return null;
    }
    try{
      const data = calculatePayload();
      if(!render) return data;

      els.result.style.display = 'block';
      els.copyBtn.disabled = false;

      els.lunarInfo.textContent = data.lunarText;

      els.yearGan.textContent = data.pillars.yearGan;
      els.yearZhi.textContent = data.pillars.yearZhi;
      els.monthGan.textContent = data.pillars.monthGan;
      els.monthZhi.textContent = data.pillars.monthZhi;
      els.dayGan.textContent = data.pillars.dayGan;
      els.dayZhi.textContent = data.pillars.dayZhi;
      els.timeGan.textContent = data.pillars.timeGan;
      els.timeZhi.textContent = data.pillars.timeZhi;

      const dg = data.pillars.dayGan;
      els.yearSub.innerHTML = buildPillarSub(dg, data.pillars.yearGan, data.pillars.yearZhi);
      els.monthSub.innerHTML = buildPillarSub(dg, data.pillars.monthGan, data.pillars.monthZhi);
      els.daySub.innerHTML = buildPillarSub(dg, dg, data.pillars.dayZhi);
      els.timeSub.innerHTML = buildPillarSub(dg, data.pillars.timeGan, data.pillars.timeZhi);

      const date = new Date(data.solarParts.y, data.solarParts.m-1, data.solarParts.d, 12, 0, 0);
      renderJieQiSection(date);

      renderInlineShenSha(data.pillars);

      els.tzHint.textContent = `æç¤ºï¼šæ’ç›˜æŒ‰è®¾å¤‡æœ¬åœ°æ—¶åŒºè®¡ç®—ï¼ˆ${getTZ()}ï¼‰ã€‚`;

      const timeStr = els.minuteToggle.checked
        ? `${pad2(Number(els.hourRange.value))}:${pad2(Number(els.minuteRange.value || 0))}`
        : `${pad2(Number(els.hourRange.value))}:00`;

      const inputDesc = currentMode === MODE.SOLAR
        ? `è¾“å…¥ï¼ˆå…¬å†ï¼‰ï¼š${Number(els.yearRange.value)}-${pad2(Number(els.monthRange.value))}-${pad2(Number(els.dayRange.value))} ${timeStr}`
        : `è¾“å…¥ï¼ˆå†œå†ï¼‰ï¼š${Number(els.yearRange.value)}å¹´${Number(els.monthRange.value)}æœˆ${els.leapToggle.checked ? 'ï¼ˆé—°ï¼‰' : ''}${Number(els.dayRange.value)}æ—¥ ${timeStr}`;

      calculate._lastCopy = [
        inputDesc,
        `æ¢ç®—å…¬å†ï¼š${data.solarText}`,
        data.lunarText,
        `å…«å­—ï¼š${data.baziText}`,
        `æ—¥ä¸»ï¼š${data.pillars.dayGan}`,
        '',
        'ç¥ç…ï¼ˆè¯•è¡Œç‰ˆï¼‰ï¼š',
        (detectGroupShenSha(data.pillars).results || []).map(r => `${r.name}ï¼ˆè§${r.target}ï¼‰`).join('ã€') || 'â€”'
      ].join('\n');

      showToast('æ’ç›˜å®Œæˆ');
      renderCompareIfPossible(null);
      return data;

    }catch(e){
      console.error(e);
      alert('è®¡ç®—å¤±è´¥ï¼šè¯·æ£€æŸ¥æ—¥æœŸæ˜¯å¦æœ‰æ•ˆï¼ˆå°¤å…¶å†œå†é—°æœˆï¼‰ã€‚');
      return null;
    }
  }

  async function copyResult(){
    const text = calculate._lastCopy;
    if(!text){ showToast('è¿˜æ²¡æœ‰ç»“æœå¯å¤åˆ¶'); return; }
    try{
      await navigator.clipboard.writeText(text);
      showToast('å·²å¤åˆ¶');
    }catch{
      showToast('å¤åˆ¶å¤±è´¥');
    }
  }

  function setAsA(){
    const data = calculate(false);
    if(!data){ showToast('Aç›˜è®¾ç½®å¤±è´¥'); return; }
    compareA = {
      solarText: data.solarText,
      lunarText: data.lunarText,
      baziText: data.baziText,
      dayGan: data.pillars.dayGan
    };
    showToast('å·²è®¾ä¸º A ç›˜');
    renderCompareIfPossible(null);
  }

  function compareWithCurrentAsB(){
    if(!compareA){ showToast('å…ˆè®¾ä¸€ä¸ª A ç›˜'); return; }
    const data = calculate(false);
    if(!data){ showToast('Bç›˜ç”Ÿæˆå¤±è´¥'); return; }
    const compareB = {
      solarText: data.solarText,
      lunarText: data.lunarText,
      baziText: data.baziText,
      dayGan: data.pillars.dayGan
    };
    renderCompareIfPossible(compareB);
    showToast('å¯¹ç…§å·²æ›´æ–°');
  }

  function renderCompareIfPossible(compareB){
    if(!compareA){
      els.compareBox.style.display = 'none';
      return;
    }

    els.compareBox.style.display = 'block';
    els.compareALine.textContent = compareA.baziText;
    els.compareAMeta.textContent = `${compareA.solarText}\n${compareA.lunarText}\næ—¥ä¸»ï¼š${compareA.dayGan}`;

    if(compareB){
      els.compareBLine.textContent = compareB.baziText;
      els.compareBMeta.textContent = `${compareB.solarText}\n${compareB.lunarText}\næ—¥ä¸»ï¼š${compareB.dayGan}`;
    }else{
      els.compareBLine.textContent = 'â€”';
      els.compareBMeta.textContent = 'ç­‰å¾…ä½ ç”¨å½“å‰æ—¶é—´ç”Ÿæˆ B ç›˜';
    }
  }

  function clearA(){
    compareA = null;
    els.compareBox.style.display = 'none';
    showToast('Aç›˜å·²æ¸…ç©º');
  }

  /* ===================== æ—ºè¡°å–œç”¨ï¼ˆç®€åŒ–ï¼‰ ===================== */
  function elementOfGan(gan){ return GAN_INFO[gan]?.e || ''; }
  function elementScoreInit(){ return { 'æœ¨':0, 'ç«':0, 'åœŸ':0, 'é‡‘':0, 'æ°´':0 }; }
  function addScore(map, e, v){ if(e) map[e] = (map[e] || 0) + v; }

  function scoreFromPillars(pillars){
    const stemW = 1.2;
    const branchMainW = 1.0;
    const monthBranchBonus = 1.6;

    const totals = elementScoreInit();
    const explainBits = [];

    ['yearGan','monthGan','dayGan','timeGan'].forEach(k=>{
      const gan = pillars[k];
      const e = elementOfGan(gan);
      addScore(totals, e, stemW);
    });

    function addBranch(zhi, weight, label){
      const hide = hiddenGansForZhi(zhi) || '';
      if(!hide){
        explainBits.push(`${label}${zhi}ï¼šæ— è—å¹²ä¿¡æ¯ï¼ˆä½¿ç”¨å…œåº•ï¼‰ã€‚`);
        return;
      }
      const eachW = weight / hide.length;
      hide.split('').forEach(g=>{
        addScore(totals, elementOfGan(g), eachW);
      });
    }

    addBranch(pillars.yearZhi, branchMainW, 'å¹´æ”¯');
    addBranch(pillars.dayZhi, branchMainW, 'æ—¥æ”¯');
    addBranch(pillars.timeZhi, branchMainW, 'æ—¶æ”¯');
    addBranch(pillars.monthZhi, branchMainW + monthBranchBonus, 'æœˆä»¤');

    return { totals, explainBits, params: { stemW, branchMainW, monthBranchBonus } };
  }

  function dmStrengthJudge(pillars){
    const dayGan = pillars.dayGan;
    const dmE = elementOfGan(dayGan);

    const { totals, explainBits, params } = scoreFromPillars(pillars);

    const resourceE = GEN_PREV[dmE];
    const sameE = dmE;

    const support = (totals[sameE] || 0) + (totals[resourceE] || 0);
    const totalAll = Object.values(totals).reduce((a,b)=>a+b,0);

    const ratio = totalAll > 0 ? support / totalAll : 0.2;

    let level = 'ä¸­å’Œ';
    if(ratio >= 0.46) level = 'åå¼º';
    if(ratio >= 0.56) level = 'èº«å¼º';
    if(ratio <= 0.30) level = 'åå¼±';
    if(ratio <= 0.22) level = 'èº«å¼±';

    const reason = [];
    reason.push(`æ—¥ä¸»ï¼š${dayGan}ï¼ˆ${dmE}ï¼‰`);
    reason.push(`åŒæˆ‘(${sameE}) + ç”Ÿæˆ‘(${resourceE}) ä¹‹åˆè®¡æƒé‡ / äº”è¡Œæ€»æƒé‡ â‰ˆ ${(ratio*100).toFixed(1)}%`);
    reason.push(`æƒé‡ï¼šå¤©å¹²${params.stemW}ï¼›åœ°æ”¯æ€»æƒé‡${params.branchMainW}ï¼›æœˆä»¤é¢å¤–+${params.monthBranchBonus}`);

    let favorable = [];
    let avoid = [];
    if(level === 'èº«å¼º' || level === 'åå¼º'){
      favorable = [ GEN_NEXT[dmE], CONTROL[dmE] ];
      avoid = [ dmE, resourceE ];
    }else if(level === 'èº«å¼±' || level === 'åå¼±'){
      favorable = [ dmE, resourceE ];
      avoid = [ CONTROLLED_BY[dmE], GEN_NEXT[dmE] ];
    }else{
      favorable = [ dmE, GEN_NEXT[dmE] ];
      avoid = [];
    }

    return {
      dmE, dayGan, totals, support, totalAll, ratio, level,
      favorable, avoid,
      explain: reason.concat(explainBits).join('\n')
    };
  }

  function renderWs(){
    const data = calculate(false);
    if(!data){ showToast('å…ˆåœ¨æ’ç›˜é¡µä¿è¯æ—¥æœŸæœ‰æ•ˆ'); return; }

    const judge = dmStrengthJudge(data.pillars);

    const levelClass = (judge.level.includes('å¼º')) ? 'ws-strong' :
                       (judge.level.includes('å¼±')) ? 'ws-weak' : 'ws-mid';

    const favText = judge.favorable.map(e => `${e}`).join(' / ');
    const avoidText = judge.avoid.length ? judge.avoid.join(' / ') : 'â€”';

    const totalsLine = `äº”è¡Œæƒé‡ï¼ˆç®€åŒ–ï¼‰ï¼šæœ¨${judge.totals['æœ¨'].toFixed(2)} Â· ç«${judge.totals['ç«'].toFixed(2)} Â· åœŸ${judge.totals['åœŸ'].toFixed(2)} Â· é‡‘${judge.totals['é‡‘'].toFixed(2)} Â· æ°´${judge.totals['æ°´'].toFixed(2)}`;

    els.wsConclusion.innerHTML = [
      `<span class="ws-badge ${levelClass}">åˆ¤æ–­ï¼š${judge.level}</span>`,
      `æ—¥ä¸»äº”è¡Œï¼š<b style="color:var(--accent-2)">${judge.dmE}</b>`,
      `å–œç”¨å€¾å‘ï¼ˆç®€åŒ–ï¼‰ï¼š<b style="color:var(--good)">${favText}</b>`,
      `å¿Œå‘ï¼ˆç®€åŒ–ï¼‰ï¼š<b style="color:var(--bad)">${avoidText}</b>`,
      totalsLine
    ].join('<br/>');

    els.wsExplain.textContent = judge.explain;

    els.wsResult.style.display = 'block';
    els.wsCopyBtn.disabled = false;

    renderWs._lastCopy = [
      `å…«å­—ï¼š${data.baziText}`,
      `æ—¥ä¸»ï¼š${judge.dayGan}ï¼ˆ${judge.dmE}ï¼‰`,
      `æ—ºè¡°åˆ¤æ–­ï¼š${judge.level}`,
      `å–œç”¨å€¾å‘ï¼ˆç®€åŒ–ï¼‰ï¼š${favText}`,
      `å¿Œå‘ï¼ˆç®€åŒ–ï¼‰ï¼š${avoidText}`,
      totalsLine,
      '',
      'è§£é‡Šï¼š',
      judge.explain
    ].join('\n');

    showToast('æ—ºè¡°/å–œç”¨å·²ç”Ÿæˆ');
  }

  async function copyWs(){
    const text = renderWs._lastCopy;
    if(!text){ showToast('è¿˜æ²¡æœ‰æ—ºè¡°è¯´æ˜'); return; }
    try{
      await navigator.clipboard.writeText(text);
      showToast('å·²å¤åˆ¶');
    }catch{
      showToast('å¤åˆ¶å¤±è´¥');
    }
  }

  /* ===================== æµå¹´ä¸å¤§è¿ ===================== */
  function updateFlowYearVal(){
    els.flowYearVal.textContent = `${Number(els.flowYearRange.value)}`;
  }

  function buildFlowList(baseYear){
    const list = [];
    for(let y=baseYear-5; y<=baseYear+5; y++){
      try{
        const s = Solar.fromYmdHms(y, 6, 1, 12, 0, 0);
        const l = s.getLunar();
        const gz = l.getYearInGanZhi ? l.getYearInGanZhi() : (l.getYearInGanZhiExact ? l.getYearInGanZhiExact() : '');
        list.push({ year: y, gz: gz || 'â€”', note: '' });
      }catch(e){
        list.push({ year: y, gz: 'â€”', note: '' });
      }
    }
    return list;
  }

  function renderFlow(){
    if(!ensureLunarLib()){
      alert('æ’ç›˜åº“åŠ è½½å¤±è´¥ï¼šè¯·æ£€æŸ¥ç½‘ç»œã€‚');
      return;
    }

    const baseYear = Number(els.flowYearRange.value);
    const flow = buildFlowList(baseYear);

    els.flowList.innerHTML = '';
    const frag = document.createDocumentFragment();
    const copyLines = [];

    flow.forEach(item=>{
      const div = document.createElement('div');
      div.className = 'luck-item';

      const tag = document.createElement('span');
      tag.className = 'tag';
      tag.textContent = item.year;

      const gz = document.createElement('span');
      gz.className = 'gz';
      gz.textContent = item.gz;

      const meta = document.createElement('span');
      meta.className = 'meta';
      meta.textContent = 'æµå¹´';

      div.appendChild(tag);
      div.appendChild(gz);
      div.appendChild(meta);
      frag.appendChild(div);

      copyLines.push(`${item.year}ï¼š${item.gz}`);
    });

    els.flowList.appendChild(frag);
    els.flowCopyBtn.disabled = false;
    renderFlow._lastCopy = `æµå¹´ï¼ˆ${baseYear-5} - ${baseYear+5}ï¼‰\n` + copyLines.join('\n');

    renderDayun();
    showToast('æµå¹´åˆ—è¡¨å·²ç”Ÿæˆ');
  }

  async function copyFlow(){
    const text = renderFlow._lastCopy;
    if(!text){ showToast('è¿˜æ²¡æœ‰æµå¹´'); return; }
    try{
      await navigator.clipboard.writeText(text);
      showToast('å·²å¤åˆ¶æµå¹´');
    }catch{
      showToast('å¤åˆ¶å¤±è´¥');
    }
  }

  function renderDayun(){
    els.dayunList.innerHTML = '';
    els.dayunExplain.textContent = '';

    let data = null;
    try{ data = calculate(false); }catch(e){}

    if(!data){
      els.dayunHint.textContent = 'è¯·å…ˆç¡®ä¿â€œæ’ç›˜â€é¡µå¯æ­£å¸¸è®¡ç®—ã€‚';
      return;
    }

    const eightChar = data.bazi;

    if(!eightChar || typeof eightChar.getYun !== 'function'){
      els.dayunHint.textContent = 'å½“å‰åŠ è½½çš„ lunar-javascript ç‰ˆæœ¬æœªæš´éœ² getYun æ¥å£ï¼Œå¤§è¿è®¡ç®—ä¸å¯ç”¨ï¼ˆä»…ä¿ç•™æµå¹´åŠŸèƒ½ï¼‰ã€‚';
      return;
    }

    let yun = null;
    try{
      yun = eightChar.getYun.length >= 2 ? eightChar.getYun(genderForYun, 0) : eightChar.getYun(genderForYun);
    }catch(e){
      try{ yun = eightChar.getYun(genderForYun); }catch(e2){}
    }

    if(!yun){
      els.dayunHint.textContent = 'å¤§è¿å¯¹è±¡ç”Ÿæˆå¤±è´¥ï¼ˆå¯èƒ½æ˜¯åº“ç‰ˆæœ¬/å‚æ•°å·®å¼‚ï¼‰ã€‚';
      return;
    }

    const startAge = (typeof yun.getStartAge === 'function') ? yun.getStartAge() : null;
    const startYear = (typeof yun.getStartYear === 'function') ? yun.getStartYear() : null;

    const headerBits = [];
    if(startAge != null) headerBits.push(`èµ·è¿å¹´é¾„â‰ˆ${startAge}`);
    if(startYear != null) headerBits.push(`èµ·è¿å¹´â‰ˆ${startYear}`);
    els.dayunHint.textContent = headerBits.length ? `å¤§è¿ï¼ˆåº“è®¡ç®—ï¼‰ï¼š${headerBits.join(' Â· ')}` : `å¤§è¿ï¼ˆåº“è®¡ç®—ï¼‰ï¼šå·²ç”Ÿæˆä½†å­—æ®µä¸å¯è¯»ã€‚`;

    let daYunArr = null;
    const candidates = [
      ['getDaYun', 10],
      ['getDaYun', 8],
      ['getDaYun', undefined],
      ['getDaYunList', undefined],
      ['getDaYunArray', undefined]
    ];

    for(const [fnName, arg] of candidates){
      if(typeof yun[fnName] === 'function'){
        try{
          daYunArr = (arg === undefined) ? yun[fnName]() : yun[fnName](arg);
          if(daYunArr && daYunArr.length) break;
        }catch(e){}
      }
    }

    if(!daYunArr || !daYunArr.length){
      els.dayunExplain.textContent = 'å·²æ‹¿åˆ° Yun å¯¹è±¡ï¼Œä½†æœªèƒ½ä»è¯¥ç‰ˆæœ¬åº“è·å–å¤§è¿æ•°ç»„ï¼ˆæ–¹æ³•åæˆ–ç­¾åå¯èƒ½ä¸åŒï¼‰ã€‚';
      return;
    }

    const frag = document.createDocumentFragment();
    const lines = [];

    daYunArr.forEach((dy, idx)=>{
      let gz = '';
      let age = '';
      let year = '';

      try{
        if(dy.getGanZhi) gz = dy.getGanZhi();
      }catch(e){}

      try{
        if(dy.getStartAge && dy.getEndAge) age = `${dy.getStartAge()}-${dy.getEndAge()}`;
      }catch(e){}

      try{
        if(dy.getStartYear && dy.getEndYear) year = `${dy.getStartYear()}-${dy.getEndYear()}`;
      }catch(e){}

      const div = document.createElement('div');
      div.className = 'luck-item';

      const tag = document.createElement('span');
      tag.className = 'tag';
      tag.textContent = `ç¬¬${idx+1}è¿`;

      const gzSpan = document.createElement('span');
      gzSpan.className = 'gz';
      gzSpan.textContent = gz || 'â€”';

      const meta = document.createElement('span');
      meta.className = 'meta';
      const metaBits = [];
      if(age) metaBits.push(`é¾„${age}`);
      if(year) metaBits.push(`å¹´${year}`);
      meta.textContent = metaBits.join(' ') || 'å¤§è¿';

      div.appendChild(tag);
      div.appendChild(gzSpan);
      div.appendChild(meta);
      frag.appendChild(div);

      lines.push(`ç¬¬${idx+1}è¿ï¼š${gz || 'â€”'} ${meta.textContent ? '('+meta.textContent+')' : ''}`);
    });

    els.dayunList.appendChild(frag);
    els.dayunExplain.textContent = 'æç¤ºï¼šå¤§è¿å±•ç¤ºä¾èµ–åº“æ¥å£ã€‚è‹¥å­—æ®µä¸ºç©ºï¼Œå¤šä¸º CDN ç‰ˆæœ¬å·®å¼‚ã€‚';

    renderDayun._lastCopy = [
      `å…«å­—ï¼š${data.baziText}`,
      `æ€§åˆ«å‚æ•°ï¼ˆç”¨äºåº“å¤§è¿ï¼‰ï¼š${genderForYun ? 'ç”·' : 'å¥³'}`,
      els.dayunHint.textContent,
      ...lines
    ].join('\n');
  }

  /* ===================== å…¨å¹´èŠ‚æ°” ===================== */
  function updateJieqiYearVal(){
    els.jieqiYearVal.textContent = `${Number(els.jieqiYearRange.value)}`;
  }

  function collectJieqiForYear(year){
    const found = new Map();

    for(let day=1; day<=366; day++){
      const d = new Date(year, 0, day, 12, 0, 0);
      if(d.getFullYear() !== year) break;

      try{
        const s = Solar.fromYmdHms(d.getFullYear(), d.getMonth()+1, d.getDate(), 12, 0, 0);
        const name = jieQiNameForSolar(s);
        if(name && !found.has(name)){
          found.set(name, new Date(d.getTime()));
        }
      }catch(e){}
    }

    return JIEQI_ORDER.map(n => ({ name: n, date: found.get(n) || null }));
  }

  function renderJieqiList(year){
    if(!ensureLunarLib()){
      els.jieqiQueryHint.textContent = 'èŠ‚æ°”åº“æœªåŠ è½½æˆåŠŸï¼Œè¯·æ£€æŸ¥ç½‘ç»œã€‚';
      return;
    }

    els.jieqiList.innerHTML = '';
    els.jieqiCopyBtn.disabled = true;
    els.jieqiQueryHint.textContent = 'æ­£åœ¨è®¡ç®—ä¸­â€¦';

    const list = collectJieqiForYear(year);

    const frag = document.createDocumentFragment();
    const linesForCopy = [];

    list.forEach(item => {
      const div = document.createElement('div');
      div.className = 'jieqi-item';

      const nameSpan = document.createElement('span');
      nameSpan.className = 'name';
      nameSpan.textContent = item.name;

      const dateSpan = document.createElement('span');
      dateSpan.className = 'date';
      if(item.date){
        const ds = fmtYMD(item.date);
        dateSpan.textContent = ds;
        linesForCopy.push(`${item.name}ï¼š${ds}`);
      }else{
        dateSpan.textContent = 'â€”';
        linesForCopy.push(`${item.name}ï¼šâ€”`);
      }

      div.appendChild(nameSpan);
      div.appendChild(dateSpan);
      frag.appendChild(div);
    });

    els.jieqiList.appendChild(frag);
    els.jieqiQueryHint.textContent = `å·²ç”Ÿæˆ ${year} å¹´äºŒåå››èŠ‚æ°”æ—¥æœŸï¼ˆæŒ‰è®¾å¤‡æ—¶åŒºè¿‘ä¼¼ï¼‰ã€‚`;
    els.jieqiCopyBtn.disabled = false;
    renderJieqiList._lastCopy = `${year}å¹´äºŒåå››èŠ‚æ°”\n` + linesForCopy.join('\n');
  }

  async function copyJieqiList(){
    const text = renderJieqiList._lastCopy;
    if(!text){ showToast('è¿˜æ²¡æœ‰åˆ—è¡¨å¯å¤åˆ¶'); return; }
    try{
      await navigator.clipboard.writeText(text);
      showToast('èŠ‚æ°”åˆ—è¡¨å·²å¤åˆ¶');
    }catch{
      showToast('å¤åˆ¶å¤±è´¥');
    }
  }

  /* ===================== é»„å† / ä¸‡å¹´å† ===================== */
  function setAlmanacDateInput(date){
    const y = date.getFullYear();
    const m = pad2(date.getMonth()+1);
    const d = pad2(date.getDate());
    els.almanacDate.value = `${y}-${m}-${d}`;
  }

  function safeCall(obj, fn){
    try{
      if(obj && typeof obj[fn] === 'function') return obj[fn]();
    }catch(e){}
    return null;
  }

  function renderAlmanac(){
    if(!ensureLunarLib()){
      alert('é»„å†åº“åŠ è½½å¤±è´¥ï¼šè¯·æ£€æŸ¥ç½‘ç»œã€‚');
      return;
    }
    if(!els.almanacDate.value){
      showToast('å…ˆé€‰æ—¥æœŸ');
      return;
    }

    const [y,m,d] = els.almanacDate.value.split('-').map(Number);
    const solar = Solar.fromYmdHms(y, m, d, 12, 0, 0);
    const lunar = solar.getLunar();

    const dayGZ = safeCall(lunar, 'getDayInGanZhi') || safeCall(lunar, 'getDayInGanZhiExact') || '';
    const yearGZ = safeCall(lunar, 'getYearInGanZhi') || '';
    const monthGZ = safeCall(lunar, 'getMonthInGanZhi') || safeCall(lunar, 'getMonthInGanZhiExact') || '';

    const animal = safeCall(lunar, 'getYearShengXiao') || '';
    const lunarText = `å†œå†ï¼š${lunar.getYearInGanZhi ? lunar.getYearInGanZhi() : yearGZ}å¹´ ${lunar.getMonthInChinese ? lunar.getMonthInChinese() : ''}æœˆ ${lunar.getDayInChinese ? lunar.getDayInChinese() : ''}`;

    const chong = safeCall(lunar, 'getDayChong') || '';
    const sha = safeCall(lunar, 'getDaySha') || safeCall(lunar, 'getDayChongSha') || '';
    const jiShen = safeCall(lunar, 'getDayJiShen') || '';
    const xiongSha = safeCall(lunar, 'getDayXiongSha') || '';
    const zhiShen = safeCall(lunar, 'getDayZhiShen') || '';

    let jieqi = '';
    try{ jieqi = jieQiNameForSolar(solar) || ''; }catch(e){}

    const kvLines = [];
    kvLines.push(`å…¬å†ï¼š<b>${fmtYMD(new Date(y, m-1, d))}</b>`);
    kvLines.push(`${lunarText}`);
    if(animal) kvLines.push(`ç”Ÿè‚–ï¼š<b>${animal}</b>`);
    if(yearGZ) kvLines.push(`å¹´å¹²æ”¯ï¼š<b>${yearGZ}</b>`);
    if(monthGZ) kvLines.push(`æœˆå¹²æ”¯ï¼š<b>${monthGZ}</b>`);
    if(dayGZ) kvLines.push(`æ—¥å¹²æ”¯ï¼š<b>${dayGZ}</b>`);
    if(jieqi) kvLines.push(`èŠ‚æ°”ç‚¹ï¼š<b>${jieqi}</b>`);

    if(chong) kvLines.push(`æ—¥å†²ï¼š<b>${chong}</b>`);
    if(sha) kvLines.push(`å†²ç…ï¼š<b>${sha}</b>`);
    if(zhiShen) kvLines.push(`å€¼ç¥ï¼š<b>${zhiShen}</b>`);
    if(jiShen) kvLines.push(`å‰ç¥ï¼š<b class="badge-good">${jiShen}</b>`);
    if(xiongSha) kvLines.push(`å‡¶ç…ï¼š<b class="badge-bad">${xiongSha}</b>`);

    els.almanacKV.innerHTML = kvLines.join('<br/>');
    els.almanacResult.style.display = 'block';

    const yi = safeCall(lunar, 'getDayYi');
    const ji = safeCall(lunar, 'getDayJi');

    const yiArr = Array.isArray(yi) ? yi : (yi ? String(yi).split(',') : []);
    const jiArr = Array.isArray(ji) ? ji : (ji ? String(ji).split(',') : []);

    const yiJiLines = [];
    if(yiArr.length) yiJiLines.push(`å®œï¼š<b class="badge-good">${yiArr.join('ã€')}</b>`);
    if(jiArr.length) yiJiLines.push(`å¿Œï¼š<b class="badge-bad">${jiArr.join('ã€')}</b>`);

    if(yiJiLines.length){
      els.almanacYiJi.innerHTML = yiJiLines.join('<br/>');
      els.almanacYiJiSec.style.display = 'block';
    }else{
      els.almanacYiJiSec.style.display = 'none';
    }

    els.almanacCopyBtn.disabled = false;
    renderAlmanac._lastCopy = [
      `é»„å†ï¼ˆ${fmtYMD(new Date(y, m-1, d))}ï¼‰`,
      lunarText,
      yearGZ ? `å¹´å¹²æ”¯ï¼š${yearGZ}` : '',
      monthGZ ? `æœˆå¹²æ”¯ï¼š${monthGZ}` : '',
      dayGZ ? `æ—¥å¹²æ”¯ï¼š${dayGZ}` : '',
      animal ? `ç”Ÿè‚–ï¼š${animal}` : '',
      jieqi ? `èŠ‚æ°”ï¼š${jieqi}` : '',
      chong ? `æ—¥å†²ï¼š${chong}` : '',
      sha ? `å†²ç…ï¼š${sha}` : '',
      zhiShen ? `å€¼ç¥ï¼š${zhiShen}` : '',
      jiShen ? `å‰ç¥ï¼š${jiShen}` : '',
      xiongSha ? `å‡¶ç…ï¼š${xiongSha}` : '',
      yiArr.length ? `å®œï¼š${yiArr.join('ã€')}` : '',
      jiArr.length ? `å¿Œï¼š${jiArr.join('ã€')}` : ''
    ].filter(Boolean).join('\n');

    showToast('é»„å†å·²æ›´æ–°');
  }

  async function copyAlmanac(){
    const text = renderAlmanac._lastCopy;
    if(!text){ showToast('è¿˜æ²¡æœ‰é»„å†å†…å®¹'); return; }
    try{
      await navigator.clipboard.writeText(text);
      showToast('é»„å†å·²å¤åˆ¶');
    }catch{
      showToast('å¤åˆ¶å¤±è´¥');
    }
  }

  /* ===================== ç¥ç…å­¦ä¹ è¡¨ï¼ˆå†…ç½®ï¼‰ ===================== */
    const SHENSHA_DATA = [

  {id:'adult_001', name:'æ–‡æ˜Œè´µäºº', group:'å¸¸ç”¨', luck:'å‰', method:'ä»¥å¹´å¹²æˆ–æ—¥å¹²ä¸ºä¸»ï¼Œç”²è§å·³ï¼Œä¹™è§åˆï¼Œä¸™æˆŠè§ç”³ï¼Œä¸å·±è§é…‰ï¼Œåºšè§äº¥ï¼Œè¾›è§å­ï¼Œå£¬è§å¯…ï¼Œç™¸è§å¯ã€‚', effect:'å­¦ä¸šä¸Šå¤©èµ„èªé¢–ã€å­¦ä¹ èƒ½åŠ›å¼ºï¼Œè€ƒè¯•è¿ä½³ï¼Œæ˜“è·å­¦ä¸šæˆå°±ã€‚äº‹ä¸šä¸Šæ°”è´¨æ–‡é›…ã€æ–‡ç« æ˜¾è¾¾ï¼Œé€‚åˆæ•™è‚²ã€æ–‡å­¦ã€æ–‡èŒç­‰é¢†åŸŸã€‚å©šå§»ä¸Šæ€§æ ¼è°¦é€Šæ¸©å’Œï¼Œæ˜“å¸å¼•å¿—åŒé“åˆçš„ä¼´ä¾£ã€‚äº¦æœ‰æŒ¡ç¾ä¹‹è±¡ã€‚'},
  {id:'adult_002', name:'å­¦å ‚', group:'å¸¸ç”¨', luck:'å‰', method:'æŒ‰å¹´æŸ±çº³éŸ³äº”è¡ŒæŸ¥ï¼Œé‡‘å‘½è§å·³ï¼ˆè¾›å·³ä¸ºæ­£ï¼‰ï¼Œæœ¨å‘½è§äº¥ï¼ˆå·±äº¥ä¸ºæ­£ï¼‰ï¼Œæ°´å‘½è§ç”³ï¼ˆç”²ç”³ä¸ºæ­£ï¼‰ï¼ŒåœŸå‘½è§ç”³ï¼ˆæˆŠç”³ä¸ºæ­£ï¼‰ï¼Œç«å‘½è§å¯…ï¼ˆä¸™å¯…ä¸ºæ­£ï¼‰ã€‚', effect:'ä¸»æ—©æœŸæ•™è‚²æ ¹åŸºä¸çŸ¥è¯†å¸æ”¶èƒ½åŠ›ã€‚åœ°æ”¯æ— åˆ‘å†²ä¸”å¾—å®˜å°ç”Ÿæ‰¶æ—¶ï¼Œé¢†æ‚ŸåŠ›å¼ºã€‚é€‚åˆæ•™å¸ˆã€å­¦æœ¯ç ”ç©¶ç­‰å²—ä½ã€‚æ€§æ ¼æ²‰ç¨³å¥½å­¦ï¼Œä½†æ˜“å› ä¸“æ³¨å­¦ä¸šäº‹ä¸šå¿½ç•¥ä¼´ä¾£æ„Ÿå—ã€‚'},
  {id:'adult_003', name:'è¯é¦†', group:'å¸¸ç”¨', luck:'å‰', method:'ä»¥å¹´å¹²æˆ–æ—¥å¹²ä¸ºä¸»ï¼Œç”²è§åºšå¯…ï¼Œä¹™è§è¾›å¯ï¼Œä¸™è§ä¹™å·³ï¼Œä¸è§æˆŠåˆï¼ŒæˆŠè§ä¸å·³ï¼Œå·±è§åºšåˆï¼Œåºšè§å£¬ç”³ï¼Œè¾›è§ç™¸é…‰ï¼Œå£¬è§ç™¸äº¥ï¼Œç™¸è§å£¬æˆŒï¼Œä¸”å…¶çº³éŸ³äº”è¡Œéœ€ä¸å¹´å¹²ã€æ—¥å¹²äº”è¡Œä¸€è‡´ã€‚', effect:'ä¸»å­¦æœ¯é’»ç ”ä¸æ–‡é‡‡ã€‚é€‚åˆæ•™æˆã€å­¦è€…ã€æ–‡æ¡ˆåˆ›ä½œè€…ç­‰ï¼Œåœ¨æ•™è‚²æ–‡åŒ–é¢†åŸŸæ˜“æœ‰å£°åã€‚ç¤¾äº¤åœˆåçª„ï¼Œæ‹©å¶èŠ‚å¥è¾ƒæ…¢ã€‚'},
  {id:'adult_004', name:'æ–‡æ›²æ˜Ÿ', group:'å¸¸ç”¨', luck:'å‰', method:'ä¼ ç»Ÿå‘½ç†ä¸­å¸¸ä»¥å‘½å±€è§è¾°ä¸ºæ–‡æ›²æ˜Ÿï¼Œä¹Ÿå¯ç»“åˆæ–‡æ˜Œï¼ˆå·³ï¼‰åŒç°åˆ¤æ–­ã€‚', effect:'æ™ºæ…§ä¸æ–‡é‡‡çªå‡ºï¼Œæ–‡å­¦è‰ºæœ¯ç§‘ç›®æ›´æ˜“è§é•¿ã€‚é€‚åˆæ–‡å­¦åˆ›ä½œã€æ•™è‚²ã€å…¬èŒç­‰ã€‚ä¸ç…åŒç°æ—¶æ˜“æœ‰æƒæ‰å‚²ç‰©ä¹‹è±¡ã€‚'},
  {id:'adult_005', name:'ç§‘ç”²æ˜Ÿ', group:'å¸¸ç”¨', luck:'å‰', method:'å¹¶éç‹¬ç«‹ç¥ç…ï¼Œéœ€ç»“åˆå®˜æ˜Ÿã€å°æ˜Ÿï¼Œæ­é…æ–‡æ˜Œã€æ–‡æ›²ç­‰ç»¼åˆåˆ¤æ–­ã€‚', effect:'ä¸»ç§‘ä¸¾åŠç¬¬ä¹‹è±¡ï¼Œç°ä»£å¯¹åº”å‡å­¦ã€è€ƒè¯ã€èŒç§°ç­‰ç«äº‰æ€§è€ƒè¯•çš„ä¼˜åŠ¿ã€‚'},
  {id:'adult_006', name:'å¤©ä¹™è´µäºº', group:'å¸¸ç”¨', luck:'å‰', method:'ä»¥æ—¥å¹²ä¸ºä¸»ï¼Œç”²æˆŠè§ä¸‘æœªï¼Œä¹™å·±è§å­ç”³ï¼Œä¸™ä¸è§äº¥é…‰ï¼Œå£¬ç™¸è§å¯å·³ï¼Œåºšè§å¯…åˆã€‚', effect:'é¡¶çº§è´µäººæ˜Ÿã€‚å­¦ä¸šäº‹ä¸šé‡é˜»å¤šå¾—ç‚¹æ‹¨ä¸ææºï¼Œå®˜ç¦„ä¸äººè„‰åŠ©åŠ›å¼ºã€‚æ„Ÿæƒ…å±æœºå¸¸æœ‰äººä»ä¸­è°ƒè§£ã€‚'},
  {id:'adult_007', name:'å›½å°è´µäºº', group:'å¸¸ç”¨', luck:'å‰', method:'ä»¥å¹´å¹²æˆ–æ—¥å¹²ä¸ºä¸»ï¼Œç”²è§æˆŒï¼Œä¹™è§äº¥ï¼Œä¸™è§ä¸‘ï¼Œä¸è§å¯…ï¼ŒæˆŠè§ä¸‘ï¼Œå·±è§å¯…ï¼Œåºšè§è¾°ï¼Œè¾›è§å·³ï¼Œå£¬è§æœªï¼Œç™¸è§ç”³ã€‚', effect:'ä¸»æ­£æ°”ã€è§„çŸ©ä¸æŒæƒä¹‹è±¡ã€‚é€‚åˆä½“åˆ¶å†…ã€ç®¡ç†ä¸æ‰§æ³•ç±»å²—ä½ã€‚å®¶åº­ä¸­å¤šä¸ºå¯é æ”¯æŸ±ã€‚'},
  {id:'adult_008', name:'å¤ªæè´µäºº', group:'å¸¸ç”¨', luck:'å‰', method:'ä»¥å¹´å¹²æˆ–æ—¥å¹²ä¸ºä¸»ï¼Œç”²ä¹™è§å­åˆï¼Œä¸™ä¸è§é…‰å¯ï¼ŒæˆŠå·±è§è¾°æˆŒä¸‘æœªï¼Œåºšè¾›è§å¯…äº¥ï¼Œå£¬ç™¸è§å·³ç”³ã€‚', effect:'èªæ˜å¥½å­¦ï¼Œå–œæ–‡å²å“²ã€å®—æ•™ã€ç„å­¦ç­‰ã€‚å¾—æ‰¶åŠ©å¯å®˜ç¦„å¯æœŸï¼Œäº¦æœ‰æŠ¤èº«ä¹‹è±¡ã€‚'},
  {id:'adult_009', name:'ä¸‰å¥‡è´µäºº', group:'å¸¸ç”¨', luck:'å‰', method:'å¤©ä¸Šä¸‰å¥‡ç”²æˆŠåºšã€åœ°ä¸Šä¸‰å¥‡å£¬ç™¸è¾›ã€äººä¸­ä¸‰å¥‡ä¹™ä¸™ä¸ï¼Œå¤©å¹²é¡ºæ¬¡å‡ºç°ä¸”æ— å†²ç ´ä¸ºçœŸä¸‰å¥‡ã€‚', effect:'ä¸»æ‰åä¸çªç ´åŠ›ï¼Œå­¦ä¸šäº‹ä¸šå¤šå¾—æœºç¼˜ï¼Œé€‚åˆåˆ›æ–°ç§‘ç ”ä¸é«˜é˜¶ä¸“ä¸šè·¯çº¿ã€‚'},
  {id:'adult_010', name:'ç¦æ˜Ÿè´µäºº', group:'å¸¸ç”¨', luck:'å‰', method:'ä»¥æ—¥å¹²ä¸ºä¸»ï¼Œç”²ä¸™è§å¯…ã€ä¹™ç™¸è§å¯ã€ä¸è§äº¥ã€æˆŠè§ç”³ã€å·±è§æœªã€åºšè§åˆã€è¾›è§å·³ã€å£¬è§è¾°ã€‚', effect:'ä¸»é¡ºé‚ä¸ç¦åˆ†ï¼ŒèŒåœºå¢ƒé‡è¾ƒä½³ï¼Œå®¶åº­ç»æµä¸å…³ç³»æ›´æ˜“ç¨³ã€‚'},
  {id:'adult_011', name:'å¤©å¾·è´µäºº', group:'å¸¸ç”¨', luck:'å‰', method:'ä»¥å‡ºç”Ÿå†œå†æœˆä»½å¯¹åº”ã€‚å£è¯€ï¼šæ­£ä¸äºŒç”³ä¸‰å£¬å››è¾›ï¼Œäº”äº¥å…­ç”²ä¸ƒç™¸å…«å¯…ï¼Œä¹ä¸™åä¹™å­å·³ä¸‘åºšã€‚å››æŸ±è§å¯¹åº”å¤©å¹²æˆ–åœ°æ”¯å³ä¸ºå¸¦å¤©å¾·ã€‚', effect:'å¤ç§°â€œä¸€å¾·åŒ–ç™¾ç…â€ï¼Œä¸»è§£å„æŠ¤ä½‘ã€é‡äº‹èƒ½å¾—è½¬æœºã€‚ä¸å°ç»¶ç›¸è¾…æ›´æœ‰å…åˆ‘é¿ç¥¸ä¹‹è±¡ã€‚'},
  {id:'adult_012', name:'æœˆå¾·è´µäºº', group:'å¸¸ç”¨', luck:'å‰', method:'ä»¥å‡ºç”Ÿæœˆæ”¯æŒ‰ä¸‰åˆå±€å–å¤©å¹²ï¼šå¯…åˆæˆŒæœˆè§ä¸™ï¼Œç”³å­è¾°æœˆè§å£¬ï¼Œäº¥å¯æœªæœˆè§ç”²ï¼Œå·³é…‰ä¸‘æœˆè§åºšã€‚å››æŸ±å¤©å¹²è§ä¹‹å³ä¸ºå¸¦æœˆå¾·ã€‚', effect:'åæ¸©å’Œçš„æŠ¤ä½‘æ˜Ÿï¼Œä¸»æš—ä¸­è´µåŠ©ã€å°‘çŠ¯å®˜åˆ‘ã€ç¦åˆ†æ·±åšã€‚'},
  {id:'adult_013', name:'å¤©å¾·åˆ', group:'å¸¸ç”¨', luck:'å‰', method:'ä¸å¤©å¾·è´µäººå¯¹åº”ï¼ŒæŒ‰å‡ºç”Ÿå†œå†æœˆä»½å–å…¶ç›¸åˆä¹‹å¹²/æ”¯ï¼Œå¸¸ä»¥å¤©å¹²äº”åˆã€åœ°æ”¯å…­åˆæ¨æ–­ã€‚', effect:'å‰åŠ›æ¬¡äºå¤©å¾·è´µäººï¼Œå¯ä½œè¡¥ä½è§£å„ï¼Œä¸»è¿åŠ¿è¾ƒå¹³é¡ºã€‚'},
  {id:'adult_014', name:'æœˆå¾·åˆ', group:'å¸¸ç”¨', luck:'å‰', method:'å–ä¸æœˆå¾·è´µäººç›¸åˆä¹‹å¤©å¹²ã€‚å¸¸ç”¨å£å¾„ï¼šå¯…åˆæˆŒæœˆæœˆå¾·ä¸ºä¸™ï¼Œå…¶åˆä¸ºè¾›ï¼›ç”³å­è¾°æœˆæœˆå¾·ä¸ºå£¬ï¼Œå…¶åˆä¸ºä¸ï¼Œå…¶ä½™ä¾äº”åˆæ¨ã€‚', effect:'å¤šä½œè¾…åŠ©å¢ç¦ã€ç¼“å†²å°å„ä¹‹è±¡ï¼Œäººé™…ä¸è´¢åŠ¿æ›´æ˜“å¹³ç¨³ã€‚'},
  {id:'adult_015', name:'å¾·ç§€è´µäºº', group:'å¸¸ç”¨', luck:'å‰', method:'ä»¥å‡ºç”Ÿæœˆä»¤ä¸ºä¸»åˆ†å¾·ä¸ç§€ï¼šå¯…åˆæˆŒæœˆä¸™ä¸ä¸ºå¾·ã€æˆŠç™¸ä¸ºç§€ï¼›ç”³å­è¾°æœˆå£¬ç™¸æˆŠå·±ä¸ºå¾·ã€ä¸™è¾›ç”²å·±ä¸ºç§€ï¼›å·³é…‰ä¸‘æœˆåºšè¾›ä¸ºå¾·ã€ä¹™åºšä¸ºç§€ï¼›äº¥å¯æœªæœˆç”²ä¹™ä¸ºå¾·ã€ä¸å£¬ä¸ºç§€ã€‚å››æŸ±å¤©å¹²è§ä¹‹å³æ˜¯ã€‚', effect:'ä¸»æ‰å¾·å…¼å¤‡ã€æ°”è´¨æ¸…é›…ã€‚ä¸å­¦å ‚ã€æ–‡æ˜Œç­‰åŒç°ä¸”å°‘å†²å…‹ï¼Œå­¦ä¸šä¸æ–‡èŒåæœ›æ›´æ˜“å‡¸æ˜¾ã€‚'},
  {id:'adult_016', name:'å¤©å¨è´µäºº', group:'å¸¸ç”¨', luck:'å‰', method:'ä»¥æ—¥å¹²å¯¹åº”æ—¶è¾°ï¼šç”²æ—¥å·³æ—¶ã€ä¹™æ—¥åˆæ—¶ã€ä¸™æ—¥å·³æ—¶ã€ä¸æ—¥åˆæ—¶ã€æˆŠæ—¥ç”³æ—¶ã€å·±æ—¥é…‰æ—¶ã€åºšæ—¥äº¥æ—¶ã€è¾›æ—¥å­æ—¶ã€å£¬æ—¥å¯…æ—¶ã€ç™¸æ—¥å¯æ—¶ã€‚ç”Ÿäºå¯¹åº”æ—¶è¾°å³ä¸ºå‘½å¸¦ã€‚', effect:'ä¸»é£Ÿç¦„ä¸äº«å—ä¹‹ç¦ï¼Œè±¡å¾è¡£é£Ÿä¸ç¼ºã€‚äº¦å¯å¼•ç”³ä¸ºé¤é¥®ã€å…»ç”Ÿç›¸å…³æœºç¼˜ã€‚'},
  {id:'adult_017', name:'ç¦„ç¥', group:'å¸¸ç”¨', luck:'å‰', method:'ç”²ç¦„åœ¨å¯…ï¼Œä¹™ç¦„åœ¨å¯ï¼Œä¸™æˆŠç¦„åœ¨å·³ï¼Œä¸å·±ç¦„åœ¨åˆï¼Œåºšç¦„åœ¨ç”³ï¼Œè¾›ç¦„åœ¨é…‰ï¼Œå£¬ç¦„åœ¨äº¥ï¼Œç™¸ç¦„åœ¨å­ã€‚', effect:'ä¸»è´¢å¯Œä¸åœ°ä½ä¹‹åŸºï¼Œæ”¶å…¥ä¸æ™‹å‡è·¯å¾„è¾ƒæ¸…æ™°ã€‚'},
  {id:'adult_018', name:'å°†æ˜Ÿ', group:'å¸¸ç”¨', luck:'å‰', method:'å¯…åˆæˆŒè§åˆï¼Œå·³é…‰ä¸‘è§é…‰ï¼Œç”³å­è¾°è§å­ï¼Œäº¥å¯æœªè§å¯ã€‚', effect:'ä¸»é¢†å¯¼ä¸ç»Ÿå¾¡æ°”åŠ¿ï¼Œç›®æ ‡æ„Ÿå¼ºï¼Œé€‚åˆç®¡ç†ä¸æ”»åšã€‚'},
  {id:'adult_019', name:'é‡‘èˆ†è´µäºº', group:'å¸¸ç”¨', luck:'å‰', method:'ç”²æ—¥è§è¾°ï¼Œä¹™æ—¥è§å·³ï¼Œä¸™æ—¥è§æœªï¼Œä¸æ—¥è§ç”³ï¼ŒæˆŠæ—¥è§æœªï¼Œå·±æ—¥è§ç”³ï¼Œåºšæ—¥è§æˆŒï¼Œè¾›æ—¥è§äº¥ï¼Œå£¬æ—¥è§ä¸‘ï¼Œç™¸æ—¥è§å¯…ã€‚', effect:'ä¸»è´¢å¯Œä¸èº«ä»½æ°”åœºï¼Œç”Ÿæ´»å“è´¨ä¸é…å¶èµ„æºè±¡è¾ƒä½³ã€‚'},
  {id:'adult_020', name:'é©¿é©¬', group:'å¸¸ç”¨', luck:'ä¸­æ€§', method:'ä»¥å¹´æ”¯æˆ–æ—¥æ”¯ä¸ºä¸»ï¼Œç”³å­è¾°é©¬åœ¨å¯…ã€å¯…åˆæˆŒé©¬åœ¨ç”³ã€å·³é…‰ä¸‘é©¬åœ¨äº¥ã€äº¥å¯æœªé©¬åœ¨å·³ã€‚', effect:'ä¸»å¥”æ³¢ã€å¼‚åœ°ã€å˜åŠ¨ä¹‹è±¡ã€‚å¾—å‰åˆ™åŠ¨ä¸­å¾—åˆ©ï¼Œé‡å‡¶åˆ™åŠ³è€Œå°‘æˆã€‚'},
  {id:'adult_021', name:'çº¢é¸¾', group:'å¸¸ç”¨', luck:'å‰', method:'å¹´æ”¯å¯¹åº”ï¼Œå­è§å¯ã€ä¸‘è§å¯…ã€å¯…è§ä¸‘ã€å¯è§å­ã€è¾°è§äº¥ã€å·³è§æˆŒã€åˆè§é…‰ã€æœªè§ç”³ã€ç”³è§æœªã€é…‰è§åˆã€æˆŒè§å·³ã€äº¥è§è¾°ã€‚', effect:'ä¸»æ­£ç¼˜ä¸å–œåº†ï¼Œäº¦åˆ©äººé™…åˆä½œä¸å©šåº†ç±»è´¢è±¡ã€‚'},
  {id:'adult_022', name:'å¤©å–œ', group:'å¸¸ç”¨', luck:'å‰', method:'å¹´æ”¯å¯¹åº”ï¼Œå­è§é…‰ã€ä¸‘è§ç”³ã€å¯…è§æœªã€å¯è§åˆã€è¾°è§å·³ã€å·³è§è¾°ã€åˆè§å¯ã€æœªè§å¯…ã€ç”³è§ä¸‘ã€é…‰è§å­ã€æˆŒè§äº¥ã€äº¥è§æˆŒã€‚', effect:'ä¸»å®¶åº­å–œåº†ã€å©šè‚²ä¸è€ƒè¯•å–œè®¯ä¹‹è±¡ã€‚'},
  {id:'adult_023', name:'å…­åˆ', group:'å¸¸ç”¨', luck:'å‰', method:'åœ°æ”¯å…­åˆï¼šå­ä¸‘ã€å¯…äº¥ã€å¯æˆŒã€è¾°é…‰ã€å·³ç”³ã€åˆæœªã€‚', effect:'ä¸»å’Œåˆã€åˆä½œä¸äººé™…æ¶¦æ»‘ï¼Œå©šæ‹ä¸å›¢é˜Ÿåä½œæ›´é¡ºã€‚'},
  {id:'adult_024', name:'å–œç¥', group:'å¸¸ç”¨', luck:'å‰', method:'æ—¥å¹²å¯¹åº”ï¼Œç”²è§åˆã€ä¹™è§å·³ã€ä¸™è§å¯…ã€ä¸è§å¯ã€æˆŠè§ç”³ã€å·±è§é…‰ã€åºšè§äº¥ã€è¾›è§å­ã€å£¬è§æˆŒã€ç™¸è§ä¸‘ã€‚', effect:'ä¸»å–œåº†ä¸äººç¼˜ï¼Œè€ƒè¯•ã€å‡è¿ã€å©šæ‹ç­‰åœºæ™¯æ›´æ˜“è§å¥½æ¶ˆæ¯ã€‚'},
  {id:'adult_025', name:'ç¦å¾·è´µäºº', group:'å¸¸ç”¨', luck:'å‰', method:'æ—¥å¹²å¯¹åº”ï¼Œç”²è§å¯…ã€ä¹™è§å¯ã€ä¸™è§å·³ã€ä¸è§åˆã€æˆŠè§ç”³ã€å·±è§é…‰ã€åºšè§äº¥ã€è¾›è§å­ã€å£¬è§å¯…ã€ç™¸è§å¯ã€‚', effect:'ä¸»ç¦æ°”ã€å¥åº·ä¸æ™šæ™¯å®‰ç¨³ä¹‹è±¡ã€‚'},
  {id:'adult_026', name:'å­¤é¸¾ç…', group:'å¸¸ç”¨', luck:'ä¸­æ€§', method:'æ—¥æŸ±ä¸ºä¹™å·³ã€ä¸å·³ã€è¾›äº¥ã€æˆŠç”³ã€å£¬å¯…ã€æˆŠåˆã€å£¬å­ã€ä¸™åˆã€‚', effect:'ä¸»æƒ…æ„Ÿèµ·ä¼ä¸å©šæ‹æ³¢æŠ˜è±¡ï¼Œäº¦æœ‰ç‹¬ç«‹ç ”ç©¶ã€å•å…µä½œä¸šçš„æ½œåŠ›ã€‚'},
  {id:'adult_027', name:'åç›–', group:'å¸¸ç”¨', luck:'ä¸­æ€§', method:'ä»¥å¹´æ”¯æˆ–æ—¥æ”¯ä¸ºä¸»ï¼Œå¯…åˆæˆŒè§æˆŒã€äº¥å¯æœªè§æœªã€ç”³å­è¾°è§è¾°ã€å·³é…‰ä¸‘è§ä¸‘ã€‚', effect:'ä¸»æ¸…é«˜ç‹¬ç«‹ã€è‰ºæœ¯ä¸ç„å­¦æ°”è´¨ã€‚å¯¹å©šæ‹ç¤¾äº¤æœ‰ç–ç¦»è±¡ï¼Œä½†åˆ©æ·±åº¦ç ”ç©¶ä¸åˆ›ä½œã€‚'},
  {id:'adult_028', name:'å’¸æ± ', group:'å¸¸ç”¨', luck:'ä¸­æ€§', method:'ä»¥å¹´æ”¯æˆ–æ—¥æ”¯ä¸ºä¸»ï¼Œç”³å­è¾°è§é…‰ã€å¯…åˆæˆŒè§å¯ã€å·³é…‰ä¸‘è§åˆã€äº¥å¯æœªè§å­ã€‚', effect:'ä¸»æ¡ƒèŠ±ä¸æƒ…æ¬²å¸å¼•åŠ›ã€‚å¾—å‰åˆ™äººç¼˜åæ°”ï¼Œé‡å‡¶åˆ™æƒ…æ„Ÿçº ç¼ æ›´é‡ã€‚'},
  {id:'adult_029', name:'çº¢è‰³ç…', group:'å¸¸ç”¨', luck:'ä¸­æ€§', method:'ä»¥æ—¥å¹²ä¸ºä¸»ï¼Œç”²è§åˆã€ä¹™è§ç”³ã€ä¸™è§å¯…ã€ä¸è§æœªã€æˆŠè§è¾°ã€å·±è§è¾°ã€åºšè§æˆŒã€è¾›è§é…‰ã€å£¬è§å­ã€ç™¸è§ç”³ã€‚', effect:'ä¸»æ°”è´¨å‡ºä¼—ä¸æƒ…ç¼˜æµ“çƒˆï¼Œäº¦éœ€é˜²æƒ…æ„Ÿå¤šçº¿ç‰µæ‰¯ä¹‹è±¡ã€‚'},
  {id:'adult_030', name:'é­ç½¡', group:'å¸¸ç”¨', luck:'ä¸­æ€§', method:'æ—¥æŸ±ä¸ºå£¬è¾°ã€åºšæˆŒã€åºšè¾°ã€æˆŠæˆŒã€‚', effect:'ä¸»åˆšçƒˆæœæ–­ã€æŒæƒæ°”åŠ¿ã€‚èº«æ—ºæ˜“æ˜¾è´µï¼Œèº«å¼±åˆ™æ˜“é‡æ³¢æŠ˜ã€‚å©šæ‹å¤šè§ç¡¬ç¢°ç¡¬ã€‚'},
  {id:'adult_031', name:'ç¾Šåˆƒ', group:'å¸¸ç”¨', luck:'ä¸­æ€§', method:'ä»¥æ—¥å¹²ä¸ºä¸»ï¼Œç”²è§å¯ã€ä¹™è§å¯…ã€ä¸™æˆŠè§åˆã€ä¸å·±è§å·³ã€åºšè§é…‰ã€è¾›è§ç”³ã€å£¬è§å­ã€ç™¸è§äº¥ã€‚', effect:'å‡¶å¤šå‰å°‘ä¹‹è±¡ã€‚èº«å¼ºæ˜“äº‰æƒå†²åŠ¨ï¼Œèº«å¼±å¯ä½œæ‰¶èº«æŠ—ç¾ã€‚'},
  {id:'adult_032', name:'åæ¶å¤§è´¥', group:'å¸¸ç”¨', luck:'å‡¶', method:'æ—¥æŸ±ä¸ºç”²è¾°ã€ä¹™å·³ã€ä¸™ç”³ã€ä¸äº¥ã€æˆŠæˆŒã€å·±ä¸‘ã€åºšè¾°ã€è¾›å·³ã€å£¬ç”³ã€ç™¸äº¥ä¹‹ä¸€ã€‚', effect:'å¤ç§°æ— ç¦„æ—¥ï¼Œä¸»è´¢åŠ¿åŸºç¡€è–„å¼±ã€äº‹ä¸šå¤šé˜»ï¼Œå®œæ…ç†è´¢ä¸æ…åˆä¼™ã€‚'},
  {id:'adult_033', name:'é˜´é˜³å·®é”™', group:'å¸¸ç”¨', luck:'å‡¶', method:'æ—¥æŸ±ä¸ºä¸™å­ã€ä¸ä¸‘ã€æˆŠå¯…ã€è¾›å¯ã€å£¬è¾°ã€ç™¸å·³ã€ä¸™åˆã€ä¸æœªã€æˆŠç”³ã€è¾›é…‰ã€å£¬æˆŒã€ç™¸äº¥ä¹‹ä¸€ã€‚', effect:'ä¸»å©šå§»ä¸å®¶æ—æ²Ÿé€šä¸é¡ºä¹‹è±¡ï¼Œäº¦æ˜“åœ¨äººé™…åä½œä¸Šç”Ÿéš”é˜‚ã€‚'},
  {id:'adult_034', name:'å¯¡å®¿', group:'å¸¸ç”¨', luck:'å‡¶', method:'ä»¥å¹´æ”¯ä¸ºä¸»ï¼Œäº¥å­ä¸‘è§æˆŒã€å¯…å¯è¾°è§ä¸‘ã€å·³åˆæœªè§è¾°ã€ç”³é…‰æˆŒè§æœªã€‚', effect:'ä¸»å­¤å¯‚ä¸æƒ…æ„Ÿæ·¡è–„è±¡ï¼Œå®œåˆçœ‹å­¤è¾°ä¸å‘½å±€å–œå¿Œã€‚'},
  {id:'adult_035', name:'å­¤è¾°', group:'å¸¸ç”¨', luck:'å‡¶', method:'ä¾æ®å‡ºç”Ÿå¹´æ”¯å¯¹ç…§å››æŸ±ä¸­çš„å…¶ä»–åœ°æ”¯ã€‚äº¥å­ä¸‘å¹´ç”Ÿäººè§å¯…ï¼›å¯…å¯è¾°å¹´ç”Ÿäººè§å·³ï¼›å·³åˆæœªå¹´ç”Ÿäººè§ç”³ï¼›ç”³é…‰æˆŒå¹´ç”Ÿäººè§äº¥ã€‚', effect:'ä¸»ç‹¬ç«‹æ¸…å†·ã€ç¤¾äº¤åŠ©åŠ›å¼±ä¸å©šæ‹èŠ‚å¥æ…¢ä¹‹è±¡ã€‚ä¸å¯¡å®¿åŒç°æ—¶å­¤å¯‚æ„Ÿæ›´é‡ã€‚'},
  {id:'adult_036', name:'æˆªè·¯ç©ºäº¡', group:'å¸¸ç”¨', luck:'å‡¶', method:'ç”²ã€å·±æ—¥é‡ç”³ã€é…‰ï¼›ä¹™ã€åºšæ—¥é‡åˆã€æœªï¼›ä¸™ã€è¾›æ—¥é‡è¾°ã€å·³ï¼›ä¸ã€å£¬æ—¥é‡å¯…ã€å¯ï¼›æˆŠã€ç™¸æ—¥é‡å­ã€ä¸‘ã€‚', effect:'ä¸»è´¢æœºä¸äº‹ä¸šè·¯å¾„å—é˜»ã€è®¡åˆ’æ˜“åŠé€”æŠ˜è¿”ä¹‹è±¡ã€‚'},
  {id:'adult_037', name:'äº¡ç¥', group:'å¸¸ç”¨', luck:'å‡¶', method:'å¯…åˆæˆŒè§å·³ï¼Œäº¥å¯æœªè§å¯…ï¼Œå·³é…‰ä¸‘è§ç”³ï¼Œç”³å­è¾°è§äº¥ã€‚', effect:'ä¸»æ˜¯éæš—è€—ã€åˆ¤æ–­å¤±è¯¯ä¸è´¢åŠ¡æ³¢æŠ˜è±¡ã€‚'},
  {id:'adult_038', name:'å…­å„ç…', group:'å¸¸ç”¨', luck:'å‡¶', method:'ä»¥å¹´æ”¯ä¸ºä¸»ï¼Œå¯…åˆæˆŒè§é…‰ï¼Œäº¥å¯æœªè§åˆï¼Œç”³å­è¾°è§å¯ï¼Œå·³é…‰ä¸‘è§å­ã€‚', effect:'ä¸»ä»•é€”ä¸èŒåœºé˜»åŠ›ã€ç“¶é¢ˆæœŸè¾ƒé‡ä¹‹è±¡ã€‚'},
  {id:'adult_039', name:'ç¾ç…', group:'å¸¸ç”¨', luck:'å‡¶', method:'ä»¥å¹´æ”¯æˆ–æ—¥æ”¯ä¸ºä¸»ï¼Œç”³å­è¾°è§åˆã€äº¥å¯æœªè§é…‰ã€å¯…åˆæˆŒè§å­ã€å·³é…‰ä¸‘è§å¯ã€‚', effect:'ä¸»çªå‘å˜æ•…ä¸æ˜¯éå†²å‡»è±¡ã€‚'},
  {id:'adult_040', name:'åŠ«ç…', group:'å¸¸ç”¨', luck:'å‡¶', method:'ä»¥å¹´æ”¯æˆ–æ—¥æ”¯ä¸ºä¸»ï¼Œç”³å­è¾°è§äº¥ã€å¯…åˆæˆŒè§å·³ã€å·³é…‰ä¸‘è§å¯…ã€äº¥å¯æœªè§ç”³ã€‚', effect:'ä¸»æ„å¤–ç ´è´¢ã€é¡¹ç›®è¢«å¤ºæˆ–å®˜éç‰µè¿ä¹‹è±¡ã€‚'},
  {id:'adult_041', name:'å››åºŸ', group:'å¸¸ç”¨', luck:'å‡¶', method:'æ˜¥è§åºšç”³è¾›é…‰ï¼›å¤è§å£¬å­ç™¸äº¥ï¼›ç§‹è§ç”²å¯…ä¹™å¯ï¼›å†¬è§ä¸™åˆä¸å·³ã€‚', effect:'ä¸»ç²¾åŠ›æ¶£æ•£ã€æ‰§è¡Œå—é˜»ä¸äº‹ä¸šåŠé€”ä¹‹è±¡ã€‚'},
  {id:'adult_042', name:'å…ƒè¾°', group:'å¸¸ç”¨', luck:'å‡¶', method:'é˜³ç”·é˜´å¥³ä»¥å†²å‰ä¸€ä½ä¸ºå…ƒè¾°ï¼Œé˜´ç”·é˜³å¥³ä»¥å†²åä¸€ä½ä¸ºå…ƒè¾°ã€‚', effect:'ä¸»æ— å¦„ä¹‹ç¾ä¸æƒ…ç»ªã€äººäº‹æ³¢åŠ¨è±¡ã€‚'},
  {id:'adult_043', name:'å¤©ç½—åœ°ç½‘', group:'å¸¸ç”¨', luck:'å‡¶', method:'ä¸»æµä»¥åœ°æ”¯è®ºï¼šæˆŒäº¥ä¸ºå¤©ç½—ï¼Œè¾°å·³ä¸ºåœ°ç½‘ã€‚å¯ä»å››æŸ±è§æˆŒäº¥ã€è¾°å·³çš„ç»„åˆçœ‹ï¼›äº¦æœ‰ä»¥å¹´å¹²æ”¯çº³éŸ³é…åˆæ—¥æŸ±åˆ¤å®šçš„å£å¾„ã€‚', effect:'è±¡å¾æŸç¼šã€é˜»æ»ä¸é‡å‹ã€‚å¤šå‡¶åŒç°æˆ–è¡Œè¿å†é‡æ—¶é˜»åŠ›æ›´æ˜¾ï¼›å¾—å¤©å¾·ã€æœˆå¾·ã€å¤©ä¹™ç­‰å¯å‡å…¶è±¡ã€‚'},
  {id:'adult_044', name:'ç™½è™', group:'å¸¸ç”¨', luck:'å‡¶', method:'å¸¸ç”¨å¹´æ”¯å¯¹ç…§ï¼šå¯…åˆæˆŒè§å­ï¼Œç”³å­è¾°è§åˆï¼Œäº¥å¯æœªè§é…‰ï¼Œå·³é…‰ä¸‘è§å¯ã€‚', effect:'ä¸»è¡€å…‰æ„å¤–ä¸æ˜¯éåˆ‘ä¼¤çš„è‚ƒæ€è±¡ã€‚å¾—è´µäººä¸åˆ¶åŒ–æ—¶å¯å‡ã€‚'},
  {id:'adult_045', name:'é£åˆƒ', group:'å¸¸ç”¨', luck:'å‡¶', method:'ä»¥æ—¥å¹²å¯¹åº”åœ°æ”¯ï¼šç”²è§é…‰ï¼Œä¹™è§ç”³ï¼Œä¸™æˆŠè§å­ï¼Œä¸å·±è§äº¥ï¼Œåºšè§å¯ï¼Œè¾›è§å¯…ï¼Œå£¬è§åˆï¼Œç™¸è§å·³ã€‚', effect:'ä¸»å¿«è€Œçªçš„å†²å‡»ä¸å¤–ä¼¤è±¡ã€‚åˆ¶åŒ–å¾—åŠ›æ—¶äº¦å¯åŒ–ä½œèƒ†è¯†ä¸è¡ŒåŠ¨åŠ›ã€‚'},
  {id:'adult_046', name:'è¡€åˆƒ', group:'å¸¸ç”¨', luck:'å‡¶', method:'ä»¥æ—¥å¹²å¯¹åº”åœ°æ”¯ï¼šç”²è§å¯ï¼Œä¹™è§è¾°ï¼Œä¸™è§åˆï¼Œä¸è§æœªï¼ŒæˆŠè§åˆï¼Œå·±è§æœªï¼Œåºšè§é…‰ï¼Œè¾›è§æˆŒï¼Œå£¬è§å­ï¼Œç™¸è§ä¸‘ã€‚', effect:'ä¸»è¡€å…‰ã€å¤–ç§‘ã€ä¼¤ç—…ç­‰æ„è±¡ã€‚ä¸ç¾Šåˆƒã€é£åˆƒåŒç°æ—¶æ›´æ˜¾ã€‚'},
    {id:'child_001', name:'ç™¾æ—¥å…³', group:'å°å„¿å…³ç…', luck:'å‡¶', method:'å¯…ç”³å·³äº¥æœˆç”Ÿäºè¾°æˆŒä¸‘æœªæ—¶ï¼›å­åˆå¯é…‰æœˆç”Ÿäºå¯…ç”³å·³äº¥æ—¶ï¼›è¾°æˆŒä¸‘æœªæœˆç”Ÿäºå­åˆå¯é…‰æ—¶ï¼Œå³ä¸ºçŠ¯æ­¤å…³ã€‚', effect:'å¤æ³•å¤šè®¤ä¸ºä¸»å°å„¿ç™¾æ—¥å†…æ°”å¼±éš¾å…»ï¼Œæ˜“è§æƒŠé£ã€ä½“å¼±ç­‰è±¡ã€‚æ°‘ä¿—å¸¸å¿Œç™¾æ—¥å†…è¿œè¡Œæˆ–é¢‘ç¹å¤–å‡ºï¼Œä»¥é¿å¤–ç•Œä¸åˆ©æ°”åœºã€‚'},
    {id:'child_002', name:'é˜ç‹å…³', group:'å°å„¿å…³ç…', luck:'å‡¶', method:'æ˜¥å­£ç”Ÿäºä¸‘æœªæ—¶ï¼›å¤å­£ç”Ÿäºè¾°æˆŒæ—¶ï¼›ç§‹å­£ç”Ÿäºå­åˆæ—¶ï¼›å†¬å­£ç”Ÿäºé…‰å¯æ—¶ï¼Œå³ä¸ºçŠ¯é˜ç‹å…³ã€‚', effect:'ä¼ ç»Ÿè§†ä¸ºå°å„¿è¾ƒé‡çš„å…³ç…ä¹‹ä¸€ï¼Œä¸»å¹¼å¹´ä½“å¼±å¤šå„ã€å…»æŠ¤å‹åŠ›å¤§ä¹‹è±¡ã€‚æ°‘ä¿—å¤šå¿Œå¹¼å¹´å…¥æ³•äº‹ã€ä¸§è‘¬ç­‰åœºåŸŸï¼›è‹¥å‘½å±€æœ‰å¤©å¾·ã€æœˆå¾·ç­‰å‰ç¥ï¼Œå¯ä½œç¼“è§£ä¹‹è±¡ã€‚'},
    {id:'child_003', name:'å°†å†›ç®­', group:'å°å„¿å…³ç…', luck:'å‡¶', method:'æ˜¥å­£é…‰æˆŒè¾°æ—¶ç”Ÿï¼›å¤å­£æœªå¯å­æ—¶ç”Ÿï¼›ç§‹å­£å¯…åˆä¸‘æ—¶ç”Ÿï¼›å†¬å­£äº¥ç”³å·³æ—¶ç”Ÿï¼Œå³ä¸ºçŠ¯æ­¤å…³ã€‚æ°‘é—´å¦æœ‰æŒ‰æ—¶è¾°åˆ†â€œç®­æ•°â€è½»é‡çš„å£å¾„ã€‚', effect:'å¤æ³•å¤šè¨€ä¼¤äº²æŸå·±ã€å¹¼å¹´æ˜“æœ‰ç£•ç¢°æƒŠé™©ä¹‹è±¡ã€‚æ°‘ä¿—å¿Œå¹¼å¹´å…¥å°†å†›åº™æˆ–æ¥è§¦ä»¿åˆ¶å…µå™¨ç±»ç©å…·ï¼Œå¹¶æœ‰ä»¥æ›¿èº«ã€çƒ§è§£å„é’±ç­‰æ–¹å¼æ±‚å®‰çš„åšæ³•ã€‚'},
    {id:'child_004', name:'é“è›‡å…³', group:'å°å„¿å…³ç…', luck:'å‡¶', method:'å¹´æŸ±çº³éŸ³å±é‡‘ç”ŸäºæˆŒæ—¶ï¼›å±ç«ç”Ÿäºæœªæ—¶ï¼›å±æœ¨ç”Ÿäºè¾°æ—¶ï¼›å±æ°´æˆ–åœŸç”Ÿäºä¸‘æ—¶ï¼Œå³ä¸ºçŠ¯å…³ã€‚è‹¥åœ°æ”¯å†è§å¯¹åº”æ—¶è¾°åœ°æ”¯ï¼Œæ°‘ä¿—å¤šè¨€å‡¶è±¡åŠ é‡ã€‚', effect:'ä¼ ç»Ÿè§†ä¸ºåé‡çš„å…³ç…ï¼Œä¸»å¹¼å¹´éš¾å…»ã€ç–¹ç–¾ä¸æ„å¤–é£é™©è±¡ã€‚æ°‘ä¿—ç‰¹åˆ«å¼ºè°ƒä¸‰å²å‰è°¨æ…çœ‹æŠ¤ã€è¿œç¦»è½¦é“ä¸é”åˆ©é‡‘å±ã€åŠ¨ç‰©ç­‰é£é™©æºã€‚'},
    {id:'child_005', name:'æ±¤ç«ç…ï¼ˆçƒ«ç«å…³ï¼‰', group:'å°å„¿å…³ç…', luck:'å‡¶', method:'ä»¥å¹´æ”¯æˆ–æ—¥æ”¯å¯¹ç…§æ—¶è¾°ï¼šå­åˆå¯é…‰å¹´ç”Ÿäºåˆæ—¶ï¼›å¯…ç”³å·³äº¥å¹´ç”Ÿäºå¯…æ—¶ï¼›è¾°æˆŒä¸‘æœªå¹´ç”Ÿäºæœªæ—¶ï¼Œå³ä¸ºçŠ¯æ­¤å…³ã€‚', effect:'ä¸»å¹¼å¹´æ˜“æœ‰æ±¤ç«çƒ«ç¼ä¹‹è±¡ã€‚æ°‘ä¿—å¤šå¿Œå¹¼å¹´è¿‘ç¶ç«çƒ­æ±¤ï¼Œäº¦æœ‰ç¥­ç«ç¥ã€çƒ§è§£å„é’±ç­‰æ±‚å®‰åšæ³•ã€‚'},
    {id:'child_006', name:'é¬¼é—¨å…³', group:'å°å„¿å…³ç…', luck:'å‡¶', method:'å­ä¸‘å¯…ç”Ÿäººé€¢é…‰åˆæœªæ—¶ï¼›å¯è¾°å·³ç”Ÿäººé€¢ç”³æˆŒäº¥æ—¶ï¼›åˆæœªç”³ç”Ÿäººé€¢ä¸‘å¯…å¯æ—¶ï¼›é…‰æˆŒäº¥ç”Ÿäººé€¢å­è¾°å·³æ—¶ï¼Œå³ä¸ºçŠ¯æ­¤å…³ã€‚', effect:'ä¼ ç»Ÿå¤šè¨€å¹¼å¹´æ˜“æŸ“ç—…ç¾ã€å—æƒŠå„ä¹‹è±¡ã€‚æ°‘ä¿—å¿Œå¹¼å¹´å…¥é˜´åº™ã€åŸå¢“ç­‰åœºåŸŸï¼Œäº¦å¿Œå¤œæ™šéšæ„å‡ºå…¥æˆ–è¿‘å‡¶å­ä¹‹å®¶ï¼Œå¹¶æœ‰çƒ§åœ°åºœé’±ç­‰æ±‚å®‰æ–¹å¼ã€‚'},
    {id:'child_007', name:'æ·±æ°´å…³', group:'å°å„¿å…³ç…', luck:'å‡¶', method:'æ˜¥å­£ç”Ÿäºå¯…æ—¶ï¼›å¤å­£ç”Ÿäºæœªæ—¶ï¼›ç§‹å­£ç”Ÿäºé…‰æ—¶ï¼›å†¬å­£ç”Ÿäºä¸‘æ—¶ï¼Œå³ä¸ºçŠ¯æ­¤å…³ã€‚', effect:'ä¸»å¹¼å¹´é˜²æ°´å„ä¸æ¹¿å†·ç—…è±¡çš„ä¼ ç»Ÿæ„è±¡ã€‚æ°‘ä¿—å¤šå¼ºè°ƒè¿œç¦»æ·±æ°´ã€äº•å¡˜æ²³æ¹–ç­‰å±é™©å¤„ï¼Œå¹¶æœ‰èŠ‚ä»¤ç¥­ç¥–é¿å¿Œç­‰åœ°æ–¹æ€§è¯´æ³•ã€‚'},
    {id:'child_008', name:'æµ´ç›†å…³', group:'å°å„¿å…³ç…', luck:'å‡¶', method:'æ˜¥å­£å¿Œè¾°æ—¶ï¼›å¤å­£å¿Œæœªæ—¶ï¼›ç§‹å­£å¿ŒæˆŒæ—¶ï¼›å†¬å­£å¿Œä¸‘æ—¶å‡ºç”Ÿï¼Œæ°‘ä¿—ç§°ä¸ºçŠ¯æµ´ç›†å…³ã€‚', effect:'ä¼ ç»Ÿå¤šè¨€åˆç”Ÿæ²æµ´éœ€è°¨æ…ä¹‹è±¡ã€‚æ°‘ä¿—æ—§è¯´å¯¹åˆç”Ÿæ´—æµ´å™¨å…·ä¸æ—¶æ®µæœ‰é¿å¿Œï¼Œè¿‡ä¸€å‘¨å·¦å³ç¦å¿Œæ¸é€€ã€‚'},
    {id:'child_009', name:'ç™½è™å…³', group:'å°å„¿å…³ç…', luck:'å‡¶', method:'æŒ‰çº³éŸ³äº”è¡Œï¼šç«å‘½äººç”Ÿäºå­æ—¶ï¼›é‡‘å‘½äººç”Ÿäºå¯æ—¶ï¼›æ°´åœŸå‘½äººç”Ÿäºåˆæ—¶ï¼›æœ¨å‘½äººç”Ÿäºé…‰æ—¶ï¼Œå³ä¸ºçŠ¯ç™½è™å…³ã€‚', effect:'ä¼ ç»Ÿå¤šè¨€å¹¼å¹´è…¹éƒ¨ã€è¡€æ°”ã€æƒŠé£ä¸ç–¹ç–¾ä¹‹è±¡ï¼Œäº¦ä¸»ç£•ç¢°è¡€å…‰æ„è±¡ã€‚æ°‘ä¿—æœ‰çƒ§ç™½è™é’±ç­‰åˆ¶åŒ–è¯´æ³•ã€‚'},
    {id:'child_010', name:'é¸¡é£å…³', group:'å°å„¿å…³ç…', luck:'å‡¶', method:'æ°‘é—´å¤šä»¥å¹´å¹²æˆ–æ—¥å¹²å¯¹ç…§æ—¶è¾°ã€å†åˆåœ°æ”¯ç»„åˆåˆ¤å®šï¼Œå£å¾„è¾ƒå¤šï¼›å¸¸è§è¯´æ³•æ˜¯è§ç‰¹å®šç¦½ç•œç›¸å…³çš„æ—¶æ”¯ç»„åˆå³ä¸ºçŠ¯å…³ã€‚', effect:'ä¼ ç»Ÿå¤šè¨€å¹¼å¹´éš¾å…»ã€æ˜“å—æƒŠå“ä¹‹è±¡ï¼Œå¿Œè§æ€ç”Ÿåœºé¢ï¼Œäº¦éœ€é˜²ç¦½ç•œå•„å’¬ç­‰æ„å¤–ã€‚æ°‘ä¿—æœ‰çƒ§ç‰›é©¬å°†å†›é’±ç­‰ç¥ˆå®‰æ–¹å¼ã€‚'},
    {id:'child_011', name:'çŸ­å‘½å…³', group:'å°å„¿å…³ç…', luck:'å‡¶', method:'æŸ¥æ³•ï¼šä»¥å‡ºç”Ÿå¹´æœˆåœ°æ”¯å¯¹ç…§æ—¶è¾°æ¥åˆ¤å®šï¼Œå£è¯€ä¸ºâ€œå¯…åˆæˆŒé¾™å½“ï¼Œå·³é…‰ä¸‘è™äº¡ï¼Œç”³å­è¾°è›‡ä¸Šï¼Œäº¥å¯æœªå¯»ç¾Šâ€ã€‚ä¹Ÿå°±æ˜¯å¯…åˆæˆŒå¹´æœˆç”Ÿäºè¾°æ—¶ã€å·³é…‰ä¸‘å¹´æœˆç”Ÿäºå¯…æ—¶ã€ç”³å­è¾°å¹´æœˆç”Ÿäºå·³æ—¶ã€äº¥å¯æœªå¹´æœˆç”Ÿäºæœªæ—¶ï¼Œå³ä¸ºçŠ¯æ­¤å…³ã€‚', effect:'å¤æ—¶ä¼ ç»Ÿæ–‡åŒ–è®¤ä¸ºï¼Œæ­¤å…³ä¸»å°å„¿æ˜“æƒŠæ€–ã€çˆ±å¤œå•¼ï¼Œå±äºéš¾å…»çš„ä¸€ç§å…³ç…ã€‚è‹¥å°å„¿æ—¥å¹²å¼ºå¥ï¼Œè¯¥å…³ç…çš„å‡¶æ€§ä¼šå‡å¼±ï¼ŒåŸºæœ¬æ— å¤§ç¢ï¼›è‹¥æ—¥ä¸»å­±å¼±ï¼Œåˆ™å‡¶æ€§åŠ é‡ï¼Œç”šè‡³æœ‰å¹¼å¹´å¤­æŠ˜çš„é£é™©ï¼Œæ°‘é—´å¸¸é€šè¿‡è®©å°å„¿æ‹œå®«è§‚é“é•¿ä¸ºå¸ˆçˆ¶ï¼Œæˆ–è¯·é“é•¿åšæ³•äº‹è—é­‚ç­‰æ–¹å¼ç¦³è§£ã€‚'},
    {id:'child_012', name:'å››æŸ±å…³', group:'å°å„¿å…³ç…', luck:'å‡¶', method:'æŸ¥æ³•ï¼šå£è¯€ä¸ºâ€œæ­£ä¸ƒä¼‘ç”Ÿå·³äº¥æ—¶ï¼ŒäºŒå…«è¾°æˆŒä¸å ªæ¨ï¼Œä¸‰ä¹å¯é…‰ç”Ÿäººæ¶ï¼Œå››åå¯…ç”³ä¸»å“­æ‚²ï¼Œäº”åä¸€æœˆä¸‘æœªæ­»ï¼Œå…­åäºŒå­åˆéå®œâ€ã€‚ä»¥å‡ºç”Ÿæœˆä»½å¯¹ç…§æ—¶è¾°åˆ¤å®šï¼Œæ­£æœˆã€ä¸ƒæœˆç”Ÿäºå·³æ—¶ã€äº¥æ—¶ï¼ŒäºŒæœˆã€å…«æœˆç”Ÿäºè¾°æ—¶ã€æˆŒæ—¶ç­‰ï¼Œå³ä¸ºçŠ¯æ­¤å…³ç…ã€‚', effect:'ä¼ ç»Ÿè¯´æ³•ä¸­å®ƒæ˜¯å°å„¿å¸¸è§å‡¶ç…ï¼Œä¸è®ºç”·å¥³çš†å¿Œã€‚å•çŠ¯æ­¤å…³ä¸ç®—å¤§å‡¶ï¼Œä½†è‹¥å’Œæµéœç…ã€èƒèƒç…ç­‰å…¶ä»–å‡¶ç…å åŠ ï¼Œç¾ç¥¸ä¼šæ›´æ˜æ˜¾ï¼Œå¤šä¸»å°å„¿ä¸€ç”Ÿæ˜“é­ç–¾ç—…ç¼ èº«ï¼Œæˆé•¿è¿‡ç¨‹ä¸­ä¹Ÿå¸¸é‡å„ç±»ä¸é¡ºï¼Œæ°‘é—´å¤šä¼šé€šè¿‡ç¥ˆç¦ã€ä½©æˆ´æŠ¤èº«ç¬¦ç­‰æ–¹å¼æ¥ç¥ˆç¦æ¶ˆç¾ã€‚'},
    {id:'child_013', name:'é›·å…¬æ‰“è„‘å…³', group:'å°å„¿å…³ç…', luck:'å‡¶', method:'æŸ¥æ³•ï¼šä»¥å‡ºç”Ÿæ—¥å¹²åŒ¹é…å‡ºç”Ÿæ—¶è¾°åˆ¤å®šï¼Œç”²æ—¥é€¢ä¸‘æ—¶ã€ä¹™æ—¥é€¢åˆæ—¶ã€ä¸™ä¸æ—¥é€¢å­æ—¶ã€æˆŠå·±æ—¥é€¢æˆŒæ—¶ã€åºšè¾›æ—¥é€¢å¯…æ—¶ã€å£¬æ—¥é€¢é…‰æ—¶ã€ç™¸æ—¥é€¢äº¥æ—¶ï¼Œå³ä¸ºçŠ¯æ­¤å…³ã€‚', effect:'æ°‘é—´è¯´æ³•ä¸­ï¼ŒçŠ¯æ­¤å…³è€…æ˜“é­é›·ç«ã€ç”µè§¦ã€çƒ§ä¼¤ç­‰ç¾ç¥¸ï¼Œå­©ç«¥æ—¶æœŸè¿˜æ€•å—é”£é¼“ã€é›·å£°ç­‰å¤§å£°å“æƒŠå“ï¼Œè‹¥è¿åŠ¿ä¸­é‡åˆ°å¤©å„ã€é˜³åˆƒç­‰å‡¶æ˜Ÿï¼Œç¾ç¥¸ä¼šæ›´æ˜æ˜¾ï¼Œä½†è‹¥é‡å¤©æœˆäºŒå¾·å‰æ˜Ÿåˆ™å¯åŒ–è§£ã€‚'},
    {id:'child_014', name:'é‡‘é”å…³', group:'å°å„¿å…³ç…', luck:'å‡¶', method:'æŸ¥æ³•ï¼šä»¥å†œå†å‡ºç”Ÿæœˆä»½åŒ¹é…æ—¶è¾°åˆ¤å®šï¼Œæ­£ã€ä¸ƒæœˆç”Ÿäºç”³æ—¶ã€äºŒã€å…«æœˆç”Ÿäºé…‰æ—¶ï¼ˆé¸¡ï¼‰ã€ä¸‰ã€ä¹æœˆç”ŸäºæˆŒæ—¶ï¼ˆç‹—ï¼‰ã€å››ã€åæœˆç”Ÿäºäº¥æ—¶ï¼ˆçŒªï¼‰ã€äº”ã€åä¸€æœˆç”Ÿäºå­æ—¶ã€å…­ã€åäºŒæœˆç”Ÿäºä¸‘æ—¶ï¼Œå³ä¸ºçŠ¯æ­¤å…³ã€‚', effect:'æ°‘é—´è¯´æ³•ï¼šçŠ¯æ­¤å…³çš„å­©ç«¥å¿Œä½©æˆ´é‡‘é“¶é”ç‰‡ã€é’±ç´¢ç­‰ç‰©ï¼Œä¹Ÿä¸å®œæ‹œç¥å¥‘ï¼Œå¦åˆ™æ˜“å‡ºç°å“­é—¹ä¸å®‰ã€èº«ä½“ä¸é€‚ç­‰æƒ…å†µï¼Œæ°‘é—´è¿˜æµä¼ å¯èƒ½å¼•å‘è¯¯åå¼‚ç‰©ã€ç–¾ç—…ç”šè‡³å¤­äº¡ç­‰è¯´æ³•ã€‚'},
    {id:'child_015', name:'æ— æƒ…å…³', group:'å°å„¿å…³ç…', luck:'å‡¶', method:'æŸ¥æ³•ï¼šä»¥å‡ºç”Ÿå­£èŠ‚åŒ¹é…æ—¶è¾°åˆ¤å®šï¼Œæ­£äºŒä¸‰æœˆï¼ˆæ˜¥ï¼‰ç”Ÿäºå¯…ã€é…‰ã€å­æ—¶ï¼›å››äº”å…­ï¼ˆå¤ï¼‰ç”ŸäºæˆŒã€äº¥ã€å·³æ—¶ï¼›ä¸ƒå…«ä¹æœˆï¼ˆç§‹ï¼‰ç”Ÿäºç”³ã€ä¸‘æ—¶ï¼›ååä¸€åäºŒæœˆï¼ˆå†¬ï¼‰ç”Ÿäºå­ã€åˆæ—¶ï¼Œå³ä¸ºçŠ¯æ­¤å…³ã€‚', effect:'æ°‘é—´è¯´æ³•ï¼šçŠ¯æ­¤å…³çš„å­©ç«¥å¿Œå»å¤–å©†å®¶ã€å¿Œå¬åˆ€æ–§ä¹‹å£°ï¼Œè¿˜æ˜“å‡ºç°æƒŠé£ã€åä¹³ç­‰é—®é¢˜ã€‚æ°‘é—´å¸¸ä»¥ç”Ÿçˆ¶æ¯å¯¹å­©å­æ”¹ç”¨åç§°ï¼Œæˆ–è®©å­©å­æ‹œè®¤å¥‘çˆ¶æ¯ã€ç¥æ˜ä¸ºå¥‘çˆ¶ç­‰æ–¹å¼æ¥ç¥ˆç¦æ¶ˆç¾ã€‚'},
    {id:'child_016', name:'äº”é¬¼å…³', group:'å°å„¿å…³ç…', luck:'å‡¶', method:'æŸ¥æ³•ï¼šä»¥å‡ºç”Ÿå¹´åœ°æ”¯åŒ¹é…å¯¹åº”åœ°æ”¯åˆ¤å®šï¼Œå­å¹´é‡è¾°ã€ä¸‘å¹´é‡å·³ã€å¯…å¹´é‡åˆã€å¯å¹´é‡æœªã€è¾°å¹´é‡ç”³ã€å·³å¹´é‡é…‰ã€åˆå¹´é‡æˆŒã€æœªå¹´é‡äº¥ã€ç”³å¹´é‡å­ã€é…‰å¹´é‡ä¸‘ã€æˆŒå¹´é‡å¯…ã€äº¥å¹´é‡å¯ï¼Œå³ä¸ºçŠ¯æ­¤å…³ã€‚', effect:'æ°‘é—´è¯´æ³•ï¼šçŠ¯æ­¤å…³è¢«è§†ä½œå¸¦æ­»æ°”ï¼Œå­©ç«¥æ—¶æœŸéš¾å…»è‚²ï¼Œæ˜“æœ‰è·Œä¼¤ï¼Œè¿˜æ˜“æ²¾æŸ“ç¾ç–¾ã€‚æ°‘é—´è®¤ä¸ºè¿™ç±»å­©ç«¥è¦å¿Œé è¿‘ç—…æ‚£ã€æ®¡ä»ªé¦†ã€å¢“åœ°ç­‰åœºæ‰€ï¼Œä¹Ÿä¸å®œè¿›å…¥åºµå ‚å¯ºé™¢ï¼Œå‚åŠ æ™®æ¸¡ã€æ‰“é†®ç­‰æ³•ä¼šæ—¶åˆ«é å‰ï¼Œé¿å¼€æ£ºæœ¨ç­‰å¯å‡å°‘é£é™©ã€‚'},
    {id:'child_017', name:'å¤©ç‹—å…³', group:'å°å„¿å…³ç…', luck:'å‡¶', method:'æŸ¥æ³•ï¼šä»¥å‡ºç”Ÿå¹´åœ°æ”¯åŒ¹é…å¯¹åº”åœ°æ”¯åˆ¤å®šï¼Œå­å¹´é‡æˆŒã€ä¸‘å¹´é‡äº¥ã€å¯…å¹´é‡å­ã€å¯å¹´é‡ä¸‘ã€è¾°å¹´é‡å¯…ã€å·³å¹´é‡å¯ã€åˆå¹´é‡è¾°ã€æœªå¹´é‡å·³ã€ç”³å¹´é‡åˆã€é…‰å¹´é‡æœªã€æˆŒå¹´é‡ç”³ã€äº¥å¹´é‡é…‰ï¼Œå³ä¸ºçŠ¯æ­¤å…³ã€‚', effect:'æ°‘é—´è¯´æ³•ï¼šçŠ¯æ­¤å…³çš„å­©ç«¥æ˜“é­æ„å¤–æƒŠå“ã€è·Œæ‰“æŸä¼¤ï¼Œå°¤å…¶æ€•ç‹—ç±»æƒŠæ‰°ï¼Œè¿˜å¯èƒ½å‡ºç°å¤œå•¼ä¸å®‰ã€å¥åº·æ³¢åŠ¨ç­‰æƒ…å†µã€‚æ°‘é—´å¤šæœ‰è®©å­©ç«¥ä½©æˆ´å¹³å®‰ç¬¦ã€é¿å…å¤œé—´å¤–å‡ºã€è¿œç¦»çŠ¬ç±»ç­‰é¿ç¥¸æ–¹å¼ã€‚'},
    {id:'child_018', name:'æ–­æ¡¥å…³', group:'å°å„¿å…³ç…', luck:'å‡¶', method:'æŸ¥æ³•ï¼šæŒ‰å†œå†å‡ºç”Ÿæœˆä»½åŒ¹é…æ—¶è¾°åˆ¤å®šï¼Œæ­£æœˆå¯…æ—¶ã€äºŒæœˆå¯æ—¶ã€ä¸‰æœˆç”³æ—¶ã€å››æœˆä¸‘æ—¶ã€äº”æœˆæˆŒæ—¶ã€å…­æœˆé…‰æ—¶ã€ä¸ƒæœˆå·³æ—¶ã€å…«æœˆäº¥æ—¶ã€ä¹æœˆåˆæ—¶ã€åæœˆæœªæ—¶ã€å†¬æœˆäº¥æ—¶ã€è…Šæœˆå­æ—¶å‡ºç”Ÿï¼Œå³ä¸ºçŠ¯æ­¤å…³ã€‚', effect:'æ°‘é—´è¯´æ³•ï¼šæ­¤å…³è¢«è§†ä½œå°å„¿å…³ç…ä¸­è¾ƒå…³é”®çš„ä¸€ç§ï¼ŒçŠ¯å…³å­©ç«¥ä¸ä»…å¹¼æ—¶éš¾å…»ï¼Œä¼ è¨€å£®å¹´é‡æ­¤å…³ä¹Ÿå¯èƒ½æœ‰ç¾ç¥¸ã€‚æ°‘é—´è®¤ä¸ºè¿™ç±»å­©ç«¥å¿Œè¿‡æ¡¥ã€æ±²æ°´ä»¥åŠç…§å½±ï¼ŒåŒ–è§£æ–¹å¼å¤šä¸ºç”¨æ°´å®˜é’±ç¥­ç¥€æ°´å®˜å¤§å¸ï¼Œæˆ–è¿‡æ¡¥æ—¶æ‰”ç‚¹â€œä¹°è·¯é’±â€ä¸”ä¸åŸè·¯è¿”å›ç­‰ã€‚'},
    {id:'adult_047', name:'åœ°æ‰«æ˜Ÿ', group:'å¸¸ç”¨', luck:'å‡¶', method:'ï¼ˆå¤‡æ³¨ï¼Œæ°‘é—´åŸåç§°ä¸ºä¸‰å¤«ç…æˆ–æˆ–å…‹å¤«ç…ï¼Œæˆ‘è§‰å¾—ä¸å¥½å¬å°±æ”¹äº†ï¼‰ï¼Œå‡¶ï¼ŒæŸ¥æ³•ï¼šä»¥å¹´æŸ±çº³éŸ³çš„äº”è¡Œå‘½æ ¼åŒ¹é…å†œå†å‡ºç”Ÿæœˆä»½åˆ¤å®šï¼Œæ°´å‘½ã€åœŸå‘½ç”Ÿäºå†œå†äºŒä¸‰æœˆï¼Œç«å‘½ç”Ÿäºå†œå†äº”å…­æœˆï¼Œé‡‘å‘½ç”Ÿäºå†œå†å…«ä¹æœˆï¼Œæœ¨å‘½ç”Ÿäºå†œå†å†¬å­£ï¼Œå³ä¸ºçŠ¯æ­¤ç…ã€‚', effect:'ä¼ ç»Ÿè¯´æ³•ä¸­ï¼ŒçŠ¯æ­¤ç…çš„å¥³å‘½ä¸»å©šå§»å¤šæœ‰æ³¢æŠ˜ï¼Œæ˜“å‡ºç°æ„Ÿæƒ…ç¦»æ•£ã€é…å¶ç¼˜è–„ç­‰ä¸åˆ©äºå©šå§»ç¨³å®šçš„æƒ…å†µã€‚'},
    {id:'adult_048', name:'å…«è´¥', group:'å¸¸ç”¨', luck:'å‡¶', method:'æŸ¥æ³•ï¼šä»¥ç”Ÿè‚–ç»“åˆå‡ºç”Ÿå­£èŠ‚åˆ¤å®šï¼ŒçŒªã€ç‹—ã€ç¾Šç”Ÿè‚–ç”Ÿäºæ˜¥å­£ä¸‰æœˆï¼Œé¾™ã€è›‡ã€é¼ ç”Ÿè‚–ç”Ÿäºå¤å­£å…­æœˆï¼ŒçŒ´ã€é¸¡ã€ç‰›ç”Ÿè‚–ç”Ÿäºç§‹å­£ä¹æœˆï¼Œè™ã€é©¬ã€å…”ç”Ÿè‚–ç”Ÿäºå†¬å­£è…Šæœˆï¼Œå³ä¸ºçŠ¯æ­¤ç…ã€‚', effect:'å¤æ—¶ä¼ ç»Ÿæ–‡åŒ–è®¤ä¸ºï¼Œæ­¤ç…åˆç§°ä¸§é—¨æ˜Ÿï¼Œä¸»ä¸€ç”Ÿè¯¸äº‹ä¸é¡ºã€äº‹ä¸šéš¾æˆä¸”æ˜“ç ´è´¢ã€‚ç”·æ€§é€¢ä¹‹å¤šä¸€äº‹æ— æˆï¼Œå¥³æ€§é€¢ä¹‹åˆ™æ˜“å¯¼è‡´å¤«å®¶å®¶é“è¡°è½ï¼Œæ°‘é—´å¸¸é€šè¿‡ä½©æˆ´äº”è¡ŒæŠ¤èº«ç¬¦ã€è¯·äººåšæ³•äº‹ç­‰äº”è¡Œé€šå…³ã€é˜´é˜³ç›¸æµçš„æ–¹å¼æ¥å°è¯•åŒ–è§£ã€‚'},
    {id:'adult_049', name:'æµéœç…', group:'å¸¸ç”¨', luck:'å‡¶', method:'æŸ¥æ³•ï¼šä»¥å‡ºç”Ÿæ—¥å¹²å¯¹åº”å…«å­—åœ°æ”¯ï¼Œå£è¯€ä¸ºâ€œç”²é¸¡ä¹™çŠ¬ä¸™ç¾ŠåŠ ï¼Œä¸æ˜¯çŒ´ä¹¡æˆŠè§è›‡ï¼›å·±é©¬åºšé¾™è¾›é€å…”ï¼Œå£¬çŒªç™¸è™æ˜¯æµéœâ€ï¼Œå³ç”²æ—¥è§é…‰ã€ä¹™æ—¥è§æˆŒã€ä¸™æ—¥è§æœªç­‰ï¼Œåœ°æ”¯å‡ºç°å¯¹åº”å­—å³ä¸ºçŠ¯æ­¤ç…ã€‚', effect:'å¤æ—¶ä¼ ç»Ÿæ–‡åŒ–è®¤ä¸ºï¼Œè¿™æ˜¯çº¯å‡¶ç¥ç…ï¼Œå¤ç§°â€œè¡€ç…â€ï¼Œä¸»è¡€å…‰ä¹‹ç¾ä¸å¥åº·éšæ‚£ã€‚ç”·æ€§å¸¦æ­¤ç…æ˜“å› æ²‰è¿·é…’è‰²æƒ¹ç¥¸ä¼¤èº«ï¼Œå¥³æ€§æ˜“é­é‡äº§å„ã€è¡€å´©ç­‰é—®é¢˜ï¼Œè½»åˆ™ç£•ç¢°å—ä¼¤ï¼Œé‡åˆ™å¯èƒ½é¢ä¸´å±åŠç”Ÿå‘½çš„æ„å¤–ï¼Œæ—¥æŸ±å¸¦æ­¤ç…å½±å“æ›´ç›´æ¥ã€‚'},
    {id:'adult_050', name:'é“æ¿ç…', group:'å¸¸ç”¨', luck:'å‡¶', method:'â—¦ æŸ¥æ³•ï¼šä»¥å‡ºç”Ÿæ—¥å¹²æ­é…æœˆæ”¯æŸ¥è¯¢ï¼Œå£è¯€ä¸ºâ€œç”²å·±åœ¨è¾°ä¹™åºšå¯…ï¼Œä¸™è¾›é¸¡çŠ¬æœˆä¸Šä¸´â€ï¼Œå³ç”²/å·±æ—¥ä¸»ç”Ÿè¾°æœˆã€ä¹™/åºšæ—¥ä¸»ç”Ÿå¯…æœˆã€ä¸™/è¾›æ—¥ä¸»ç”Ÿé…‰æœˆæˆ–æˆŒæœˆï¼Œå³ä¸ºçŠ¯æ­¤ç…ã€‚', effect:'å¤æ—¶ä¼ ç»Ÿæ–‡åŒ–è®¤ä¸ºï¼Œæ­¤ä¸ºçº¯å‡¶ç¥ç…ï¼Œä¸“é—¨ç ´åå©šå§»è¿åŠ¿ã€‚å‘½å¸¦è€…æ€§æ ¼åˆšçƒˆå›ºæ‰§ï¼Œå©šå§»ä¸­æ˜“ä¸ä¼´ä¾£çˆ†å‘å†²çªï¼Œæ°‘é—´æœ‰â€œç”·å‘½çŠ¯ç€ä¼¤ä¸‰å¦»ï¼Œå¥³å‘½çŠ¯ç€æœ‰ä¸‰å©šâ€çš„è¯´æ³•ï¼Œè™½éç»å¯¹ï¼Œä½†æ˜“å¯¼è‡´å©šå§»æ³¢æŠ˜ï¼Œç¦»å©šæ¦‚ç‡è¾ƒé«˜ã€‚'},
    {id:'adult_051', name:'é“æ‰«æŠŠ', group:'å¸¸ç”¨', luck:'ä¸­æ€§', method:'æŸ¥æ³•ï¼šæŒ‰å‡ºç”Ÿå¹´ä»½åœ°æ”¯å’Œæ€§åˆ«å¯¹åº”é˜´å†æœˆä»½æŸ¥è¯¢ï¼Œç”³å­è¾°å¹´ï¼Œç”·å‘½ç”Ÿäºæ­£æœˆã€å¥³å‘½ç”ŸäºåäºŒæœˆï¼›å·³é…‰ä¸‘å¹´ï¼Œç”·å‘½ç”Ÿäºå…­æœˆã€å¥³å‘½ç”Ÿäºä¹æœˆï¼›å¯…åˆæˆŒå¹´ï¼Œç”·å‘½ç”Ÿäºä¹æœˆã€å¥³å‘½ç”Ÿäºå…­æœˆï¼›äº¥å¯æœªå¹´ï¼Œç”·å‘½ç”ŸäºåäºŒæœˆã€å¥³å‘½ç”Ÿäºæ­£æœˆï¼Œå³ä¸ºçŠ¯æ­¤ç…ã€‚', effect:'å¤æ—¶ä¼ ç»Ÿæ–‡åŒ–è®¤ä¸ºï¼Œæ­¤ç¥ç…æ€»ä½“ä¸»ç ´è´¥ï¼Œå±å‡¶ç…ä½†æœ‰ç‰¹ä¾‹ã€‚æ—©ä¸Šå‡ºç”Ÿè€…çŠ¯ç…ï¼Œæ˜“ç ´è´¢éš¾èšè´¢ï¼Œç‰µè¿å®¶åº­ä¸å’Œç¦ï¼›ä¸‹åˆå’Œæ™šä¸Šå‡ºç”Ÿè€…ï¼Œåè€Œèƒ½èšå¤–è´¢æ”¹å–„è¿åŠ¿ï¼Œæ°‘é—´ä¹Ÿæœ‰é€šè¿‡è¡Œå–„ç§¯å¾·ç­‰æ–¹å¼åŒ–è§£å…¶å‡¶æ€§çš„ä¹ ä¿—ã€‚'},
    {id:'adult_052', name:'åŸ‹å„¿ç…', group:'å¸¸ç”¨', luck:'å‡¶', method:'æŸ¥æ³•ï¼šå‘½ç†ä¸Šä»¥å¹´æ”¯ä¸ºåŸºå‡†æŸ¥è¯¢ï¼Œå£è¯€ä¸ºâ€œå­åˆå¯é…‰è§ä¸‘ï¼Œå¯…ç”³å·³äº¥è§ç”³ï¼Œè¾°æˆŒä¸‘æœªè§å¯â€ï¼Œå…«å­—å…¶ä»–åœ°æ”¯ä¸­å‡ºç°å¯¹åº”åœ°æ”¯å³ä¸ºçŠ¯ç…ï¼Œå…¶ä¸­å¥³å‘½æ—¶æ”¯è§å¯¹åº”åœ°æ”¯æœ€ä¸ºå‡¶é™©ï¼›é£æ°´ä¸Šåˆ™æŒ‡å››å‘¨æˆ¿å±‹é«˜å¤§ã€è‡ªèº«æˆ¿å±‹çŸ®å°ï¼Œæˆ–å¤©äº•ä¸­é€ å°å±‹ç­‰æ ¼å±€ï¼Œä¹Ÿå±äºåŸ‹å„¿ç…ã€‚', effect:'å¤æ—¶ä¼ ç»Ÿæ–‡åŒ–è®¤ä¸ºï¼Œæ­¤ç…ä¸»æŸå­æ¯ï¼Œå‘½çŠ¯è€…æ˜“é¢ä¸´ç”Ÿè‚²å›°éš¾ã€å­å¥³æ—©å¤­æˆ–å­å¥³ä¸å­ç­‰æƒ…å†µï¼Œæ™šå¹´å¯èƒ½å­¤ç‹¬æ— ä¾ã€‚é£æ°´ä¸Šçš„åŸ‹å„¿ç…åŒæ ·ä¸åˆ©å­å­™è¿åŠ¿ï¼Œæ°‘é—´å©šå«ã€æ¬è¿æ—¶ï¼Œè¿˜å¿Œè®³åœ¨çŠ¯æ­¤ç…çš„æ—¶è¾°å…¥æˆ¿æˆ–å®‰åºŠï¼Œè‹¥å‘½å±€ä¸­æœ‰å¤©ä¹™è´µäººã€å¤©æœˆå¾·è´µäººåŒæŸ±ï¼Œæˆ–é£æ°´ä¸Šæ”¹é€ æˆ¿å±‹æ ¼å±€ç­‰ï¼Œå¯ç¼“è§£å…¶å‡¶æ€§ã€‚'}

  ];

  let ssFilter = 'all';

  function ssLuckClass(luck){
    if(!luck) return 'neutral';
    if(luck.includes('å‰')) return 'good';
    if(luck.includes('å‡¶') || luck.includes('åå‡¶')) return 'bad';
    if(luck.includes('ä¸­æ€§')) return 'neutral';
    return 'neutral';
  }

  function renderShenShaList(){
    const kw = (els.ssSearch.value || '').trim().toLowerCase();

    let data = SHENSHA_DATA.slice();

    if(ssFilter === 'common'){
      data = data.filter(x => x.group === 'å¸¸ç”¨');
    }else if(ssFilter === 'child'){
      data = data.filter(x => x.group === 'å°å„¿å…³ç…');
    }

    if(kw){
      data = data.filter(x =>
        (x.name || '').toLowerCase().includes(kw) ||
        (x.method || '').toLowerCase().includes(kw) ||
        (x.effect || '').toLowerCase().includes(kw) ||
        (x.note || '').toLowerCase().includes(kw)
      );
    }

    els.ssList.innerHTML = '';
    const frag = document.createDocumentFragment();

    data.forEach(item=>{
      const div = document.createElement('div');
      div.className = 'ss-item';

      const head = document.createElement('div');
      head.className = 'ss-head';

      const name = document.createElement('span');
      name.className = 'ss-name';
      name.textContent = item.name;

      const tag1 = document.createElement('span');
      tag1.className = 'ss-tag';
      tag1.textContent = item.group;

      const tag2 = document.createElement('span');
      tag2.className = 'ss-tag ' + ssLuckClass(item.luck);
      tag2.textContent = item.luck || 'â€”';

      head.appendChild(name);
      head.appendChild(tag1);
      head.appendChild(tag2);

      const body = document.createElement('div');
      body.className = 'ss-body';
      body.textContent =
        `æŸ¥æ³•ï¼š${item.method || 'â€”'}\n` +
        `ä½œç”¨ï¼š${item.effect || 'â€”'}\n` +
        (item.note ? `å¤‡æ³¨ï¼š${item.note}` : '');

      div.appendChild(head);
      div.appendChild(body);
      frag.appendChild(div);
    });

    els.ssList.appendChild(frag);

    renderShenShaList._lastCopy = data.map(x =>
      `${x.name}ã€${x.group}ï½œ${x.luck || 'â€”'}ã€‘\næŸ¥æ³•ï¼š${x.method || 'â€”'}\nä½œç”¨ï¼š${x.effect || 'â€”'}\n${x.note ? 'å¤‡æ³¨ï¼š'+x.note : ''}`
    ).join('\n\n');
  }

  async function copyShenShaList(){
    const text = renderShenShaList._lastCopy || '';
    if(!text){ showToast('åˆ—è¡¨ä¸ºç©º'); return; }
    try{
      await navigator.clipboard.writeText(text);
      showToast('å·²å¤åˆ¶ç¥ç…åˆ—è¡¨');
    }catch{
      showToast('å¤åˆ¶å¤±è´¥');
    }
  }

  function toggleRuleExplain(){
    const show = els.ssRuleExplain.style.display === 'none';
    els.ssRuleExplain.style.display = show ? 'block' : 'none';
  }

  function buildSsRuleText(){
    const lines = [];
    lines.push('æˆ‘ä»¬åœ¨æ’ç›˜é¡µå…ˆåšâ€œåœ°æ”¯ä¸‰åˆç»„â€ç›¸å¯¹ç»Ÿä¸€çš„å››ä¸ªç¥ç…è‡ªåŠ¨åˆ¤å®šï¼š');
    lines.push('1) æ¡ƒèŠ±ï¼šç”³å­è¾°è§é…‰ï¼›å·³é…‰ä¸‘è§åˆï¼›å¯…åˆæˆŒè§å¯ï¼›äº¥å¯æœªè§å­ã€‚');
    lines.push('2) é©¿é©¬ï¼šç”³å­è¾°è§å¯…ï¼›å¯…åˆæˆŒè§ç”³ï¼›äº¥å¯æœªè§å·³ï¼›å·³é…‰ä¸‘è§äº¥ã€‚');
    lines.push('3) åç›–ï¼šç”³å­è¾°è§è¾°ï¼›å¯…åˆæˆŒè§æˆŒï¼›äº¥å¯æœªè§æœªï¼›å·³é…‰ä¸‘è§ä¸‘ã€‚');
    lines.push('4) å°†æ˜Ÿï¼šç”³å­è¾°è§å­ï¼›å¯…åˆæˆŒè§åˆï¼›äº¥å¯æœªè§å¯ï¼›å·³é…‰ä¸‘è§é…‰ã€‚');
    lines.push('');
    lines.push('åˆ¤å®šåŸºå‡†ï¼šä¼˜å…ˆç”¨â€œæ—¥æ”¯â€æ‰€å±ä¸‰åˆç»„ï¼›æ—¥æ”¯ç¼ºå¤±åˆ™å‚è€ƒå¹´æ”¯ã€‚');
    lines.push('æ»¡è¶³æ¡ä»¶ï¼šå››æŸ±ä»»ä¸€åœ°æ”¯å‡ºç°ç›®æ ‡æ”¯ï¼Œå³æç¤ºè¯¥ç¥ç…ã€‚');
    lines.push('');
    lines.push('è¿™å¥—å±äºâ€œå…ˆè®©ä½ èƒ½ç”¨ã€èƒ½å¯¹ç…§ã€èƒ½æ‰©å±•â€çš„è¯•è¡Œç‰ˆã€‚');
    lines.push('');
    lines.push('v10.6 èµ·ï¼Œæ’ç›˜é¡µåŒæ­¥åŠ å…¥éƒ¨åˆ†â€œå°å„¿å…³ç…â€çš„è‡ªåŠ¨æç¤ºï¼ˆåŸºäºå†œå†æœˆ/æ—¥å¹²/æ—¶æ”¯ç­‰æ¡ä»¶ï¼‰ã€‚');
    lines.push('v11.2 èµ·ï¼Œæˆäººç¥ç…è‡ªåŠ¨åˆ¤å®šèŒƒå›´ç»§ç»­æ‰©å±•ï¼›â€œæœªè‡ªåŠ¨åŒ–æ¸…å•â€ä»¥å½“å‰å­¦ä¹ è¡¨ä¸ºåŸºå‡†åŠ¨æ€ç”Ÿæˆã€‚');
    return lines.join('\\n');
  }

  /* ===================== UI åŒæ­¥ ===================== */
  function syncValueText(){
    const y = Number(els.yearRange.value);
    const m = Number(els.monthRange.value);
    const d = Number(els.dayRange.value);
    const h = Number(els.hourRange.value);
    const min = Number(els.minuteRange.value || 0);
    const isLeap = !!els.leapToggle.checked;

    // v11.12b: å†œå†æ¨¡å¼ä¸‹åœ¨å¹´ä»½æ˜¾ç¤ºå¹²æ”¯
if(currentMode === MODE.LUNAR){
  let ygz = '';
  try{
    const lunarTmp = createLunarFromSliders();
    if(lunarTmp && typeof lunarTmp.getYearInGanZhi === 'function'){
      ygz = lunarTmp.getYearInGanZhi();
    }
  }catch(e){}
  els.yearVal.textContent = ygz ? `${y}ï¼ˆ${ygz}ï¼‰` : `${y}`;
}else{
  els.yearVal.textContent = `${y}`;
}


let lunarTmpForDisplay = null;
let mgz = '', dgz = '', tgz = '';
if(currentMode === MODE.LUNAR){
  try{
    lunarTmpForDisplay = createLunarFromSliders();
  }catch(e){}
  if(lunarTmpForDisplay){
    mgz = safeCall(lunarTmpForDisplay, 'getMonthInGanZhi') || safeCall(lunarTmpForDisplay, 'getMonthInGanZhiExact') || '';
    dgz = safeCall(lunarTmpForDisplay, 'getDayInGanZhi') || safeCall(lunarTmpForDisplay, 'getDayInGanZhiExact') || '';
    // éƒ¨åˆ†åº“ç‰ˆæœ¬å¯èƒ½æ²¡æœ‰â€œæ—¶å¹²æ”¯â€æ¥å£ï¼Œå…ˆå°è¯•ç›´å–ï¼›å¤±è´¥å†ç”¨å…¬å†å›æ¨
    tgz = safeCall(lunarTmpForDisplay, 'getTimeInGanZhi') || safeCall(lunarTmpForDisplay, 'getTimeInGanZhiExact') || '';
    if(!tgz){
      try{
        const solarTmp = lunarTmpForDisplay.getSolar ? lunarTmpForDisplay.getSolar() : null;
        if(solarTmp && typeof Solar !== 'undefined'){
          const solarObj = Solar.fromYmdHms(
            solarTmp.getYear(), solarTmp.getMonth(), solarTmp.getDay(),
            h, min, 0
          );
          const lunar2 = solarObj.getLunar();
          tgz = safeCall(lunar2, 'getTimeInGanZhi') || safeCall(lunar2, 'getTimeInGanZhiExact') || '';
        }
      }catch(e){}
    }
  }
}

els.monthVal.textContent = `${pad2(m)}${currentMode === MODE.LUNAR && isLeap ? 'ï¼ˆé—°ï¼‰' : ''}${mgz ? `ï¼ˆ${mgz}ï¼‰` : ''}`;
els.dayVal.textContent = `${pad2(d)}${dgz ? `ï¼ˆ${dgz}ï¼‰` : ''}`;
els.hourVal.textContent = `${pad2(h)}:00${tgz ? `ï¼ˆ${tgz}ï¼‰` : ''}`;
els.minuteVal.textContent = `${pad2(min)}`;
const timeStr = els.minuteToggle.checked ? `${pad2(h)}:${pad2(min)}` : `${pad2(h)}:00`;

    if(currentMode === MODE.SOLAR){
      els.pickedText.textContent = `å½“å‰é€‰æ‹©ï¼ˆå…¬å†ï¼‰ï¼š${y}-${pad2(m)}-${pad2(d)} ${timeStr}ï¼ˆ${getTZ()}ï¼‰`;
    }else{
      els.pickedText.textContent = `å½“å‰é€‰æ‹©ï¼ˆå†œå†ï¼‰ï¼š${y}å¹´${m}æœˆ${isLeap ? 'ï¼ˆé—°ï¼‰' : ''}${d}æ—¥ ${timeStr}`;
    }

    els.crossText.textContent = '';
    if(!ensureLunarLib()) return;

    try{
      if(currentMode === MODE.SOLAR){
        const solar = Solar.fromYmdHms(y, m, d, h, min, 0);
        const lunar = solar.getLunar();
        els.crossText.textContent =
          `å¯¹åº”å†œå†ï¼š${lunar.getYearInGanZhi()}å¹´ ${lunar.getMonthInChinese()}æœˆ ${lunar.getDayInChinese()} ${lunar.getTimeZhi()}æ—¶`;
      }else{
        const lunar = createLunarFromSliders();
        if(lunar){
          const solar = lunar.getSolar();
          els.crossText.textContent =
            `å¯¹åº”å…¬å†ï¼š${solar.getYear()}-${pad2(solar.getMonth())}-${pad2(solar.getDay())} ${pad2(solar.getHour())}:${pad2(solar.getMinute ? solar.getMinute() : min)}`;
        }
      }
    }catch(e){}
  }

  function updateMinuteUI(){
    const on = !!els.minuteToggle.checked;
    els.minuteRow.style.display = on ? 'grid' : 'none';
    syncValueText();
  }

  function wireRange(rangeEl, onChange){
    rangeEl.addEventListener('input', onChange);
    rangeEl.addEventListener('change', onChange);
  }

  function applyPresetSolar(p){
    if(currentMode === MODE.SOLAR){
      setFromSolarParts(p);
    }else{
      setFromSolarParts(p);
      convertSolarSlidersToLunarSliders();
    }
    updateDayRange();
    syncValueText();
  }

  /* ===================== Tab/å­æ¨¡å¼ ===================== */
  function switchTab(which){
    const map = {
      bazi: [els.tabBazi, els.panelBazi],
      jieqi: [els.tabJieqi, els.panelJieqi],
      luck: [els.tabLuck, els.panelLuck],
      almanac: [els.tabAlmanac, els.panelAlmanac],
      shensha: [els.tabShenSha, els.panelShenSha]
    };

    Object.keys(map).forEach(k=>{
      const [btn, panel] = map[k];
      btn.classList.toggle('active', k === which);
      panel.classList.toggle('active', k === which);
    });

    if(which === 'shensha'){
      renderShenShaList();
    }
  }

  function switchLuckMode(which){
    const isWs = which === 'ws';
    els.luckWsPill.classList.toggle('active', isWs);
    els.luckFlowPill.classList.toggle('active', !isWs);
    els.wsBox.classList.toggle('active', isWs);
    els.flowBox.classList.toggle('active', !isWs);
  }

  function setGenderUI(isMale){
     genderForYun = isMale ? 1 : 0;

     if(els.maleBtn) els.maleBtn.classList.toggle('active', isMale);
     if(els.femaleBtn) els.femaleBtn.classList.toggle('active', !isMale);

     if(els.pickMaleBtn) els.pickMaleBtn.classList.toggle('active', isMale);
     if(els.pickFemaleBtn) els.pickFemaleBtn.classList.toggle('active', !isMale);

     // é‡æ–°æ¸²æŸ“å¤§è¿ï¼ˆè‹¥å½“å‰æ¨¡å—å¯è§ï¼‰
     renderDayun();

     // é‡æ–°è®¡ç®—æ’ç›˜é¡µï¼Œè®©ä¾èµ–æ€§åˆ«çš„åˆ¤å®šåŒæ­¥ï¼ˆå¦‚é“æ‰«æŠŠã€åŸ‹å„¿ç…æç¤ºï¼‰
     try{ calculate(true); }catch(e){}
   }

  /* ===================== åˆå§‹åŒ– ===================== */

  // v10.6: å½“å‰å·²å†…ç½®çš„è‡ªåŠ¨åˆ¤å®šåå½•ï¼ˆç”¨äºå±•ç¤ºâ€œæœªè‡ªåŠ¨åŒ–æ¸…å•â€ï¼‰
  const ADULT_AUTO_NAMES = ['æ¡ƒèŠ±', 'é©¿é©¬', 'åç›–', 'å°†æ˜Ÿ', 'æ–‡æ˜Œè´µäºº', 'å¤©ä¹™è´µäºº', 'å›½å°è´µäºº', 'å¤ªæè´µäºº', 'ç¦„ç¥', 'ç¾Šåˆƒ', 'é£åˆƒ', 'è¡€åˆƒ', 'çº¢é¸¾', 'å¤©å–œ', 'å…­åˆ', 'é­ç½¡', 'åæ¶å¤§è´¥', 'å­¤é¸¾ç…', 'é˜´é˜³å·®é”™', 'åœ°æ‰«æ˜Ÿ', 'å…«è´¥', 'æµéœç…', 'é“æ¿ç…', 'é“æ‰«æŠŠ', 'åŸ‹å„¿ç…', 'ç¦å¾·è´µäºº', 'ç¦æ˜Ÿè´µäºº', 'é‡‘èˆ†è´µäºº', 'å–œç¥', 'çº¢è‰³ç…', 'å’¸æ± ', 'äº¡ç¥', 'å…­å„ç…', 'ç¾ç…', 'åŠ«ç…', 'ç™½è™', 'æˆªè·¯ç©ºäº¡', 'å¤©å¨è´µäºº', 'å­¤è¾°', 'å¯¡å®¿', 'å­¦å ‚', 'è¯é¦†', 'æ–‡æ›²æ˜Ÿ', 'ç§‘ç”²æ˜Ÿ', 'ä¸‰å¥‡è´µäºº', 'å¤©å¾·è´µäºº', 'æœˆå¾·è´µäºº', 'å¤©å¾·åˆ', 'æœˆå¾·åˆ', 'å¾·ç§€è´µäºº', 'å¤©ç½—åœ°ç½‘'];
  const CHILD_AUTO_NAMES = ['çŸ­å‘½å…³', 'å››æŸ±å…³', 'é›·å…¬æ‰“è„‘å…³', 'é‡‘é”å…³', 'æ— æƒ…å…³', 'äº”é¬¼å…³', 'å¤©ç‹—å…³', 'æ–­æ¡¥å…³', 'ç™¾æ—¥å…³', 'é˜ç‹å…³', 'å°†å†›ç®­', 'é“è›‡å…³', 'æ±¤ç«ç…ï¼ˆçƒ«ç«å…³ï¼‰', 'é¬¼é—¨å…³', 'æ·±æ°´å…³', 'æµ´ç›†å…³', 'ç™½è™å…³'];

// v11.7b: çœ‹æ¿åŒæ­¥å®‰å…¨å‡çº§ï¼ˆç»Ÿä¸€ç»´æŠ¤è‡ªåŠ¨åŒ–åå½•ï¼‰
const AUTO_COVERED_NAMES = new Set(ADULT_AUTO_NAMES);
const CHILD_COVERED_NAMES = new Set(CHILD_AUTO_NAMES);

function getAdultAutoNames(){ return ADULT_AUTO_NAMES.slice(); }
function getChildAutoNames(){ return CHILD_AUTO_NAMES.slice(); }


function initMissingShenshaList(){
    const box = document.getElementById('ssMissingBox');
    const list = document.getElementById('ssMissingList');
    if(!box || !list) return;
    try{
      const adults = (SHENSHA_DATA || []).filter(x => String(x.id||'').startsWith('adult_'));
      const missing = adults.filter(x => x.group !== 'å°å„¿å…³ç…' && !AUTO_COVERED_NAMES.has(x.name));
      if(!missing.length){
        list.innerHTML = '<span class="ss-miss-badge">å·²å…¨éƒ¨è¦†ç›–ï¼ˆå½“å‰å­¦ä¹ è¡¨èŒƒå›´å†…ï¼‰</span>';
        return;
      }
      list.innerHTML = missing.map(x => `<span class="ss-miss-badge">${x.name}</span>`).join('');
    }catch(e){
      list.innerHTML = '<span class="ss-miss-badge">æ¸…å•ç”Ÿæˆå¤±è´¥</span>';
    }
  }


  // v11.0: å°å„¿å…³ç…å·²å†…ç½®è‡ªåŠ¨æç¤ºåå½•ï¼ˆç”¨äºå±•ç¤ºâ€œæœªè‡ªåŠ¨åŒ–æ¸…å•â€ï¼‰
// v11.7b: è‡ªåŠ¨è§„åˆ™æ³¨å†Œè¡¨ï¼ˆå®‰å…¨ç‰ˆï¼‰
  // å…ˆä»¥ç°æœ‰â€œå·²è¦†ç›–åå½•â€ä¸ºæºå¤´ç”Ÿæˆæ³¨å†Œè¡¨ï¼Œé¿å…å½±å“æ’ç›˜é€‰æ‹©å™¨ç­‰ç¨³å®šé€»è¾‘
  const AUTO_RULES_REGISTRY = [
    ...Array.from(AUTO_COVERED_NAMES).map(name => ({name, type:'adult'})),
    ...Array.from(CHILD_COVERED_NAMES).map(name => ({name, type:'child'}))
  ];
  
  // v11.7b: æˆäººç¥ç…åˆ¤å®šå¼ºåº¦ï¼ˆä»…å½±å“æ˜¾ç¤º/æç¤ºï¼Œä¸æ”¹å˜åŸºç¡€è®¡ç®—ï¼‰
  let ADULT_RULE_STRENGTH = (localStorage.getItem('adultRuleStrength') || 'balanced');
  const ADULT_TRIAL_NAMES = new Set(['å­¦å ‚','è¯é¦†','ç§‘ç”²æ˜Ÿ','ä¸‰å¥‡è´µäºº']);
  
  function shouldIncludeAdultRule(name){
    if(ADULT_RULE_STRENGTH === 'strict'){
      return !ADULT_TRIAL_NAMES.has(name);
    }
    return true; // balanced / loose
  }
  
  function setAdultRuleStrength(level){
    ADULT_RULE_STRENGTH = level;
    try{ localStorage.setItem('adultRuleStrength', level); }catch(e){}
    ['pickStrictBtn','pickBalancedBtn','pickLooseBtn'].forEach(id=>{
      const el = document.getElementById(id);
      if(!el) return;
      el.classList.toggle('active', el.dataset.level === level);
    });
  }
  
  function initAdultRuleStrengthUI(){
    const btns = [
      document.getElementById('pickStrictBtn'),
      document.getElementById('pickBalancedBtn'),
      document.getElementById('pickLooseBtn')
    ].filter(Boolean);
    btns.forEach(b=>{
      b.addEventListener('click', ()=>{
        setAdultRuleStrength(b.dataset.level);
        try{ calculate(false); }catch(e){}
      });
    });
    setAdultRuleStrength(ADULT_RULE_STRENGTH);
  }
function initMissingChildGuanShaList(){
    const box = document.getElementById('cgMissingBox');
    const list = document.getElementById('cgMissingList');
    if(!box || !list) return;
    try{
      const childs = (SHENSHA_DATA || []).filter(x => String(x.id||'').startsWith('child_'));
      const missing = childs.filter(x => !CHILD_COVERED_NAMES.has(x.name));
      if(!missing.length){
        list.innerHTML = '<span class="ss-miss-badge">å·²å…¨éƒ¨è¦†ç›–ï¼ˆå½“å‰å­¦ä¹ è¡¨èŒƒå›´å†…ï¼‰</span>';
        return;
      }
      list.innerHTML = missing.map(x => `<span class="ss-miss-badge">${x.name}</span>`).join('');
    }catch(e){
      list.innerHTML = '<span class="ss-miss-badge">æ¸…å•ç”Ÿæˆå¤±è´¥</span>';
    }
  }

  function init(){
    setRangesBounds();
    setActiveModePill();
    updateLabels();

    els.minuteToggle.checked = false;
    updateMinuteUI();

    setFromDate(new Date());
    setActiveQuickPill('now');

    wireRange(els.yearRange, () => { updateDayRange(); syncValueText(); setActiveQuickPill(null); });
    wireRange(els.monthRange, () => { updateDayRange(); syncValueText(); setActiveQuickPill(null); });
    wireRange(els.dayRange, () => { syncValueText(); setActiveQuickPill(null); });
    wireRange(els.hourRange, () => { syncValueText(); setActiveQuickPill(null); });
    wireRange(els.minuteRange, () => { syncValueText(); setActiveQuickPill(null); });

    els.leapToggle.addEventListener('change', () => {
      updateDayRange();
      syncValueText();
      setActiveQuickPill(null);
    });

    els.minuteToggle.addEventListener('change', updateMinuteUI);

    els.solarModeBtn.addEventListener('click', () => switchMode(MODE.SOLAR));
    els.lunarModeBtn.addEventListener('click', () => switchMode(MODE.LUNAR));

    els.nowPill.addEventListener('click', () => {
      setFromDate(new Date());
      if(currentMode === MODE.LUNAR) convertSolarSlidersToLunarSliders();
      setActiveQuickPill('now');
      updateDayRange();
      syncValueText();
    });
    els.linxiPill.addEventListener('click', () => {
      applyPresetSolar(PRESETS_SOLAR.linxi);
      setActiveQuickPill('linxi');
    });
    els.yaoPill.addEventListener('click', () => {
      applyPresetSolar(PRESETS_SOLAR.yao);
      setActiveQuickPill('yao');
    });

    els.calcBtn.addEventListener('click', () => calculate(true));
    els.copyBtn.addEventListener('click', copyResult);

    els.setABtn.addEventListener('click', setAsA);
    els.compareBtn.addEventListener('click', compareWithCurrentAsB);
    if(els.clearCompareBtn){
      els.clearCompareBtn.addEventListener('click', clearA);
    }

    /* Tabs */
    els.tabBazi.addEventListener('click', () => switchTab('bazi'));
    els.tabJieqi.addEventListener('click', () => switchTab('jieqi'));
    els.tabLuck.addEventListener('click', () => switchTab('luck'));
    els.tabAlmanac.addEventListener('click', () => switchTab('almanac'));
    els.tabShenSha.addEventListener('click', () => switchTab('shensha'));

    /* èŠ‚æ°”å¹´ */
    const now = new Date();
    els.jieqiYearRange.value = now.getFullYear();
    updateJieqiYearVal();
    wireRange(els.jieqiYearRange, updateJieqiYearVal);
    els.jieqiQueryBtn.addEventListener('click', () => {
      const y = Number(els.jieqiYearRange.value);
      renderJieqiList(y);
    });
    els.jieqiCopyBtn.addEventListener('click', copyJieqiList);

    /* luck å­æ¨¡å¼ */
    els.luckWsPill.addEventListener('click', () => switchLuckMode('ws'));
    els.luckFlowPill.addEventListener('click', () => switchLuckMode('flow'));

    els.wsCalcBtn.addEventListener('click', renderWs);
    els.wsCopyBtn.addEventListener('click', copyWs);

    els.flowYearRange.value = now.getFullYear();
    updateFlowYearVal();
    wireRange(els.flowYearRange, updateFlowYearVal);

    els.flowCalcBtn.addEventListener('click', renderFlow);
    els.flowCopyBtn.addEventListener('click', copyFlow);

    els.maleBtn.addEventListener('click', () => setGenderUI(true));
    els.femaleBtn.addEventListener('click', () => setGenderUI(false));

    if(els.pickMaleBtn && els.pickFemaleBtn){
      els.pickMaleBtn.addEventListener('click', () => setGenderUI(true));
      els.pickFemaleBtn.addEventListener('click', () => setGenderUI(false));
    }
    setGenderUI(true);

    /* Almanac */
    setAlmanacDateInput(now);
    els.almanacTodayBtn.addEventListener('click', () => {
      const d = new Date();
      setAlmanacDateInput(d);
      renderAlmanac();
    });
    els.almanacDate.addEventListener('change', renderAlmanac);
    els.almanacCopyBtn.addEventListener('click', copyAlmanac);

    /* ShenSha learning */
    els.ssRuleText.textContent = buildSsRuleText();

    els.ssSearch.addEventListener('input', renderShenShaList);

    function setSsFilter(which){
      ssFilter = which;
      els.ssFilterAll.classList.toggle('active', which === 'all');
      els.ssFilterCommon.classList.toggle('active', which === 'common');
      els.ssFilterChild.classList.toggle('active', which === 'child');
      renderShenShaList();
    }

    els.ssFilterAll.addEventListener('click', () => setSsFilter('all'));
    els.ssFilterCommon.addEventListener('click', () => setSsFilter('common'));
    els.ssFilterChild.addEventListener('click', () => setSsFilter('child'));

    els.ssCopyListBtn.addEventListener('click', copyShenShaList);
    els.ssJumpExplainBtn.addEventListener('click', toggleRuleExplain);

    /* åˆå§‹ */
    updateDayRange();
    syncValueText();
    renderAlmanac();
    renderShenShaList();
    try{ initMissingShenshaList(); }catch(e){}
    try{ initMissingChildGuanShaList(); }catch(e){}
  }

  init();


// v11.7b: å‘½ä¸­å±•å¼€è¯¦æƒ…é€»è¾‘ï¼ˆå®‰å…¨ç‰ˆï¼‰
function buildSsDetailHtml(payload, meta){
  const esc = (s)=> (s ?? '').toString()
    .replace(/&/g, '&amp;')
    .replace(/</g, '&lt;')
    .replace(/>/g, '&gt;')
    .replace(/"/g, '&quot;')
    .replace(/'/g, '&#39;');

  const { name, rule, kind, tag, luck } = meta;

  const yearGZ = payload?.yearGZ || '';
  const monthGZ = payload?.monthGZ || '';
  const dayGZ = payload?.dayGZ || '';
  const hourGZ = payload?.hourGZ || '';
  const gender = payload?.gender || '';
  const calendarMode = payload?.mode === 'lunar' ? 'å†œå†' : 'å…¬å†';

  const rows = [];

  rows.push(`
    <div class="ss-detail-row">
      <div class="ss-detail-label">æŸ¥æ³•ç»“æ„</div>
      <div class="ss-detail-value">${rule ? esc(rule) : 'ï¼ˆæœ¬æ¡ä¸ºç»„åˆç±»åˆ¤å®šï¼‰'}</div>
    </div>
  `);

  if(tag){
    rows.push(`
      <div class="ss-detail-row">
        <div class="ss-detail-label">è§„åˆ™ç±»å‹</div>
        <div class="ss-detail-value">${esc(tag)}</div>
      </div>
    `);
  }

  rows.push(`
    <div class="ss-detail-row">
      <div class="ss-detail-label">æœ¬ç›˜å››æŸ±å¯¹ç…§</div>
      <div class="ss-detail-value">
        å¹´æŸ±ï¼š${esc(yearGZ)}<br/>
        æœˆæŸ±ï¼š${esc(monthGZ)}<br/>
        æ—¥æŸ±ï¼š${esc(dayGZ)}<br/>
        æ—¶æŸ±ï¼š${esc(hourGZ)}
      </div>
    </div>
  `);

  rows.push(`
    <div class="ss-detail-row">
      <div class="ss-detail-label">åŸºç¡€å‚æ•°</div>
      <div class="ss-detail-value">${gender ? `æ€§åˆ«ï¼š${esc(gender)} Â· ` : ''}${calendarMode}${luck ? ` Â· ${esc(luck)}` : ''}</div>
    </div>
  `);

  const hint = buildRuleHintSafe(name, rule, kind);
  if(hint){
    rows.push(`
      <div class="ss-detail-row">
        <div class="ss-detail-label">å‘½ä¸­æç¤º</div>
        <div class="ss-detail-value">${esc(hint)}</div>
      </div>
    `);
  }

  return rows.join('');
}

function buildRuleHintSafe(name, rule, kind){
  const r = (rule || '').toString();
  if(!r) return '';
  if(name === 'é“æ‰«æŠŠ') return 'æœ¬æ¡ä¸ºå¹´æ”¯åˆ†ç»„ + æ€§åˆ« + å†œå†æœˆä»½å£å¾„ã€‚';
  if(r.includes('çº³éŸ³')) return 'æœ¬æ¡æ¶‰åŠå¹´æŸ±çº³éŸ³ä¸å†œå†æœˆä»½çš„å¯¹åº”ã€‚';
  if(r.includes('æ—¥å¹²') && (r.includes('è§') || r.includes('å¯¹åº”'))) return 'æœ¬æ¡ä¸ºæ—¥å¹²å¯¹ç…§åœ°æ”¯å£å¾„ã€‚';
  if(r.includes('å­£èŠ‚') && (r.includes('æ—¶') || r.includes('æ—¶è¾°'))) return 'æœ¬æ¡ä¸ºå­£èŠ‚å¯¹ç…§æ—¶è¾°å£å¾„ã€‚';
  if(r.includes('å†œå†') && (r.includes('æ—¶') || r.includes('æ—¶è¾°'))) return 'æœ¬æ¡ä¸ºå†œå†æœˆä»½å¯¹ç…§æ—¶è¾°å£å¾„ã€‚';
  if(r.includes('å¹´æ”¯') && (r.includes('æ—¶') || r.includes('æ—¶è¾°'))) return 'æœ¬æ¡ä¸ºå¹´æ”¯å¯¹ç…§æ—¶è¾°å£å¾„ã€‚';
  if(r.includes('å‡ºç”Ÿæ—¥å¹²') && (r.includes('æ—¶') || r.includes('æ—¶è¾°'))) return 'æœ¬æ¡ä¸ºæ—¥å¹²å¯¹ç…§æ—¶è¾°å£å¾„ã€‚';
  return '';
}

function openSsDetailSafe(payload, meta){
  const overlay = document.getElementById('ssDetailOverlay');
  const titleEl = document.getElementById('ssDetailTitle');
  const subEl = document.getElementById('ssDetailSub');
  const bodyEl = document.getElementById('ssDetailBody');
  if(!overlay || !titleEl || !bodyEl) return;

  const { name, kind, luck, tag } = meta;

  titleEl.textContent = name || 'å‘½ä¸­è¯¦æƒ…';
  const kindText = kind === 'child' ? 'å°å„¿å…³ç…' : (kind === 'group' ? 'ä¸‰åˆç»„ç¥ç…' : 'æˆäººç¥ç…');
  const luckText = luck ? ` Â· ${luck}` : '';
  const tagText = tag ? ` Â· ${tag}` : '';
  if(subEl) subEl.textContent = `${kindText}${luckText}${tagText}`;

  bodyEl.innerHTML = buildSsDetailHtml(payload, meta);

  overlay.classList.add('show');
  overlay.setAttribute('aria-hidden', 'false');
}

function closeSsDetailSafe(){
  const overlay = document.getElementById('ssDetailOverlay');
  if(!overlay) return;
  overlay.classList.remove('show');
  overlay.setAttribute('aria-hidden', 'true');
}

function initSsDetailEventsSafe(){
  try{
    // å…¨å±€å§”æ‰˜ï¼šé¿å…å› å±€éƒ¨å®¹å™¨é‡æ¸²æŸ“/IDå˜æ›´å¯¼è‡´ç‚¹å‡»å¤±æ•ˆ
    const getPayloadSafe = () => {
      let payload = null;
      try{
        if(typeof calculatePayload === 'function'){
          payload = calculatePayload();
        }
      }catch(err){}
      return payload;
    };

    const handler = (e) => {
      const badge = e.target && e.target.closest ? e.target.closest('.ss-inline-badge') : null;
      if(!badge) return;

      const meta = {
        kind: badge.dataset.kind || (badge.classList.contains('child') ? 'child' : 'adult'),
        name: badge.dataset.name || badge.textContent?.split('ï¼ˆ')[0]?.trim() || '',
        rule: badge.dataset.rule || '',
        luck: badge.dataset.luck || '',
        tag: badge.dataset.tag || ''
      };

      openSsDetailSafe(getPayloadSafe(), meta);
    };

    // å¦‚æœå­˜åœ¨ä¸“ç”¨å®¹å™¨ï¼Œä»ä¿ç•™å±€éƒ¨ç»‘å®šï¼ˆæ›´ç²¾å‡†ï¼‰
    const container = document.getElementById('ssInlineResult');
    if(container){
      container.addEventListener('click', handler);
    }
    // å…œåº•ï¼šå…¨å±€ç»‘å®š
    document.addEventListener('click', handler);

    const overlay = document.getElementById('ssDetailOverlay');
    const closeBtn = document.getElementById('ssDetailCloseBtn');
    if(closeBtn) closeBtn.addEventListener('click', closeSsDetailSafe);
    if(overlay){
      overlay.addEventListener('click', (e) => {
        if(e.target === overlay) closeSsDetailSafe();
      });
    }

    document.addEventListener('keydown', (e) => {
      if(e.key === 'Escape') closeSsDetailSafe();
    });
  }catch(e){}
}
// ç‹¬ç«‹åˆå§‹åŒ–ï¼šä¸æ’æ‰‹åŸ init é“¾è·¯ï¼Œé¿å…å½±å“æ—¥æœŸé€‰æ‹©å™¨
document.addEventListener('DOMContentLoaded', () => {
  setTimeout(initSsDetailEventsSafe, 0);
});


// v11.12b: ä»æ’ç›˜è¯¦æƒ…å¡ç‰‡ä¸€é”®è·³è½¬åˆ°å­¦ä¹ è¡¨åŸæ–‡ï¼ˆå®‰å…¨è¿½åŠ ï¼Œä¸æ”¹åŸå‡½æ•°ä½“ï¼‰
function jumpToShenShaLearningSafe(name){
  try{ closeSsDetailSafe && closeSsDetailSafe(); }catch(e){}

  try{
    if(typeof switchTab === 'function'){
      switchTab('shensha');
    }
  }catch(e){}

  // æ¸…ç†ç­›é€‰/æœç´¢ï¼Œå°½é‡ä¿è¯èƒ½çœ‹åˆ°å…¨é‡æ¡ç›®
  try{
    if(window.els && els.ssSearch) els.ssSearch.value = '';
    if(typeof window.ssFilter !== 'undefined') window.ssFilter = 'all';
  }catch(e){}

  try{
    if(typeof renderShenShaList === 'function'){
      renderShenShaList();
    }
  }catch(e){}

  if(!name) return;

  // ç­‰åˆ—è¡¨æ¸²æŸ“åç”¨æ–‡æœ¬åŒ¹é…å®šä½
  setTimeout(()=>{
    try{
      const items = document.querySelectorAll('.ss-item');
      const target = Array.from(items).find(el => {
        const t = (el.innerText || '').trim();
        return t.startsWith(name) || t.includes(name);
      });
      if(target){
        target.scrollIntoView({behavior:'smooth', block:'start'});
        target.classList.add('pulse-highlight');
        setTimeout(()=> target.classList.remove('pulse-highlight'), 900);
      }
    }catch(e){}
  }, 60);
}

function injectLearningLinkIntoDetail(meta){
  try{
    const bodyEl = document.getElementById('ssDetailBody');
    if(!bodyEl) return;
    // é˜²é‡å¤
    if(bodyEl.querySelector('.ss-detail-actions')) return;

    const name = meta?.name || '';
    const wrap = document.createElement('div');
    wrap.className = 'ss-detail-actions';

    const btn = document.createElement('span');
    btn.className = 'ss-detail-link';
    btn.textContent = 'å»å­¦ä¹ è¡¨çœ‹åŸæ–‡';
    btn.dataset.action = 'to-learning';
    btn.dataset.name = name;

    wrap.appendChild(btn);
    bodyEl.appendChild(wrap);
  }catch(e){}
}

// åŠ«æŒ openSsDetailSafeï¼šè°ƒç”¨åŸé€»è¾‘åæ³¨å…¥æŒ‰é’®
(function(){
  try{
    if(typeof openSsDetailSafe === 'function' && !openSsDetailSafe.__patched_v118b){
      const _open = openSsDetailSafe;
      const wrapped = function(payload, meta){
        _open(payload, meta);
        injectLearningLinkIntoDetail(meta);
      };
      wrapped.__patched_v118b = true;
      openSsDetailSafe = wrapped;
    }
  }catch(e){}
})();

// å…¨å±€å§”æ‰˜ï¼šå¤„ç†è¯¦æƒ…å¡ç‰‡æŒ‰é’®ç‚¹å‡»
(function(){
  const handler = (e) => {
    const link = e.target && e.target.closest ? e.target.closest('.ss-detail-link[data-action="to-learning"]') : null;
    if(!link) return;
    const name = link.dataset.name || '';
    jumpToShenShaLearningSafe(name);
  };
  try{ document.addEventListener('click', handler, true); }catch(e){}
})();


// v11.12b: å­¦ä¹ è¡¨ â†’ æ’ç›˜é¡µ è½»é‡è”åŠ¨ï¼ˆå®‰å…¨è¿½åŠ ï¼‰
function injectLearnToPanButtons(){
  try{
    const items = document.querySelectorAll('.ss-item');
    if(!items.length) return;

    items.forEach(el=>{
      const head = el.querySelector('.ss-head');
      const nameEl = el.querySelector('.ss-name');
      if(!head || !nameEl) return;

      if(head.querySelector('.ss-learn-to-pan')) return;

      const nm = (nameEl.textContent || '').trim();
      if(!nm) return;

      // æ‰¾å¯¹åº”æ•°æ®ä»¥å– method
      let method = '';
      try{
        const found = (window.SHENSHA_DATA || []).find(x => x.name === nm);
        method = found?.method || '';
      }catch(e){}

      const btn = document.createElement('span');
      btn.className = 'ss-learn-to-pan';
      btn.textContent = 'å»æ’ç›˜è¯•ç›˜';
      btn.dataset.name = nm;
      btn.dataset.method = method;

      head.appendChild(btn);
    });
  }catch(e){}
}

function showPanFocusHint(name, method){
  try{
    const container = document.getElementById('ssInlineResult');
    if(!container) return;

    // æ¸…ç†æ—§æç¤º
    const old = container.querySelector('.ss-pan-hint');
    if(old) old.remove();

    const hint = document.createElement('div');
    hint.className = 'ss-pan-hint';

    const shortMethod = (method || '').toString().trim();
    const methodPart = shortMethod ? `ï¼ˆæŸ¥æ³•è¦ç‚¹ï¼š${shortMethod}ï¼‰` : '';

    hint.textContent = `ä½ æ­£åœ¨æŸ¥çœ‹ï¼š${name || 'â€”'}${methodPart}`;
    container.appendChild(hint);

    setTimeout(()=>{ try{ hint.remove(); }catch(e){} }, 3200);
  }catch(e){}
}

function jumpToPanFromLearning(name, method){
  try{
    if(typeof switchTab === 'function'){
      switchTab('bazi');
    }
  }catch(e){}
  setTimeout(()=> showPanFocusHint(name, method), 60);
}

// åŒ…è£¹ renderShenShaListï¼šæ¸²æŸ“åæ³¨å…¥æŒ‰é’®
(function(){
  try{
    if(typeof renderShenShaList === 'function' && !renderShenShaList.__patched_v119a){
      const _render = renderShenShaList;
      const wrapped = function(){
        const res = _render.apply(this, arguments);
        try{ injectLearnToPanButtons(); }catch(e){}
        return res;
      };
      wrapped.__patched_v119a = true;
      renderShenShaList = wrapped;
    }
  }catch(e){}
})();

// è¿›å…¥å­¦ä¹ é¡µæ—¶ä¹Ÿè¡¥æ‰“ä¸€é’ˆ
document.addEventListener('DOMContentLoaded', () => {
  setTimeout(()=>{ try{ injectLearnToPanButtons(); }catch(e){} }, 0);
});

// å…¨å±€å§”æ‰˜ï¼šå­¦ä¹ è¡¨æŒ‰é’®ç‚¹å‡»
(function(){
  const handler = (e) => {
    const btn = e.target && e.target.closest ? e.target.closest('.ss-learn-to-pan') : null;
    if(!btn) return;
    const name = btn.dataset.name || '';
    const method = btn.dataset.method || '';
    jumpToPanFromLearning(name, method);
  };
  try{ document.addEventListener('click', handler, true); }catch(e){}
})();
</script>
<!-- v11.7b: å‘½ä¸­å±•å¼€è¯¦æƒ… -->
<div class="ss-detail-overlay" id="ssDetailOverlay" aria-hidden="true">
  <div class="ss-detail-card">
    <div class="ss-detail-head">
      <div>
        <div class="ss-detail-title" id="ssDetailTitle">å‘½ä¸­è¯¦æƒ…</div>
        <div class="ss-detail-sub" id="ssDetailSub"></div>
      </div>
      <div class="ss-detail-close" id="ssDetailCloseBtn">å…³é—­</div>
    </div>
    <div id="ssDetailBody"></div>
  </div>
</div>

</body>
</html>